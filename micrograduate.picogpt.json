{"version":3,"kind":"Notebook","sha256":"ef56e6fa946a34d600c25b431fc08992f20dd6d1ca4fcda438c0ba10e99be023","slug":"micrograduate.picogpt","location":"/micrograduate/picogpt.ipynb","dependencies":[],"frontmatter":{"title":"7. picoGPT: implementing a tiny GPT from scratch","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"micrograduate-env","language":"python"},"github":"https://github.com/ckaraneen/micrograduate","copyright":"MIT License","source_url":"https://github.com/ckaraneen/micrograduate/blob/main/micrograduate/picogpt.ipynb","edit_url":"https://github.com/ckaraneen/micrograduate/edit/main/micrograduate/picogpt.ipynb","exports":[{"format":"ipynb","filename":"picogpt.ipynb","url":"/build/picogpt-5a8e93d43592fa294981fa7b544b4089.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import sys\n\nIN_COLAB = \"google.colab\" in sys.modules\nif IN_COLAB:\n    print(\"Cloning repo...\")\n    !git clone --quiet https://github.com/ckaraneen/micrograduate.git > /dev/null\n    %cd micrograduate\n    print(\"Installing requirements...\")\n    !pip install --quiet uv\n    !uv pip install --system --quiet -r requirements.txt","key":"eVpcXlgqGx"},{"type":"outputs","id":"Bjwi6hoMwH0KgNC_u9rz3","children":[],"key":"tfh8gPBz9g"}],"key":"ihGptZ40Ix"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Intro","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LikCvWze9C"}],"identifier":"intro","label":"Intro","html_id":"intro","implicit":true,"key":"Nk22jFqWfE"}],"key":"zf19q6YgkC"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this lesson, we’ll implement a tiny ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vaXfnfZ7rQ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hY5nccSKZC"}],"key":"LVeEAB6DEy"},{"type":"text","value":" from scratch in just a few lines of NumPy. To keep things simple, we’ll then load the trained ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JAngy5S0Pt"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FTkBIBapjg"}],"key":"RNetAA1wFv"},{"type":"text","value":"-2 model weights released by OpenAI into our implementation and generate some text. Sounds straightforward, right? Well, that’s because it is! Let’s get started.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KTdSAb2zuU"}],"key":"wiQtAHFJlm"}],"key":"u8pmSfHanG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"What is a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZAy62g354X"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SsOvtksFyk"}],"key":"wVToO0Qr8T"},{"type":"text","value":"?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x4QDy0WE1I"}],"identifier":"what-is-a-gpt","label":"What is a GPT?","html_id":"what-is-a-gpt","implicit":true,"key":"QsuPPHvYor"}],"key":"yBfQuT5Zmn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NY695vKiMS"}],"key":"dIdvfAFpNC"},{"type":"text","value":" stands for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uoGorqKGUR"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generative Pre-trained Transformer","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FocpvhJ0Wy"}],"key":"gutCUjNJNC"},{"type":"text","value":". It’s a type of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iStGapFaqj"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lBE1la519n"}],"key":"UDVJdbEwYR"},{"type":"text","value":" architecture based on the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"huR7e3PSFY"},{"type":"link","url":"https://arxiv.org/pdf/1706.03762.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Transformer","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aYUubJSCjg"}],"urlSource":"https://arxiv.org/pdf/1706.03762.pdf","key":"Mo596Xa1Sa"},{"type":"text","value":". ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eKv1Afoosd"},{"type":"link","url":"https://jalammar.github.io/how-gpt3-works-visualizations-animations/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Jay Alammar’s How ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Yx2HgWDSr8"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rma8szR4c2"}],"key":"JhcjYmzMnv"},{"type":"text","value":"3 Works","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gdDgEGtoDI"}],"urlSource":"https://jalammar.github.io/how-gpt3-works-visualizations-animations/","key":"qF8H9MJKc5"},{"type":"text","value":" is an excellent introduction to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XhGCIUIsOM"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SS6WDCDJoB"}],"key":"qdqy01TVVW"},{"type":"text","value":"s at a high level, but here’s the tl;dr:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QN4568kpVj"}],"key":"OwjKYOlE6c"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Generative: A ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"B9chnd5S4f"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"m9yq1w2171"}],"key":"IbjiGr1hSy"},{"type":"text","value":" generates text.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yzhLPgljiG"}],"key":"Cbf1vIcQAa"}],"key":"Tu7ssBP1LA"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Pre-trained: A ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"P95V7ln0ID"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i6SMbn3lYE"}],"key":"DCiDm5yjlZ"},{"type":"text","value":" is trained on lots of text from books, the internet, etc ...","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W8XKLWFHNg"}],"key":"pdHjoohfQS"}],"key":"pNPC8LXnOy"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Transformer: A ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IraBOwZY7p"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LPhIGR075U"}],"key":"ZgvPqoJxFT"},{"type":"text","value":" is a decoder-only transformer ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tp5nqH9PNq"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"pTjPtlPUgy"}],"key":"DlMeoFJ6sA"},{"type":"text","value":".","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vVuHwIN3Vg"}],"key":"fisfjbPh5Q"}],"key":"MDZvGsweCU"}],"key":"A7xYRHCEJ0"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Large Language Models (LLMs), like ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mW6edcfGgf"},{"type":"link","url":"https://en.wikipedia.org/wiki/GPT-3","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"OpenAI’s ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"trOTVJUUIt"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"IASgMkTrTq"}],"key":"ZDZfZA4wHy"},{"type":"text","value":"-3","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vPbg357I6h"}],"urlSource":"https://en.wikipedia.org/wiki/GPT-3","data":{"page":"GPT-3","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"pd39JrZfya"},{"type":"text","value":", are just ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"IVvm687m8u"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"su52cSTEeu"}],"key":"Tj0AZBIZHF"},{"type":"text","value":"s under the hood. What makes them special is they happen to be:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SHLcB5Yp1H"}],"key":"tCn48LieGl"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"very big (billions of parameters) and","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BCdrfw3bUl"}],"key":"RfpfHmqCfF"}],"key":"EowyEKO1LO"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"trained on lots of data (hundreds of gigabytes of text).","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"nHQDoXHpjF"}],"key":"w2uzJ6VghT"}],"key":"BcmXKqm3ua"}],"key":"s0Jd7XDpdu"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Fundamentally, a ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"aYQhfGL6ae"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"wcEM98zHrn"}],"key":"pIgANVdwnu"},{"type":"text","value":" generates text given a prompt. Even with this very simple API (input = text, output = text), a well-trained ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"WypdNxvfe8"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"vDHlXyiNwL"}],"key":"v69nHuTXQm"},{"type":"text","value":" can do some pretty awesome stuff like ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"CZnQuguVEq"},{"type":"link","url":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Demo-of-Drafting-an-Email.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"write your emails","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ao6kIysHOe"}],"urlSource":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Demo-of-Drafting-an-Email.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","key":"GAG99jNkxO"},{"type":"text","value":", ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"uikGT6Ckw9"},{"type":"link","url":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Example-Book-Summarization.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"summarize a book","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"VD7mjLvfh7"}],"urlSource":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Example-Book-Summarization.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","key":"ZcY9lLzI1q"},{"type":"text","value":", ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"o3zdHQilo4"},{"type":"link","url":"https://khrisdigital.com/wp-content/uploads/2022/12/image-1.png","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"give you instagram caption ideas","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Zk0Zt2Smxe"}],"urlSource":"https://khrisdigital.com/wp-content/uploads/2022/12/image-1.png","key":"oPALLs2fy4"},{"type":"text","value":", ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"sIc2B94gfh"},{"type":"link","url":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Examples-Explaining-Black-Holes.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"explain black holes to a 5 year old","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"pk8rSkPqtb"}],"urlSource":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Examples-Explaining-Black-Holes.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","key":"hFn5ph5sux"},{"type":"text","value":", ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"rjBIb1TWmL"},{"type":"link","url":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Demo-of-Writing-SQL-Queries.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"code in SQL","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Mqg4OIQgEY"}],"urlSource":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/ChatGPT-Demo-of-Writing-SQL-Queries.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","key":"OYA8IzQsxU"},{"type":"text","value":", and even ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"AsJvpGecGn"},{"type":"link","url":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/Chat-GPT-Example-Writing-a-Will.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"write your will","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"f450kpca0O"}],"urlSource":"https://machinelearningknowledge.ai/ezoimgfmt/b2611031.smushcdn.com/2611031/wp-content/uploads/2022/12/Chat-GPT-Example-Writing-a-Will.png?lossy=0&strip=1&webp=1&ezimgfmt=ng:webp/ngcb1","key":"KyNSPxpgy3"},{"type":"text","value":". So that’s a high-level overview of ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"HeSE9UXEdu"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"J9qm0gE0BU"}],"key":"NdH5kChwO6"},{"type":"text","value":"s and their capabilities. Let’s dig into some more specifics.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"juqkJV5hud"}],"key":"sBaqcAZICu"}],"key":"N5hgqFPFUv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Input / Output","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p8o8ULI7dc"}],"identifier":"input-output","label":"Input / Output","html_id":"input-output","implicit":true,"key":"wqL954cFc4"}],"key":"Q79sWnam8q"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The function signature for a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K37hRrPNKl"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MmvHAbbvZD"}],"key":"k0IoI1cxMB"},{"type":"text","value":" looks roughly like this:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sx0QDKo9ec"}],"key":"z184R5RwtW"}],"key":"ESQKbfU8up"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"def gpt(inputs: list[int]) -> list[list[float]]:\n    # inputs has shape [n_seq]\n    # output has shape [n_seq, n_vocab]\n    output = # beep boop neural network magic\n    return output","position":{"start":{"line":1,"column":1},"end":{"line":7,"column":1}},"key":"vSvpfxZWpP"}],"key":"xIPyQIKsbH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Input","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BoL6bIzmqK"}],"identifier":"input","label":"Input","html_id":"input","implicit":true,"key":"HLeRBs99JB"}],"key":"yDNU3FIiLy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The input is some text represented by a sequence of integers that map to tokens in the text:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fIPuDVVUEY"}],"key":"VrkesgVqD7"}],"key":"ljr486gR0X"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"# integers represent tokens in our text, for example:\n# text   = \"not all heroes wear capes\":\n# tokens = \"not\"  \"all\" \"heroes\" \"wear\" \"capes\"\ninputs =   [1,     0,    2,      4,     6]","position":{"start":{"line":1,"column":1},"end":{"line":6,"column":1}},"key":"uaq8vZviHV"}],"key":"xo3RZ4Fbvh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Tokens are sub-pieces of the text, which are produced using some kind of tokenizer. We can map tokens to integers using a vocabulary:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vB3H7dRIw5"}],"key":"U5V4s8SXSZ"}],"key":"nELWLs9kDQ"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"# the index of a token in the vocab represents the integer id for that token\n# i.e. the integer id for \"heroes\" would be 2, since vocab[2] = \"heroes\"\nvocab = [\"all\", \"not\", \"heroes\", \"the\", \"wear\", \".\", \"capes\"]\n\n# a pretend tokenizer that tokenizes on whitespace\ntokenizer = WhitespaceTokenizer(vocab)\n\n# the encode() method converts a str -> list[int]\nids = tokenizer.encode(\"not all heroes wear\") # ids = [1, 0, 2, 4]\n\n# we can see what the actual tokens are via our vocab mapping\ntokens = [tokenizer.vocab[i] for i in ids] # tokens = [\"not\", \"all\", \"heroes\", \"wear\"]\n\n# the decode() method converts back a list[int] -> str\ntext = tokenizer.decode(ids) # text = \"not all heroes wear\"","position":{"start":{"line":1,"column":1},"end":{"line":17,"column":1}},"key":"MusPi3dSUB"}],"key":"orBA6l3ijh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In short:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IOR2dj9dzL"}],"key":"GUeP57h9z8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We have a string.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jD72kqzmgJ"}],"key":"wswMd4zv1n"}],"key":"EcLptcRJZy"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We use a tokenizer to break it down into smaller pieces called tokens.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dY9ns38l18"}],"key":"FGnbNeKDkb"}],"key":"JLXiFfgB3c"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We use a vocabulary to map those tokens to integers.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"N1XuZaIZOT"}],"key":"qryy8JdsQl"}],"key":"xQ5NELQlrj"}],"key":"ccQN49Edp8"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"In practice, we use more advanced methods of tokenization than simply splitting by whitespace, such as ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RdVkns0IqY"},{"type":"link","url":"https://huggingface.co/course/chapter6/5?fw=pt","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Byte-Pair Encoding","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"PRCSdwGpIz"}],"urlSource":"https://huggingface.co/course/chapter6/5?fw=pt","key":"z371x5t5S6"},{"type":"text","value":" or ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AVs5fnvaJg"},{"type":"link","url":"https://huggingface.co/course/chapter6/6?fw=pt","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"WordPiece","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CBN5zpUlPG"}],"urlSource":"https://huggingface.co/course/chapter6/6?fw=pt","key":"J8trBM6m15"},{"type":"text","value":", but the principle is the same:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"DMUUcAZPzl"}],"key":"bXyMGitdzo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"There is a ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wkcoDlRnb6"},{"type":"inlineCode","value":"vocab","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BOmJL4JeB8"},{"type":"text","value":" that maps string tokens to integer indices","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"HlcLKbA8jS"}],"key":"ijMrsMgdmW"}],"key":"uYd11CUGXN"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"There is an ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Cxb8ksDDUW"},{"type":"inlineCode","value":"encode","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Cd78OdBpKN"},{"type":"text","value":" method that converts ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"A9D7Ov9zlu"},{"type":"inlineCode","value":"str -> list[int]","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"plSwDmQWJY"}],"key":"AYrLSpuRyc"}],"key":"lIMMvg6Aij"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"There is a ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"QJkpPajeKD"},{"type":"inlineCode","value":"decode","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"aKNVbnonHz"},{"type":"text","value":" method that converts ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"adl10rwpd2"},{"type":"inlineCode","value":"list[int] -> str","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"utTAKpP5u1"}],"key":"Qqj93d67Ar"}],"key":"rd8CvV8HaO"}],"key":"mVkZXWjDIs"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"xdQ94kKdH5"}],"key":"SdYgFFMOL1"},{"type":"text","value":": For certain applications, the tokenizer doesn’t require a decode method. For example, if you want to classify if a movie review is saying the movie was good or bad, you only need to be able to encode the text and do a forward pass of the model, there is no need for decode. For generating text however, decode is a requirement. ↩︎","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"SBNWXCALRc"}],"key":"bCG9fu9ina"}],"key":"ls8GxP6HqK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Output","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OUgeAHaXtM"}],"identifier":"output","label":"Output","html_id":"output","implicit":true,"key":"d9a0dPbWiT"}],"key":"GLhz2rJm12"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The output is a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GQE09yiUNq"},{"type":"inlineMath","value":"2D","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">2D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span></span>","key":"ZlVlJXy3NU"},{"type":"text","value":" array, where ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rc6FZfp2U7"},{"type":"inlineCode","value":"output[i][j]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZU8NB3Byot"},{"type":"text","value":" is the model’s predicted probability that the token at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QRGhl5MzhC"},{"type":"inlineCode","value":"vocab[j]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IGQqMbrU9L"},{"type":"text","value":" is the next token ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tz0Hmbs9v8"},{"type":"inlineCode","value":"inputs[i+1]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xQX23awMqt"},{"type":"text","value":". For example:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o4jHJk2lvo"}],"key":"PkV6xTmus1"}],"key":"ZPhFZVpJuh"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"vocab = [\"all\", \"not\", \"heroes\", \"the\", \"wear\", \".\", \"capes\"]\ninputs = [1, 0, 2, 4] # \"not\" \"all\" \"heroes\" \"wear\"\noutput = gpt(inputs)\n#              [\"all\", \"not\", \"heroes\", \"the\", \"wear\", \".\", \"capes\"]\n# output[0] =  [0.75    0.1     0.0       0.15    0.0   0.0    0.0  ]\n# given just \"not\", the model predicts the word \"all\" with the highest probability\n\n#              [\"all\", \"not\", \"heroes\", \"the\", \"wear\", \".\", \"capes\"]\n# output[1] =  [0.0     0.0      0.8     0.1    0.0    0.0   0.1  ]\n# given the sequence [\"not\", \"all\"], the model predicts the word \"heroes\" with the highest probability\n\n#              [\"all\", \"not\", \"heroes\", \"the\", \"wear\", \".\", \"capes\"]\n# output[-1] = [0.0     0.0     0.0     0.1     0.0    0.05  0.85  ]\n# given the whole sequence [\"not\", \"all\", \"heroes\", \"wear\"], the model predicts the word \"capes\" with the highest probability","position":{"start":{"line":1,"column":1},"end":{"line":16,"column":1}},"key":"EAU4aIKDGB"}],"key":"LtHSUucEYF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To get a next token prediction for the whole sequence, we simply take the token with the highest probability in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZvcunSEFJo"},{"type":"inlineCode","value":"output[-1]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EVhrfYLn2l"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"atBRFFRSr9"}],"key":"R06np7nriH"}],"key":"mhvUuJQESi"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"vocab = [\"all\", \"not\", \"heroes\", \"the\", \"wear\", \".\", \"capes\"]\ninputs = [1, 0, 2, 4] # \"not\" \"all\" \"heroes\" \"wear\"\noutput = gpt(inputs)\nnext_token_id = np.argmax(output[-1]) # next_token_id = 6\nnext_token = vocab[next_token_id] # next_token = \"capes\"","position":{"start":{"line":1,"column":1},"end":{"line":7,"column":1}},"key":"GETFYa4ECk"}],"key":"GNu6LdPS0h"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Taking the token with the highest probability as our prediction is known as ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y3aBMQZ8Ve"},{"type":"link","url":"https://docs.cohere.ai/docs/controlling-generation-with-top-k-top-p#1-pick-the-top-token-greedy-decoding","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"greedy decoding","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XsimpWtAdV"}],"urlSource":"https://docs.cohere.ai/docs/controlling-generation-with-top-k-top-p#1-pick-the-top-token-greedy-decoding","key":"ij36bqfv8b"},{"type":"text","value":" or greedy sampling. The task of predicting the next logical word in a sequence is called language modeling. As such, we can call a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FJPt4FZXtb"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wsRwrYDBfi"}],"key":"BW5N8Rw9KN"},{"type":"text","value":" a language model. Generating a single word is cool and all, but what about entire sentences, paragraphs, etc ...?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oruOtBJZ7Y"}],"key":"QYazo205EY"}],"key":"FxMyiKJbAA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generating text","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"s6IBPDiz5u"}],"identifier":"generating-text","label":"Generating text","html_id":"generating-text","implicit":true,"key":"VTEQd9a4Ng"}],"key":"HhFTtWSBHg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Autoregressive","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OFHmFbajZy"}],"identifier":"autoregressive","label":"Autoregressive","html_id":"autoregressive","implicit":true,"key":"zLFvNRFvg2"}],"key":"UlTRywfwZR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can generate full sentences by iteratively getting the next token prediction from our model. At each iteration, we append the predicted token back into the input:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nPiBtmJBY5"}],"key":"hmi7OEwOzi"}],"key":"SZqC8ixh0t"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"def generate(inputs, n_tokens_to_generate):\n    for _ in range(n_tokens_to_generate): # auto-regressive decode loop\n        output = gpt(inputs) # model forward pass\n        next_id = np.argmax(output[-1]) # greedy sampling\n        inputs.append(int(next_id)) # append prediction to input\n    return inputs[len(inputs) - n_tokens_to_generate :]  # only return generated ids\n\ninput_ids = [1, 0] # \"not\" \"all\"\noutput_ids = generate(input_ids, 3) # output_ids = [2, 4, 6]\noutput_tokens = [vocab[i] for i in output_ids] # \"heroes\" \"wear\" \"capes\"","position":{"start":{"line":1,"column":1},"end":{"line":12,"column":1}},"key":"FSJEQC9EOJ"}],"key":"AJ2rSaCVz5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This process of predicting a future value (regression), and adding it back into the input (auto), is why you might see a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B2qbLOaDrC"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t2A8BSifAR"}],"key":"uX6Ri5pH4K"},{"type":"text","value":" described as autoregressive.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HJNzob58xC"}],"key":"Ag4xhEl1IM"}],"key":"HJJg9fKGFJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Sampling","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uzW1bgSdXG"}],"identifier":"sampling","label":"Sampling","html_id":"sampling","implicit":true,"key":"BZDg5wkS9c"}],"key":"SuV3Mv5k9N"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can introduce some stochasticity (randomness) to our generations by sampling from the probability distribution instead of being greedy:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wFNWNxpTiu"}],"key":"YT0GbjqRk7"}],"key":"FKP6WEFY1Z"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"inputs = [1, 0, 2, 4] # \"not\" \"all\" \"heroes\" \"wear\"\noutput = gpt(inputs)\nnp.random.choice(np.arange(vocab_size), p=output[-1]) # capes\nnp.random.choice(np.arange(vocab_size), p=output[-1]) # hats\nnp.random.choice(np.arange(vocab_size), p=output[-1]) # capes\nnp.random.choice(np.arange(vocab_size), p=output[-1]) # capes\nnp.random.choice(np.arange(vocab_size), p=output[-1]) # pants","position":{"start":{"line":1,"column":1},"end":{"line":9,"column":1}},"key":"oy0UvRbg1a"}],"key":"D1VtxE5vic"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This allows us to generate different sentences given the same input. When combined with techniques like ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OdHvVK9bic"},{"type":"link","url":"https://docs.cohere.ai/docs/controlling-generation-with-top-k-top-p#2-pick-from-amongst-the-top-tokens-top-k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"top-k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jTooHIGJy8"}],"urlSource":"https://docs.cohere.ai/docs/controlling-generation-with-top-k-top-p#2-pick-from-amongst-the-top-tokens-top-k","key":"qppa2yt1PH"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DHNGmbHBBl"},{"type":"link","url":"https://docs.cohere.ai/docs/controlling-generation-with-top-k-top-p#3-pick-from-amongst-the-top-tokens-whose-probabilities-add-up-to-15-top-p","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"top-p","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J628H3w9kO"}],"urlSource":"https://docs.cohere.ai/docs/controlling-generation-with-top-k-top-p#3-pick-from-amongst-the-top-tokens-whose-probabilities-add-up-to-15-top-p","key":"pfICwJWYh9"},{"type":"text","value":", and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZbhH5Bt9WY"},{"type":"link","url":"https://docs.cohere.ai/docs/temperature","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"temperature","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DsP9jVOcq9"}],"urlSource":"https://docs.cohere.ai/docs/temperature","key":"IhW0mJGesg"},{"type":"text","value":", which modify the distribution prior to sampling, the quality of our outputs is greatly increased. These techniques also introduce some hyperparameters that we can play around with to get different generation behaviors (for example, increasing temperature makes our model take more risks and thus be more “creative”.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LERtDxqXSw"}],"key":"LSSdbioHhQ"}],"key":"ridya3oJ4D"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Training","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ov45zUnqoa"}],"identifier":"training","label":"Training","html_id":"training","implicit":true,"key":"Qy8hIKvneJ"}],"key":"PeRnJb2a7y"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We train a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z9bNTk1uKa"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eCTUbvLpJZ"}],"key":"h7sB7Yg7M8"},{"type":"text","value":" like any other ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YbLGtrXqSF"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uiFRa7zjuK"}],"key":"QQodjXui5H"},{"type":"text","value":", using gradient descent ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RHdMnIhIeB"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"w.r.t.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KiGlbgYRBf"}],"key":"Wys0jzJmtd"},{"type":"text","value":" some ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zYNC7WXsLr"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vINmQ1BqFw"}],"key":"Gz4KBdYwL6"},{"type":"text","value":" function. In the case of a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zhWcg2RB6T"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OPAjn00hMz"}],"key":"cRxZo3w4Gi"},{"type":"text","value":", we take the cross entropy ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nPLQyECADU"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iNIERHxlJL"}],"key":"cVJg6BnEYe"},{"type":"text","value":" over the language modeling task:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iNGrYedRlm"}],"key":"VfYKsnYp8X"}],"key":"YR882TUiSS"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"def lm_loss(inputs: list[int], params) -> float:\n    # the labels y are just the input shifted 1 to the left\n    #\n    # inputs = [not,     all,   heros,   wear,   capes]\n    #      x = [not,     all,   heroes,  wear]\n    #      y = [all,  heroes,     wear,  capes]\n    #\n    # of course, we don't have a label for inputs[-1], so we exclude it from x\n    #\n    # as such, for N inputs, we have N - 1 language modeling example pairs\n    x, y = inputs[:-1], inputs[1:] # both have shape [num_tokens_in_seq - 1]\n\n    # forward pass\n    # all the predicted next token probability distributions at each position\n    output = gpt(x, params) # has shape [num_tokens_in_seq - 1, num_tokens_in_vocab]\n\n    # cross entropy loss\n    # we take the average over all N-1 examples\n    loss = np.mean(-np.log(output[np.arange(len(output)), y]))\n\n    return loss\n\ndef train(texts: list[list[str]], params) -> float:\n    for text in texts:\n        inputs = tokenizer.encode(text)\n        loss = lm_loss(inputs, params)\n        gradients = compute_gradients_via_backpropagation(loss, params)\n        params = gradient_descent_update_step(gradients, params)\n    return params","position":{"start":{"line":1,"column":1},"end":{"line":31,"column":1}},"key":"jfDgE01V21"}],"key":"fqlOWcs5QU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This is a heavily simplified training setup, but it illustrates the point. Notice the addition of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N7CnWab1dD"},{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LzBfo6AmBU"},{"type":"text","value":" to our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"siwZYOOeKL"},{"type":"inlineCode","value":"gpt","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I6aVTs1F7W"},{"type":"text","value":" function signature (we left this out in the previous sections for simplicity). During each iteration of the training loop:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PBq0BV87VE"}],"key":"K74s8SPQZd"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We compute the language modeling ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oBnHaVtGxQ"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"N1SNwZlFrJ"}],"key":"n6lZkWyMqh"},{"type":"text","value":" for the given input text example","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fSUhCD4OEs"}],"key":"LzBN8dJSOh"}],"key":"hKIhLhr1wk"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"GpCNxRLEzv"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"FQNtZJJGwt"}],"key":"TSlXdMca48"},{"type":"text","value":" determines our gradients, which we compute via ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"W7kb1iRrXO"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"backprop","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"YFWAkX9GXa"}],"key":"xWW2gGUhB2"}],"key":"FpkbqXj9Jx"}],"key":"TDZKJRxdER"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We use the gradients to update our model parameters such that the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VMVgvpjQUi"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ceVGTvAB2e"}],"key":"VI1lSY30Ua"},{"type":"text","value":" is minimized (gradient descent)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rHB3hBtyOG"}],"key":"DxBgKVfsfi"}],"key":"Z9iQSHVF6i"}],"key":"tOO5bVAvcn"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Notice, we don’t use explicitly labelled data. Instead, we are able to produce the input/label pairs from just the raw text itself. This is referred to as ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"X9szXjG4Gk"},{"type":"link","url":"https://en.wikipedia.org/wiki/Self-supervised_learning","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"self-supervised learning","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JxCc9On24m"}],"urlSource":"https://en.wikipedia.org/wiki/Self-supervised_learning","data":{"page":"Self-supervised_learning","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"ljsXwTd77e"},{"type":"text","value":". Self-supervision enables us to massively scale training data. Just get our hands on as much raw text as possible and throw it at the model. For example, ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WvAqrrm4py"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TbdV5ExmZ7"}],"key":"iw2PJHACw5"},{"type":"text","value":"-3 was trained on 300 billion tokens of text from the internet and books:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KLCK7uGoaw"}],"key":"FBLlwvcZjD"}],"key":"N16GMG7nCS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"table_2.2_gpt3_paper.png\"))","key":"nwc5qBI75y"},{"type":"outputs","id":"uUazLDpW2i6TA-yleEVcR","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a76b56e9630ed69223a51aa05e32ed05","path":"/build/a76b56e9630ed69223a51aa05e32ed05.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"mZsmKOe358"}],"key":"ckWO5iRwnX"}],"key":"LjXxsG4cB7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Of course, you need a sufficiently large model to be able to learn from all this data, which is why ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G6OduE8LUo"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cbTjPu2bIE"}],"key":"wvMOhoSQ3p"},{"type":"text","value":"-3 has 175 billion parameters and probably cost between ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SbViymIuu2"},{"type":"link","url":"https://twitter.com/eturner303/status/1266264358771757057","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"$1m-10m in compute cost to train","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nG6rJYXxL2"}],"urlSource":"https://twitter.com/eturner303/status/1266264358771757057","key":"yNFqQvy2n0"},{"type":"text","value":". This self-supervised training step is called pre-training, since we can reuse the “pre-trained” models weights to further train the model on downstream tasks, such as classifying if a tweet is toxic or not. Pre-trained models are also sometimes called foundation models. Training the model on downstream tasks is called fine-tuning, since the model weights have already been pre-trained to understand language, it’s just being fine-tuned to the specific task at hand. The “pre-training on a general task + fine-tuning on a specific task” strategy is called ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tSTI3sUYqw"},{"type":"link","url":"https://en.wikipedia.org/wiki/Transfer_learning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"transfer learning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"b6Egh25ARx"}],"urlSource":"https://en.wikipedia.org/wiki/Transfer_learning","data":{"page":"Transfer_learning","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"PJheYm03XG"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x5dJYy6TYo"}],"key":"kW7E20Mk9B"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eBh9iIQzr3"}],"key":"z9YjKUykol"},{"type":"text","value":": Although, with the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KbIICT7FLu"},{"type":"link","url":"https://arxiv.org/pdf/2210.11416.pdf","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"InstructGPT","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZqHaFzZOGE"}],"urlSource":"https://arxiv.org/pdf/2210.11416.pdf","key":"x00wsq5VG6"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qBuZxoafbh"},{"type":"link","url":"https://arxiv.org/pdf/2203.15556.pdf","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Chinchilla","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BCJxYAks81"}],"urlSource":"https://arxiv.org/pdf/2203.15556.pdf","key":"vafuPMS6HK"},{"type":"text","value":" papers, we’ve realized that we don’t actually need to train models that big. An optimally trained and instruction fine-tuned ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Qg66VzO3LU"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XKNwchXINe"}],"key":"YyDgXHCilH"},{"type":"text","value":" at 1.3B parameters can outperform ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pWI5aYRjTX"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lYeGgziG2T"}],"key":"HFeuVPXVco"},{"type":"text","value":"-3 at 175B parameters.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jz7JNgOATv"}],"key":"WWWJJkiJJN"}],"key":"bsMBILVop6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prompting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BsPBBHNfqN"}],"identifier":"prompting","label":"Prompting","html_id":"prompting","implicit":true,"key":"XfG9y8Kr3k"}],"key":"eQGXStZBjW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In principle, the original ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H4c85kZIEp"},{"type":"link","url":"https://s3-us-west-2.amazonaws.com/openai-assets/research-covers/language-unsupervised/language_understanding_paper.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Oe4ly1iewc"}],"key":"bxAwkFhnv9"}],"urlSource":"https://s3-us-west-2.amazonaws.com/openai-assets/research-covers/language-unsupervised/language_understanding_paper.pdf","key":"AJ7guJ9COL"},{"type":"text","value":" paper was only about the benefits of pre-training a transformer model for transfer learning. The paper showed that pre-training a 117M ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ea8e8eEAOm"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J8fv1IheN6"}],"key":"bi73XVfjMA"},{"type":"text","value":" achieved state-of-the-art performance on various NLP (natural language processing) tasks when fine-tuned on labelled datasets. It wasn’t until the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dxisPGB7iJ"},{"type":"link","url":"https://d4mucfpksywv.cloudfront.net/better-language-models/language_models_are_unsupervised_multitask_learners.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Wqp27eya31"}],"key":"SDUkSxteQy"},{"type":"text","value":"-2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eKFRzYHoTn"}],"urlSource":"https://d4mucfpksywv.cloudfront.net/better-language-models/language_models_are_unsupervised_multitask_learners.pdf","key":"CcLM9LBtNf"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RRUMHVY0qq"},{"type":"link","url":"https://arxiv.org/abs/2005.14165","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I0ia4DMFxK"}],"key":"wLyIz0TKep"},{"type":"text","value":"-3","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fEL0jV2gX7"}],"urlSource":"https://arxiv.org/abs/2005.14165","key":"YkoXZWByBL"},{"type":"text","value":" papers that we realized a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ORFNlzntzm"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dqkHDAWndW"}],"key":"Sr9oIRGauW"},{"type":"text","value":" model pre-trained on enough data with enough parameters was capable of performing any arbitrary task by itself, no fine-tuning needed. Just prompt the model, perform autoregressive language modeling, and voila, the model magically gives us an appropriate response. This is referred to as in-context learning, because the model is using just the context of the prompt to perform the task. In-context learning can be zero shot, one shot, or few shot:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bKFDQsNWSS"}],"key":"Iv7vJ0fL9V"}],"key":"fo6XG5FJLq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"fig_2.1_gpt3_paper.png\"))","key":"x13OtEZaXA"},{"type":"outputs","id":"N1yKKyMhC6DL5QYGsMwLD","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"601e5b77d2987b0a7552484cf5cc5925","path":"/build/601e5b77d2987b0a7552484cf5cc5925.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"Cl5lXuaJVe"}],"key":"dTrrr4C3NN"}],"key":"tfC0cmfrUE"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generating text given a prompt is also sometimes referred to as conditional generation, since our model is generating some output conditioned on some input. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gq5gLuAxNy"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oa7ZhzkKkT"}],"key":"qIfXODXqU6"},{"type":"text","value":"s are not limited to NLP tasks. You can condition the model on anything you want. For example, you can turn a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SB8GGJxt9g"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BZqf5Bj0Ay"}],"key":"iofyZzKmlf"},{"type":"text","value":" into a chatbot (i.e. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sHnTYR7IEQ"},{"type":"link","url":"https://openai.com/index/chatgpt/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Chat","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m5CVXl6LWs"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yL2H6cbwxi"}],"key":"NKif9bkUG3"}],"urlSource":"https://openai.com/index/chatgpt/","key":"S4pSWpYRdJ"},{"type":"text","value":") by conditioning it on the conversation history. You can also further condition the chatbot to behave a certain way by prepending the prompt with some kind of description (i.e. “You are a chatbot. Be polite, speak in full sentences, don’t say harmful things, etc ...”). Conditioning the model like this can even give your ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"skVYDSmQ2I"},{"type":"link","url":"https://imgur.com/a/AbDFcgk","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"chatbot a persona","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f3G8hm28jb"}],"urlSource":"https://imgur.com/a/AbDFcgk","key":"c4tx88NdJ5"},{"type":"text","value":". This is often referred to as a system prompt. However, this is not robust, you can still ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WbierwmsHm"},{"type":"link","url":"https://twitter.com/zswitten/status/1598380220943593472","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"“jailbreak” the model and make it misbehave","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CmVEYtMsVq"}],"urlSource":"https://twitter.com/zswitten/status/1598380220943593472","key":"c76gq26cUJ"},{"type":"text","value":". With that out of the way, let’s finally get to the actual implementation.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nOtg3PjM71"}],"key":"YbbaP3PUT5"}],"key":"zYiR0foxEf"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tCC0bY1dF6"}],"identifier":"setup","label":"Setup","html_id":"setup","implicit":true,"key":"CJ9D0xKLPH"}],"key":"CYfC01a3xW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s dive right into the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fVn72hFwTx"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"duX7eZaPp0"}],"key":"RFhsYrhhnH"},{"type":"text","value":" implementation. First though, let’s define the necessary functions for downloading the model of our choice and the tokenizer files for  loading ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zv6Ac9E3Bx"},{"type":"inlineCode","value":"encoder","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B4jrR2Bh1y"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GCG4dorjln"},{"type":"inlineCode","value":"hparams","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Pm2bh6qp53"},{"type":"text","value":", and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TlLjapmadg"},{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IFJoo4lfbZ"},{"type":"text","value":" into our code:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tT7A0IBbxN"}],"key":"mOFgV8BIWt"}],"key":"HtaLf2fyZI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\"\"\"Byte pair encoding utilities.\n\nContains the code for OpenAI's BPE Tokenizer, taken straight from their gpt-2 repo: https://github.com/openai/gpt-2/blob/master/src/encoder.py.\n\"\"\"\n\nimport json\nimport os\nfrom functools import lru_cache\nimport regex as re\n\n\n@lru_cache()\ndef bytes_to_unicode():\n    \"\"\"\n    Returns list of utf-8 byte and a corresponding list of unicode strings.\n    The reversible bpe codes work on unicode strings.\n    This means you need a large # of unicode characters in your vocab if you want to avoid UNKs.\n    When you're at something like a 10B token dataset you end up needing around 5K for decent coverage.\n    This is a significant percentage of your normal, say, 32K bpe vocab.\n    To avoid that, we want lookup tables between utf-8 bytes and unicode strings.\n    And avoids mapping to whitespace/control characters the bpe code barfs on.\n    \"\"\"\n    bs = (\n        list(range(ord(\"!\"), ord(\"~\") + 1))\n        + list(range(ord(\"¡\"), ord(\"¬\") + 1))\n        + list(range(ord(\"®\"), ord(\"ÿ\") + 1))\n    )\n    cs = bs[:]\n    n = 0\n    for b in range(2**8):\n        if b not in bs:\n            bs.append(b)\n            cs.append(2**8 + n)\n            n += 1\n    cs = [chr(n) for n in cs]\n    return dict(zip(bs, cs))\n\n\ndef get_pairs(word):\n    \"\"\"Return set of symbol pairs in a word.\n    Word is represented as tuple of symbols (symbols being variable-length strings).\n    \"\"\"\n    pairs = set()\n    prev_char = word[0]\n    for char in word[1:]:\n        pairs.add((prev_char, char))\n        prev_char = char\n    return pairs\n\n\nclass Encoder:\n    def __init__(self, encoder, bpe_merges, errors=\"replace\"):\n        self.encoder = encoder\n        self.decoder = {v: k for k, v in self.encoder.items()}\n        self.errors = errors  # how to handle errors in decoding\n        self.byte_encoder = bytes_to_unicode()\n        self.byte_decoder = {v: k for k, v in self.byte_encoder.items()}\n        self.bpe_ranks = dict(zip(bpe_merges, range(len(bpe_merges))))\n        self.cache = {}\n\n        # Should have added re.IGNORECASE so BPE merges can happen for capitalized versions of contractions\n        self.pat = re.compile(\n            r\"\"\"'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+\"\"\"\n        )\n\n    def bpe(self, token):\n        if token in self.cache:\n            return self.cache[token]\n        word = tuple(token)\n        pairs = get_pairs(word)\n\n        if not pairs:\n            return token\n\n        while True:\n            bigram = min(pairs, key=lambda pair: self.bpe_ranks.get(pair, float(\"inf\")))\n            if bigram not in self.bpe_ranks:\n                break\n            first, second = bigram\n            new_word = []\n            i = 0\n            while i < len(word):\n                try:\n                    j = word.index(first, i)\n                    new_word.extend(word[i:j])\n                    i = j\n                except:\n                    new_word.extend(word[i:])\n                    break\n\n                if word[i] == first and i < len(word) - 1 and word[i + 1] == second:\n                    new_word.append(first + second)\n                    i += 2\n                else:\n                    new_word.append(word[i])\n                    i += 1\n            new_word = tuple(new_word)\n            word = new_word\n            if len(word) == 1:\n                break\n            else:\n                pairs = get_pairs(word)\n        word = \" \".join(word)\n        self.cache[token] = word\n        return word\n\n    def encode(self, text):\n        bpe_tokens = []\n        for token in re.findall(self.pat, text):\n            token = \"\".join(self.byte_encoder[b] for b in token.encode(\"utf-8\"))\n            bpe_tokens.extend(\n                self.encoder[bpe_token] for bpe_token in self.bpe(token).split(\" \")\n            )\n        return bpe_tokens\n\n    def decode(self, tokens):\n        text = \"\".join([self.decoder[token] for token in tokens])\n        text = bytearray([self.byte_decoder[c] for c in text]).decode(\n            \"utf-8\", errors=self.errors\n        )\n        return text\n\n\ndef get_encoder(model_name, models_dir):\n    with open(os.path.join(models_dir, model_name, \"encoder.json\"), \"r\") as f:\n        encoder = json.load(f)\n    with open(\n        os.path.join(models_dir, model_name, \"vocab.bpe\"), \"r\", encoding=\"utf-8\"\n    ) as f:\n        bpe_data = f.read()\n    bpe_merges = [tuple(merge_str.split()) for merge_str in bpe_data.split(\"\\n\")[1:-1]]\n    return Encoder(encoder=encoder, bpe_merges=bpe_merges)","key":"SuZYAJ9KKt"},{"type":"outputs","id":"wVwIkgMG9beevHB6ty3n7","children":[],"key":"qYOAcKEUda"}],"key":"fzlwDkOFW1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\"\"\"GPT-2 utilities.\n\nContains the code to download and load the GPT-2 model weights, tokenizer, and hyperparameters.\n\"\"\"\n\nimport json\nimport os\nimport requests\nimport tensorflow as tf\nfrom tqdm import tqdm\n\n\ndef download_gpt2_files(model_size, model_dir):\n    assert model_size in [\"124M\", \"355M\", \"774M\", \"1558M\"]\n    for filename in [\n        \"checkpoint\",\n        \"encoder.json\",\n        \"hparams.json\",\n        \"model.ckpt.data-00000-of-00001\",\n        \"model.ckpt.index\",\n        \"model.ckpt.meta\",\n        \"vocab.bpe\",\n    ]:\n        url = \"https://openaipublic.blob.core.windows.net/gpt-2/models\"\n        r = requests.get(f\"{url}/{model_size}/{filename}\", stream=True)\n        r.raise_for_status()\n\n        with open(os.path.join(model_dir, filename), \"wb\") as f:\n            file_size = int(r.headers[\"content-length\"])\n            chunk_size = 1000\n            with tqdm(\n                ncols=100,\n                desc=\"Fetching \" + filename,\n                total=file_size,\n                unit_scale=True,\n            ) as pbar:\n                # 1k for chunk_size, since Ethernet packet size is around 1500 bytes\n                for chunk in r.iter_content(chunk_size=chunk_size):\n                    f.write(chunk)\n                    pbar.update(chunk_size)\n\n\ndef load_gpt2_params_from_tf_ckpt(tf_ckpt_path, hparams):\n    import re\n    import numpy as np\n\n    def set_in_nested_dict(d, keys, val):\n        if not keys:\n            return val\n        if keys[0] not in d:\n            d[keys[0]] = {}\n        d[keys[0]] = set_in_nested_dict(d[keys[0]], keys[1:], val)\n        return d\n\n    init_vars = tf.train.list_variables(tf_ckpt_path)\n    params = {\"blocks\": [{} for _ in range(hparams[\"n_layer\"])]}\n    for name, _ in init_vars:\n        array = np.squeeze(tf.train.load_variable(tf_ckpt_path, name))\n        name = name.removeprefix(\"model/\")\n        if name.startswith(\"h\"):\n            m = re.match(r\"h([0-9]+)/(.*)\", name)\n            n = int(m[1])\n            sub_name = m[2]\n            set_in_nested_dict(params[\"blocks\"][n], sub_name.split(\"/\"), array)\n        else:\n            set_in_nested_dict(params, name.split(\"/\"), array)\n\n    return params\n\n\ndef load_encoder_hparams_and_params(model_size, models_dir):\n    assert model_size in [\"124M\", \"355M\", \"774M\", \"1558M\"]\n\n    model_dir = os.path.join(models_dir, model_size)\n    tf_ckpt_path = tf.train.latest_checkpoint(model_dir)\n    if not tf_ckpt_path:  # download files if necessary\n        os.makedirs(model_dir, exist_ok=True)\n        download_gpt2_files(model_size, model_dir)\n        tf_ckpt_path = tf.train.latest_checkpoint(model_dir)\n\n    encoder = get_encoder(model_size, models_dir)\n    hparams = json.load(open(os.path.join(model_dir, \"hparams.json\")))\n    params = load_gpt2_params_from_tf_ckpt(tf_ckpt_path, hparams)\n\n    return encoder, hparams, params","key":"EmJyjRHrxc"},{"type":"outputs","id":"iMNsKJSSA6QH9hT4kA-kE","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-02-18 12:27:24.663897: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered\nWARNING: All log messages before absl::InitializeLog() is called are written to STDERR\nE0000 00:00:1739899644.722397 1472589 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered\nE0000 00:00:1739899644.738680 1472589 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered\n2025-02-18 12:27:24.870881: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.\nTo enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"},"children":[],"key":"oN2GCGaxNC"}],"key":"TgrdwV5iXA"}],"key":"IUvS2Q8ds5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cool. Having defined the necessary utilities, we will now define the prompt and generation functions:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q4itCjtWxR"}],"key":"SmP4SyDw6z"}],"key":"kDWUbDUaba"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\n\ndef gpt2(inputs, wte, wpe, blocks, ln_f, n_head):\n    pass  # TODO: implement this\n\n\ndef generate(inputs, params, n_head, n_tokens_to_generate):\n    for _ in tqdm(\n        range(n_tokens_to_generate), \"generating\"\n    ):  # auto-regressive decode loop\n        logits = gpt2(inputs, **params, n_head=n_head)  # model forward pass\n        next_id = np.argmax(logits[-1])  # greedy sampling\n        inputs.append(int(next_id))  # append prediction to input\n\n    return inputs[len(inputs) - n_tokens_to_generate :]  # only return generated ids\n\n\ndef prompt_gpt(\n    prompt: str,\n    n_tokens_to_generate: int = 40,\n    model_size: str = \"124M\",\n    models_dir: str = \"models\",\n):\n    # load encoder, hparams, and params from the released open-ai gpt-2 files\n    encoder, hparams, params = load_encoder_hparams_and_params(model_size, models_dir)\n    # map numpy arrays to jax arrays if jax is installed (in case saved params contain numpy arrays)\n    if np.__name__ == \"jax.numpy\":\n        import jax.tree_util as jtu\n\n        params = jtu.tree_map(\n            lambda x: np.array(x) if isinstance(x, np.ndarray) else x, params\n        )\n    # encode the input string using the BPE tokenizer\n    input_ids = encoder.encode(prompt)\n    # make sure we are not surpassing the max sequence length of our model\n    assert len(input_ids) + n_tokens_to_generate < hparams[\"n_ctx\"]\n    # generate output ids\n    output_ids = generate(input_ids, params, hparams[\"n_head\"], n_tokens_to_generate)\n    # decode the ids back into a string\n    output_text = encoder.decode(output_ids)\n    return output_text","key":"P2tqJQ1WIz"},{"type":"outputs","id":"ikwW2d11iRJSpFnE90JC2","children":[],"key":"HbWZ2q9zxW"}],"key":"QKtys8QcKw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Breaking down each of the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j3sKMFKWXb"},{"type":"text","value":"4","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pjcAmDNVsi"},{"type":"text","value":" sections:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"srpxMPmt6q"}],"key":"SZxAUcOyg2"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cTlKBpCmxY"},{"type":"inlineCode","value":"gpt2","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"D7B6MuCuXQ"},{"type":"text","value":" function is the actual ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cpnkMsEFNt"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TyIiNip1SI"}],"key":"spwo0JNLYA"},{"type":"text","value":" code we’ll be implementing. You’ll notice that the function signature includes some extra stuff in addition to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rF9UXv2Dwm"},{"type":"inlineCode","value":"inputs","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YNQQZ0btzu"},{"type":"text","value":":","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"n7FHlGi4le"}],"key":"Caq7sKaITK"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"wte","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ixzf1YgsQ5"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jKKGPImEr2"},{"type":"inlineCode","value":"wpe","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ML5BLd2Wlq"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sbZZaCS7Ao"},{"type":"inlineCode","value":"blocks","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pIJSKVk3FO"},{"type":"text","value":", and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g3phwvQTyb"},{"type":"inlineCode","value":"ln_f","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"A6mJ7eU693"},{"type":"text","value":" are the parameters of our model.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"k83HpnBPQx"}],"key":"cuXaWZhwJu"}],"key":"rd6MMX77pz"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"n_head","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LVX5iLzymf"},{"type":"text","value":" is a hyperparameter that is needed during the forward pass.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"gLP5TTAsZQ"}],"key":"WPdnOdVfl7"}],"key":"Gu2gyAVCzY"}],"key":"Yw9YpVFjco"}],"key":"ARw44jWdAW"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CtKCyBQVMw"},{"type":"inlineCode","value":"generate","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pqSHvOvg4g"},{"type":"text","value":" function is the autoregressive decoding algorithm we saw earlier. We use greedy sampling for simplicity. ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PegNnnTfYC"},{"type":"inlineCode","value":"tqdm","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bPANXzUcz1"},{"type":"text","value":" is a progress bar to help us visualize the decoding process as it generates tokens one at a time.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"EK88dYVM93"}],"key":"DBJrvLtMH5"}],"key":"xJMvMw0muz"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"lV3IpmBaT1"},{"type":"inlineCode","value":"prompt_gpt","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"iRXQkoQFeA"},{"type":"text","value":" function handles:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"W8vcavD63Z"}],"key":"etoLMvsrwf"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Loading the tokenizer (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Zn3gEZedRZ"},{"type":"inlineCode","value":"encoder","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CbWExa9pED"},{"type":"text","value":"), model weights (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CF9AJdApG5"},{"type":"inlineCode","value":"params","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"XfBbXFxVTq"},{"type":"text","value":"), and hyperparameters (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VMgjjmeMHS"},{"type":"inlineCode","value":"hparams","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jvm6kPDADc"},{"type":"text","value":")","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jjUgtuZKlA"}],"key":"BcnkUxqGcy"}],"key":"XHSnEfkrEn"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Encoding the input prompt into token IDs using the tokenizer","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"W2QWj8QpGa"}],"key":"eSEjUSOQEQ"}],"key":"vNrFVw9eK0"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Calling the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"hidEqbt17w"},{"type":"inlineCode","value":"generate","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"tqysLCJvYM"},{"type":"text","value":" function","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"DbPswl8FrI"}],"key":"ZKzsoSSnM5"}],"key":"vV7MTCLSj5"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Decoding the output IDs into a string","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"yssHVjJwl8"}],"key":"Ws1B9CTi6l"}],"key":"gw99liCHvp"}],"key":"bjiNu09gD4"}],"key":"O3Kf6THbJn"}],"key":"qy8y20ZsvX"}],"key":"hhbW8SPXnM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Encoder","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vyLL7uu3xm"}],"identifier":"encoder","label":"Encoder","html_id":"encoder","implicit":true,"key":"v2KMt2wjON"}],"key":"n8loO56Yzm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Take a closer look at the following call:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o4nFnnNbuB"}],"key":"ddc8brDzfQ"},{"type":"code","lang":"python","value":"encoder, hparams, params = load_encoder_hparams_and_params(\"124M\", \"models\")","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"QfjbPpdpAQ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This will download the necessary model and tokenizer files into ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"e8hm5wFv8a"},{"type":"inlineCode","value":"models/124M","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pR1qUwOiEP"},{"type":"text","value":" and load ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KS0eCPQmb7"},{"type":"inlineCode","value":"encoder","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TqQLmVGdhR"},{"type":"text","value":", ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"aqCkp2btwD"},{"type":"inlineCode","value":"hparams","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ch90ktBMWY"},{"type":"text","value":", and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ExWAfcn90f"},{"type":"inlineCode","value":"params","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JaXsr34180"},{"type":"text","value":" into our code. Let’s give it a try (may take some minutes, depending on your connection speed):","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dlB2IQheum"}],"key":"xXcYwpSBfN"}],"key":"CUelzOOXob"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"encoder, hparams, params = load_encoder_hparams_and_params(\"124M\", \"models\")","key":"S5ieYrXKcu"},{"type":"outputs","id":"-XQFijTu33lr7yXQI_4Sk","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-02-18 12:27:28.665923: W external/local_xla/xla/tsl/framework/cpu_allocator_impl.cc:83] Allocation of 154389504 exceeds 10% of free system memory.\n"},"children":[],"key":"sa0BJXxEbu"}],"key":"ZlpPTey028"}],"key":"XPX6msH8pZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, let’s encode a prompt and see the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WCx95uQo1q"},{"type":"inlineCode","value":"ids","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q2QjZahysS"},{"type":"text","value":" it returns. Let’s then decode and verify that we get the same prompt back:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HawqKCa35t"}],"key":"uMmVjAuSH3"}],"key":"hcpdbWGxyX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"prompt = \"Not all heroes wear capes.\"\nids = encoder.encode(prompt)\nprint(ids)\nprompt_decoded = encoder.decode(ids)\nprint(prompt_decoded)\nassert prompt == prompt_decoded","key":"Ap9wAFQd4U"},{"type":"outputs","id":"9JL7UYdiKK0mim9VTsQeZ","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[3673, 477, 10281, 5806, 1451, 274, 13]\nNot all heroes wear capes.\n"},"children":[],"key":"sManl4Chdd"}],"key":"bjNTx1pRXD"}],"key":"e5PQj5LmEB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We do, indeed. Cool! Using the vocabulary of the tokenizer (stored in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lQkg40QxKC"},{"type":"inlineCode","value":"encoder.decoder","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e4uRmnIZ3f"},{"type":"text","value":"), we can take a peek at what the actual tokens look like:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"su7s3D5u0A"}],"key":"iSaGMOdt1U"}],"key":"PiVNWIoRUB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"[encoder.decoder[i] for i in ids]","key":"Qu7SpwpGLe"},{"type":"outputs","id":"A7sDxKIQ08-H3AHiAVTIV","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"['Not', 'Ġall', 'Ġheroes', 'Ġwear', 'Ġcap', 'es', '.']","content_type":"text/plain"}}},"children":[],"key":"XKw9eqDcKq"}],"key":"U4mjd1IgFk"}],"key":"E963OS8TEF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Interesting. Notice how sometimes our tokens are words (e.g. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xX0cbaBxfx"},{"type":"inlineCode","value":"Not","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E8CKOt1SmV"},{"type":"text","value":"), sometimes they are words but with a space in front of them (e.g. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TkzlFhIZEY"},{"type":"inlineCode","value":"Ġall","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UlrnJUGY3v"},{"type":"text","value":", the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r8X7Lxyi5s"},{"type":"link","url":"https://github.com/karpathy/minGPT/blob/37baab71b9abea1b76ab957409a1cc2fbfba8a26/mingpt/bpe.py#L22-L33","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Ġ represents a space","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zg1JYEc2tt"}],"urlSource":"https://github.com/karpathy/minGPT/blob/37baab71b9abea1b76ab957409a1cc2fbfba8a26/mingpt/bpe.py#L22-L33","data":{"kind":"file","org":"karpathy","repo":"minGPT","reference":"37baab71b9abea1b76ab957409a1cc2fbfba8a26","file":"mingpt/bpe.py","from":22,"to":33,"raw":"https://raw.githubusercontent.com/karpathy/minGPT/37baab71b9abea1b76ab957409a1cc2fbfba8a26/mingpt/bpe.py"},"internal":false,"protocol":"github","key":"cXQTQerQnR"},{"type":"text","value":"), sometimes there are part of a word (e.g. capes is split into ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EZ4UdxE1rS"},{"type":"inlineCode","value":"Ġcap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q6U6OOle4H"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mRbzCbEQaR"},{"type":"inlineCode","value":"es","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X5Aw5rZdEk"},{"type":"text","value":"), and sometimes they are punctuation (e.g. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ss9Z17DnUG"},{"type":"inlineCode","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x1HlZeUOD6"},{"type":"text","value":"). One nice thing about BPE is that it can encode any arbitrary string. If it encounters something that is not present in the vocabulary, it just breaks it down into substrings it does understand:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H3nx1qVACX"}],"key":"hSfmAI58Y1"}],"key":"AcNhTgUZUh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"[encoder.decoder[i] for i in encoder.encode(\"zjqfl\")]","key":"D0KFbjdQBJ"},{"type":"outputs","id":"XaDNQji87hRz2C9CiYe0W","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"['z', 'j', 'q', 'fl']","content_type":"text/plain"}}},"children":[],"key":"TO912Gnwxa"}],"key":"iBEnpaADAk"}],"key":"eXmFMQ512h"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can also check the size of the vocabulary:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zOFgyCl55E"}],"key":"g5mtFhlGkz"}],"key":"EjHrBK2dpk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"len(encoder.decoder)","key":"t0L46eBmAU"},{"type":"outputs","id":"mQUco7LiuYQC9g3ae24GZ","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"50257","content_type":"text/plain"}}},"children":[],"key":"eU0IP4XBwv"}],"key":"ksFO6NTGDT"}],"key":"Z6qbPHZ1RZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The vocabulary, as well as the byte-pair merges which determines how strings are broken down, is obtained by ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qhVbrwbnFi"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"training","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TpjMN597io"}],"key":"yIxlwxI6D6"},{"type":"text","value":" the tokenizer. When we load the tokenizer, we’re loading the already trained vocab and byte-pair merges from some files, which were downloaded alongside the model files when we ran ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fUw1AZ7T35"},{"type":"inlineCode","value":"load_encoder_hparams_and_params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W1DQsbRCXJ"},{"type":"text","value":". See the files ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"laDgGNDkVo"},{"type":"inlineCode","value":"models/124M/encoder.json","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sCBdl69d6N"},{"type":"text","value":" (the vocabulary) and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZrRTBU7yDh"},{"type":"inlineCode","value":"models/124M/vocab.bpe","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EqBAso9PZV"},{"type":"text","value":" (byte-pair merges).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HPLypGCn7F"}],"key":"Zo6vdDyRPG"}],"key":"SnD2jxQwqD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Hyperparameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Nsumg23AH3"}],"identifier":"hyperparameters","label":"Hyperparameters","html_id":"hyperparameters","implicit":true,"key":"SlRpG9DTGY"}],"key":"HKO97HjNUv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"hparams","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hJuKNxA7TM"},{"type":"text","value":" is a dictionary that contains the hyper-parameters of our model:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p50ZFT3d9W"}],"key":"nn500g23or"}],"key":"k4As2pspDT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hparams","key":"x8hTjugR4A"},{"type":"outputs","id":"E75yd06_lexQSRKgnG_Yh","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"{'n_vocab': 50257, 'n_ctx': 1024, 'n_embd': 768, 'n_head': 12, 'n_layer': 12}","content_type":"text/plain"}}},"children":[],"key":"WZ4AGQ1ClJ"}],"key":"lEC1UjPra1"}],"key":"nMrKC52N8I"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here’s what each key refers to:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Lhuy4fVLke"}],"key":"b9nAg7Tht8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"n_vocab","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Z73N4g2o5O"},{"type":"text","value":": number of tokens in our vocabulary","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"E6WRNkqMHh"}],"key":"iqFO5SUMex"}],"key":"HOUbia5imf"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"n_ctx","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JdCFUwRQrU"},{"type":"text","value":": maximum possible sequence length of the input","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ingN5s97We"}],"key":"MF3xpaQxes"}],"key":"xmA0eamdCQ"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"n_embd","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"FDabudLC8V"},{"type":"text","value":": embedding dimension (determines the “width” of the network)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"viFFGEHwUU"}],"key":"d0fqpo4Kct"}],"key":"v40pibYzEf"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"n_head","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IFQJEzOsCX"},{"type":"text","value":": number of attention heads (n_embd must be divisible by n_head)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"b6MCo2apUh"}],"key":"SqDEo7IKsv"}],"key":"Xq6xxEYsF1"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"n_layer","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"eUmnIYMEVS"},{"type":"text","value":": number of layers (determines the “depth” of the network)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"TULpvrPtx5"}],"key":"rh9FlDKmzw"}],"key":"alJ11p1bpl"}],"key":"HIQObXZeiH"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We’ll use these symbols in our code’s comments to show the underlying shape of things. We’ll also use ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"YJHpCR9mkE"},{"type":"inlineCode","value":"n_seq","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Tp79Kw5XLR"},{"type":"text","value":" to denote the length of our input sequence (i.e. ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"lAp99YT3Wc"},{"type":"inlineCode","value":"n_seq = len(inputs)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"P73rJG8ZEG"},{"type":"text","value":").","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"yajbJuktDQ"}],"key":"M9koViWL8o"}],"key":"CRALWhIco3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P4kcwiin7o"}],"identifier":"parameters","label":"Parameters","html_id":"parameters","implicit":true,"key":"Qv9yoWMiCm"}],"key":"pbI87doaDr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mnyxNF6fvg"},{"type":"text","value":" is a nested json dictionary that hold the trained weights of our model. The leaf nodes of the json are NumPy arrays. If we print ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gzLYZelhRC"},{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lfaewHtH7f"},{"type":"text","value":", replacing the arrays with their shapes, we get:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oJvJ3mOKt4"}],"key":"xBncsTYT4d"}],"key":"LboXMP8zm3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\n\ndef shape_tree(d):\n    if isinstance(d, np.ndarray):\n        return list(d.shape)\n    elif isinstance(d, list):\n        return [shape_tree(v) for v in d]\n    elif isinstance(d, dict):\n        return {k: shape_tree(v) for k, v in d.items()}\n    else:\n        ValueError(\"uh oh\")\n\n\nshape_tree(params)","key":"KnIQJduXXn"},{"type":"outputs","id":"nwf_9dqNECLsnxFY_OhhJ","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"{'blocks': [{'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}},\n  {'attn': {'c_attn': {'b': [2304], 'w': [768, 2304]},\n    'c_proj': {'b': [768], 'w': [768, 768]}},\n   'ln_1': {'b': [768], 'g': [768]},\n   'ln_2': {'b': [768], 'g': [768]},\n   'mlp': {'c_fc': {'b': [3072], 'w': [768, 3072]},\n    'c_proj': {'b': [768], 'w': [3072, 768]}}}],\n 'ln_f': {'b': [768], 'g': [768]},\n 'wpe': [1024, 768],\n 'wte': [50257, 768]}","content_type":"text/plain"}}},"children":[],"key":"VzomOLbXYH"}],"key":"FASrTsyARU"}],"key":"UB5OwSEZIM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"where each dictionary inside the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EdpeQnCG1p"},{"type":"inlineCode","value":"'blocks'","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z0GDtGazeg"},{"type":"text","value":" list contains the weights information for each layer (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m7n4zkjAfJ"},{"type":"inlineCode","value":"n_layers","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SdzxLyloDg"},{"type":"text","value":" total). These weights are loaded from the original OpenAI tensorflow checkpoint:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GlIxrLKUcs"}],"key":"julod1D9pf"}],"key":"qIE0wO9o62"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import tensorflow as tf\n\ntf_ckpt_path = tf.train.latest_checkpoint(\"models/124M\")\nfor name, _ in tf.train.list_variables(tf_ckpt_path):\n    arr = tf.train.load_variable(tf_ckpt_path, name).squeeze()\n    print(f\"{name}: {arr.shape}\")","key":"sLALGf5nVm"},{"type":"outputs","id":"tnc7kmPu_gSMIbi7RELyq","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"model/h0/attn/c_attn/b: (2304,)\nmodel/h0/attn/c_attn/w: (768, 2304)\nmodel/h0/attn/c_proj/b: (768,)\nmodel/h0/attn/c_proj/w: (768, 768)\nmodel/h0/ln_1/b: (768,)\nmodel/h0/ln_1/g: (768,)\nmodel/h0/ln_2/b: (768,)\nmodel/h0/ln_2/g: (768,)\nmodel/h0/mlp/c_fc/b: (3072,)\nmodel/h0/mlp/c_fc/w: (768, 3072)\nmodel/h0/mlp/c_proj/b: (768,)\nmodel/h0/mlp/c_proj/w: (3072, 768)\nmodel/h1/attn/c_attn/b: (2304,)\nmodel/h1/attn/c_attn/w: (768, 2304)\nmodel/h1/attn/c_proj/b: (768,)\nmodel/h1/attn/c_proj/w: (768, 768)\nmodel/h1/ln_1/b: (768,)\nmodel/h1/ln_1/g: (768,)\nmodel/h1/ln_2/b: (768,)\nmodel/h1/ln_2/g: (768,)\nmodel/h1/mlp/c_fc/b: (3072,)\nmodel/h1/mlp/c_fc/w: (768, 3072)\nmodel/h1/mlp/c_proj/b: (768,)\nmodel/h1/mlp/c_proj/w: (3072, 768)\nmodel/h10/attn/c_attn/b: (2304,)\nmodel/h10/attn/c_attn/w: (768, 2304)\nmodel/h10/attn/c_proj/b: (768,)\nmodel/h10/attn/c_proj/w: (768, 768)\nmodel/h10/ln_1/b: (768,)\nmodel/h10/ln_1/g: (768,)\nmodel/h10/ln_2/b: (768,)\nmodel/h10/ln_2/g: (768,)\nmodel/h10/mlp/c_fc/b: (3072,)\nmodel/h10/mlp/c_fc/w: (768, 3072)\nmodel/h10/mlp/c_proj/b: (768,)\nmodel/h10/mlp/c_proj/w: (3072, 768)\nmodel/h11/attn/c_attn/b: (2304,)\nmodel/h11/attn/c_attn/w: (768, 2304)\nmodel/h11/attn/c_proj/b: (768,)\nmodel/h11/attn/c_proj/w: (768, 768)\nmodel/h11/ln_1/b: (768,)\nmodel/h11/ln_1/g: (768,)\nmodel/h11/ln_2/b: (768,)\nmodel/h11/ln_2/g: (768,)\nmodel/h11/mlp/c_fc/b: (3072,)\nmodel/h11/mlp/c_fc/w: (768, 3072)\nmodel/h11/mlp/c_proj/b: (768,)\nmodel/h11/mlp/c_proj/w: (3072, 768)\nmodel/h2/attn/c_attn/b: (2304,)\nmodel/h2/attn/c_attn/w: (768, 2304)\nmodel/h2/attn/c_proj/b: (768,)\nmodel/h2/attn/c_proj/w: (768, 768)\nmodel/h2/ln_1/b: (768,)\nmodel/h2/ln_1/g: (768,)\nmodel/h2/ln_2/b: (768,)\nmodel/h2/ln_2/g: (768,)\nmodel/h2/mlp/c_fc/b: (3072,)\nmodel/h2/mlp/c_fc/w: (768, 3072)\nmodel/h2/mlp/c_proj/b: (768,)\nmodel/h2/mlp/c_proj/w: (3072, 768)\nmodel/h3/attn/c_attn/b: (2304,)\nmodel/h3/attn/c_attn/w: (768, 2304)\nmodel/h3/attn/c_proj/b: (768,)\nmodel/h3/attn/c_proj/w: (768, 768)\nmodel/h3/ln_1/b: (768,)\nmodel/h3/ln_1/g: (768,)\nmodel/h3/ln_2/b: (768,)\nmodel/h3/ln_2/g: (768,)\nmodel/h3/mlp/c_fc/b: (3072,)\nmodel/h3/mlp/c_fc/w: (768, 3072)\nmodel/h3/mlp/c_proj/b: (768,)\nmodel/h3/mlp/c_proj/w: (3072, 768)\nmodel/h4/attn/c_attn/b: (2304,)\nmodel/h4/attn/c_attn/w: (768, 2304)\nmodel/h4/attn/c_proj/b: (768,)\nmodel/h4/attn/c_proj/w: (768, 768)\nmodel/h4/ln_1/b: (768,)\nmodel/h4/ln_1/g: (768,)\nmodel/h4/ln_2/b: (768,)\nmodel/h4/ln_2/g: (768,)\nmodel/h4/mlp/c_fc/b: (3072,)\nmodel/h4/mlp/c_fc/w: (768, 3072)\nmodel/h4/mlp/c_proj/b: (768,)\nmodel/h4/mlp/c_proj/w: (3072, 768)\nmodel/h5/attn/c_attn/b: (2304,)\nmodel/h5/attn/c_attn/w: (768, 2304)\nmodel/h5/attn/c_proj/b: (768,)\nmodel/h5/attn/c_proj/w: (768, 768)\nmodel/h5/ln_1/b: (768,)\nmodel/h5/ln_1/g: (768,)\nmodel/h5/ln_2/b: (768,)\nmodel/h5/ln_2/g: (768,)\nmodel/h5/mlp/c_fc/b: (3072,)\nmodel/h5/mlp/c_fc/w: (768, 3072)\nmodel/h5/mlp/c_proj/b: (768,)\nmodel/h5/mlp/c_proj/w: (3072, 768)\nmodel/h6/attn/c_attn/b: (2304,)\nmodel/h6/attn/c_attn/w: (768, 2304)\nmodel/h6/attn/c_proj/b: (768,)\nmodel/h6/attn/c_proj/w: (768, 768)\nmodel/h6/ln_1/b: (768,)\nmodel/h6/ln_1/g: (768,)\nmodel/h6/ln_2/b: (768,)\nmodel/h6/ln_2/g: (768,)\nmodel/h6/mlp/c_fc/b: (3072,)\nmodel/h6/mlp/c_fc/w: (768, 3072)\nmodel/h6/mlp/c_proj/b: (768,)\nmodel/h6/mlp/c_proj/w: (3072, 768)\nmodel/h7/attn/c_attn/b: (2304,)\nmodel/h7/attn/c_attn/w: (768, 2304)\nmodel/h7/attn/c_proj/b: (768,)\nmodel/h7/attn/c_proj/w: (768, 768)\nmodel/h7/ln_1/b: (768,)\nmodel/h7/ln_1/g: (768,)\nmodel/h7/ln_2/b: (768,)\nmodel/h7/ln_2/g: (768,)\nmodel/h7/mlp/c_fc/b: (3072,)\nmodel/h7/mlp/c_fc/w: (768, 3072)\nmodel/h7/mlp/c_proj/b: (768,)\nmodel/h7/mlp/c_proj/w: (3072, 768)\nmodel/h8/attn/c_attn/b: (2304,)\nmodel/h8/attn/c_attn/w: (768, 2304)\nmodel/h8/attn/c_proj/b: (768,)\nmodel/h8/attn/c_proj/w: (768, 768)\nmodel/h8/ln_1/b: (768,)\nmodel/h8/ln_1/g: (768,)\nmodel/h8/ln_2/b: (768,)\nmodel/h8/ln_2/g: (768,)\nmodel/h8/mlp/c_fc/b: (3072,)\nmodel/h8/mlp/c_fc/w: (768, 3072)\nmodel/h8/mlp/c_proj/b: (768,)\nmodel/h8/mlp/c_proj/w: (3072, 768)\nmodel/h9/attn/c_attn/b: (2304,)\nmodel/h9/attn/c_attn/w: (768, 2304)\nmodel/h9/attn/c_proj/b: (768,)\nmodel/h9/attn/c_proj/w: (768, 768)\nmodel/h9/ln_1/b: (768,)\nmodel/h9/ln_1/g: (768,)\nmodel/h9/ln_2/b: (768,)\nmodel/h9/ln_2/g: (768,)\nmodel/h9/mlp/c_fc/b: (3072,)\nmodel/h9/mlp/c_fc/w: (768, 3072)\nmodel/h9/mlp/c_proj/b: (768,)\nmodel/h9/mlp/c_proj/w: (3072, 768)\nmodel/ln_f/b: (768,)\nmodel/ln_f/g: (768,)\nmodel/wpe: (1024, 768)\nmodel/wte: (50257, 768)\n"},"children":[],"key":"AS877g9Iyr"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-02-18 12:27:29.143545: W external/local_xla/xla/tsl/framework/cpu_allocator_impl.cc:83] Allocation of 154389504 exceeds 10% of free system memory.\n"},"children":[],"key":"UnRJ8ZH9MW"}],"key":"wOes2AUcEt"}],"key":"gTPAi8Zh51"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LtLtdQQUGQ"},{"type":"inlineCode","value":"load_gpt2_params_from_tf_ckpt","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AVFiwZsaBb"},{"type":"text","value":" function converts the above tensorflow variables into our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OhFkxczT6D"},{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tqcM9u2WFs"},{"type":"text","value":" dictionary. For reference, here’s the shapes of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mvYT7TlQ8h"},{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vxmagTPLSb"},{"type":"text","value":" but with the numbers replaced by the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"R3twxCKRrt"},{"type":"inlineCode","value":"hparams","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IlvLl75GRi"},{"type":"text","value":" they represent:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fOVpjqB5CM"}],"key":"L9DVSVNnA9"}],"key":"nEaRRML7a0"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"{\n    \"wpe\": [n_ctx, n_embd],\n    \"wte\": [n_vocab, n_embd],\n    \"ln_f\": {\"b\": [n_embd], \"g\": [n_embd]},\n    \"blocks\": [\n        {\n            \"attn\": {\n                \"c_attn\": {\"b\": [3*n_embd], \"w\": [n_embd, 3*n_embd]},\n                \"c_proj\": {\"b\": [n_embd], \"w\": [n_embd, n_embd]},\n            },\n            \"ln_1\": {\"b\": [n_embd], \"g\": [n_embd]},\n            \"ln_2\": {\"b\": [n_embd], \"g\": [n_embd]},\n            \"mlp\": {\n                \"c_fc\": {\"b\": [4*n_embd], \"w\": [n_embd, 4*n_embd]},\n                \"c_proj\": {\"b\": [n_embd], \"w\": [4*n_embd, n_embd]},\n            },\n        },\n        ... # repeat for n_layers\n    ]\n}","position":{"start":{"line":1,"column":1},"end":{"line":22,"column":1}},"key":"wcPdbLJC07"}],"key":"KG78bSADgK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You’ll probably want to come back to reference this dictionary to check the shape of the weights as we implement our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AukLAZQhGz"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KwGLvL4EWN"}],"key":"g2Ri3njS5C"},{"type":"text","value":". We’ll match the variable names in our code with the keys of this dictionary for consistency.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UEwvdlqPhy"}],"key":"wzLmNd8GRg"}],"key":"XmWu0KAR1D"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Basic Layers","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D8rPU7wkhy"}],"identifier":"basic-layers","label":"Basic Layers","html_id":"basic-layers","implicit":true,"key":"NQFM8zJXRf"}],"key":"dTB27YUN3y"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Last thing before we get into the actual ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i3yqUM1hk6"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IFPHg9NwTy"}],"key":"mqHQoeN3Sr"},{"type":"text","value":" architecture itself, let’s implement some of the more basic ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I4sBDBWa0u"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vvxm7mf9gZ"}],"key":"p8Kyz8r2OI"},{"type":"text","value":" layers that are non-specific to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mZ3WgdPML9"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nR8e1gwCR1"}],"key":"NXxRZNR8jL"},{"type":"text","value":"s.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nAR50wLZQk"}],"key":"OC1UC3k3JL"}],"key":"vQkLmnSYDv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GELU","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"arBRdsZYXT"}],"identifier":"gelu","label":"GELU","html_id":"gelu","implicit":true,"key":"sunaGl3w32"}],"key":"jgCLjFgggh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The non-linearity (activation function) of choice for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cNOjafkis7"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n4Hh9kXxAb"}],"key":"i8JQnTbGdh"},{"type":"text","value":"-2 is GELU (Gaussian Error Linear Units), an alternative for ReLU:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TPk5u4VsVD"}],"key":"WhXrxMHhdQ"}],"key":"aHPUTy5vHN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"fig_1_from_gelu_paper.png\"))","key":"A1ngh70tdu"},{"type":"outputs","id":"2WVvbqnls3S1DG9W4eeVN","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bf801b993f69576d9a242672d2ba329c","path":"/build/bf801b993f69576d9a242672d2ba329c.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"n2kJ0gTRUu"}],"key":"rwDoUEvNu5"}],"key":"k12MR4BXgW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It is approximated by the following function:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z1GVH2kqOq"}],"key":"T9bUdWRthP"}],"key":"n0vCogf9bG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def gelu(x):\n    return 0.5 * x * (1 + np.tanh(np.sqrt(2 / np.pi) * (x + 0.044715 * x**3)))","key":"l9b3cdoOui"},{"type":"outputs","id":"NOnbYCbCtqBawfbfhyKlJ","children":[],"key":"fcQnNWM12D"}],"key":"n1Deqdxr56"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Like ReLU, GELU operates element-wise on the input:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IdZ0jynnZr"}],"key":"n1AawEK2j6"}],"key":"zr9raea8So"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gelu(np.array([[1, 2], [-2, 0.5]]))","key":"ynPXJhlebK"},{"type":"outputs","id":"uiHeoVZGtthcY87gcFwNE","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":17,"metadata":{},"data":{"text/plain":{"content":"array([[ 0.84119199,  1.95459769],\n       [-0.04540231,  0.34571401]])","content_type":"text/plain"}}},"children":[],"key":"IYwhL6A4po"}],"key":"dW9lVcX7IQ"}],"key":"RbRbmp9XLF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Softmax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UHvCqCnUXo"}],"identifier":"softmax","label":"Softmax","html_id":"softmax","implicit":true,"key":"qkWKPRi33B"}],"key":"BTfAEgiiTq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Good ole ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cioL4C9Gr2"},{"type":"link","url":"https://en.wikipedia.org/wiki/Softmax_function","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"softmax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HcUEtoXVpK"}],"urlSource":"https://en.wikipedia.org/wiki/Softmax_function","data":{"page":"Softmax_function","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"PeOnkkCrwF"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZjSkvYs6sG"}],"key":"WJlWaTLisj"}],"key":"dujmDWzMe6"},{"type":"block","kind":"notebook-content","children":[{"type":"math","value":"\\text{softmax}(x_i) = \\frac{e^{x_i}}{\\sum_j e^{x_j}}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>x</mi><mi>i</mi></msub></msup><mrow><munder><mo>∑</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>x</mi><mi>j</mi></msub></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\text{softmax}(x_i) = \\frac{e^{x_i}}{\\sum_j e^{x_j}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4632em;vertical-align:-1.1218em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3414em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.162em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4358em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6065em;\"><span style=\"top:-3.0051em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1218em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"1","key":"F51kliKwQc"}],"key":"GDdbipJnxL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def softmax(x):\n    exp_x = np.exp(x - np.max(x, axis=-1, keepdims=True))\n    return exp_x / np.sum(exp_x, axis=-1, keepdims=True)","key":"ZTA1t0X9A1"},{"type":"outputs","id":"k4VYHymTilFroqGQGg9gz","children":[],"key":"lKJbO2lXlP"}],"key":"Mt0lVjQdUD"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vHVUYx4RU1"},{"type":"link","url":"https://jaykmody.com/blog/stable-softmax/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"max(x) trick for numerical stability","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"la7p3LuXDR"}],"urlSource":"https://jaykmody.com/blog/stable-softmax/","key":"B41wXIYA0O"},{"type":"text","value":". Softmax is used to a convert set of real numbers (between ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cw38CMesFU"},{"type":"inlineMath","value":"-\\infty","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">-\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">∞</span></span></span></span>","key":"k9MAC5BHST"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j19sVdIjTP"},{"type":"inlineMath","value":"\\infty","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord\">∞</span></span></span></span>","key":"VBUpbGJ4GE"},{"type":"text","value":") to probabilities (between ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xdxvNtt7OO"},{"type":"text","value":"0","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bqXND6hNNg"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LlrU2pbcEs"},{"type":"text","value":"1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H87nM4VKwx"},{"type":"text","value":", with the numbers all summing to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KRg0e3w6dk"},{"type":"text","value":"1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VB2ecSUUGW"},{"type":"text","value":"). We apply ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CcOHJXtyLe"},{"type":"inlineCode","value":"softmax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QTH3rkz4pK"},{"type":"text","value":" over the last axis of the input.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qPuGtuFEuW"}],"key":"on6vnfrNtH"}],"key":"JerKJvKemm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = softmax(np.array([[2, 100], [-5, 0]]))\nx","key":"lWvyEymOaf"},{"type":"outputs","id":"AYBxdhiMHuFNKPGthlr3X","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"array([[2.74878501e-43, 1.00000000e+00],\n       [6.69285092e-03, 9.93307149e-01]])","content_type":"text/plain"}}},"children":[],"key":"zhDpnexhOb"}],"key":"h7BDDbbYf4"}],"key":"AGL6SUQpAq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x.sum(axis=-1)","key":"TcwWfZIWAL"},{"type":"outputs","id":"s_RP5v1tYT2LakHrZJRuk","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"array([1., 1.])","content_type":"text/plain"}}},"children":[],"key":"kaTtiEn3By"}],"key":"eQuFPHlJhA"}],"key":"Iq1r1u3K0i"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Layer Normalization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PWToxTcQcu"}],"identifier":"layer-normalization","label":"Layer Normalization","html_id":"layer-normalization","implicit":true,"key":"DAjxZ34fRA"}],"key":"fozfKQKnUU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"link","url":"https://arxiv.org/pdf/1607.06450.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Layer normalization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rLE4ghbFq6"}],"urlSource":"https://arxiv.org/pdf/1607.06450.pdf","key":"kBI7uzwggl"},{"type":"text","value":" standardizes values to have a mean of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oP47kADS2x"},{"type":"inlineCode","value":"0","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jXfR9SvYar"},{"type":"text","value":" and a variance of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gj4WmPzlpt"},{"type":"inlineCode","value":"1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rNuQonM11B"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ddjoHbca4I"}],"key":"VWXGB4oGR0"},{"type":"math","value":"\\text{LayerNorm}(x) = \\gamma\\cdot\\frac{x - \\mu}{\\sigma} + \\beta","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>LayerNorm</mtext><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>γ</mi><mo>⋅</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo>+</mo><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\text{LayerNorm}(x) = \\gamma\\cdot\\frac{x - \\mu}{\\sigma} + \\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">LayerNorm</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.9463em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">μ</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span></span>","enumerator":"2","key":"gLjucGfx1U"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jyGJ2yk2E2"},{"type":"inlineMath","value":"\\mu","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>μ</mi></mrow><annotation encoding=\"application/x-tex\">\\mu</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">μ</span></span></span></span>","key":"nTCNnENSEH"},{"type":"text","value":" is the mean of ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ucGyNnNjS8"},{"type":"inlineMath","value":"x","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"hOYby8bo0X"},{"type":"text","value":", ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Obw8JwAhR7"},{"type":"inlineMath","value":"\\sigma^2","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\sigma^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>","key":"Lw7fLGHjRs"},{"type":"text","value":" is the variance of ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CI5R0zrPFJ"},{"type":"inlineMath","value":"x","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"vjIfPJk0c7"},{"type":"text","value":", and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZcDSQ3ERGa"},{"type":"inlineMath","value":"\\gamma","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>","key":"bwYlOLFd4m"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mBFfpBAyf7"},{"type":"inlineMath","value":"\\beta","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span>","key":"Ghr2HWwM2L"},{"type":"text","value":" are learnable parameters.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eoYvbNKyW7"}],"key":"cAuUTuIbwO"}],"key":"MAZ2sLCuOH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def layer_norm(x, g, b, eps: float = 1e-5):\n    mean = np.mean(x, axis=-1, keepdims=True)\n    variance = np.var(x, axis=-1, keepdims=True)\n    x = (x - mean) / np.sqrt(\n        variance + eps\n    )  # normalize x to have mean=0 and var=1 over last axis\n    return g * x + b  # scale and offset with gamma/beta params","key":"Ye2v2goi2t"},{"type":"outputs","id":"kGh3upU_j4jh-YI7trBQl","children":[],"key":"S4bR4fVxx7"}],"key":"ithrn99vsM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Layer normalization ensures that the inputs for each layer are always within a consistent range, which is supposed to speed up and stabilize the training process. Like ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Rhp6MGui8d"},{"type":"link","url":"https://arxiv.org/pdf/1502.03167.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"batchnorm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"InpBFSq0Fz"}],"key":"BLGtHZsa1E"}],"urlSource":"https://arxiv.org/pdf/1502.03167.pdf","key":"ciyqsOPFgP"},{"type":"text","value":", the normalized output is then scaled and offset with two learnable vectors ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AcIQbRBIQu"},{"type":"inlineMath","value":"\\gamma","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>","key":"qXjsvlOiPv"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VWAsAgqT9u"},{"type":"inlineMath","value":"\\beta","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span>","key":"GsrN1uwFsW"},{"type":"text","value":". The small epsilon term in the denominator (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q6uXQyZgvR"},{"type":"inlineCode","value":"eps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AoWsOSj6mt"},{"type":"text","value":") is used to avoid a division by zero error. Layer norm is used instead of batch norm in the transformer for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sQ33bbNVnq"},{"type":"link","url":"https://stats.stackexchange.com/questions/474440/why-do-transformers-use-layer-norm-instead-of-batch-norm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"various reasons","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QqOsNYhN5P"}],"urlSource":"https://stats.stackexchange.com/questions/474440/why-do-transformers-use-layer-norm-instead-of-batch-norm","key":"QZxK8VOwiF"},{"type":"text","value":". The differences between various normalization techniques is outlined in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cKQRaKpGBr"},{"type":"link","url":"https://tungmphung.com/deep-learning-normalization-methods/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"this excellent blog post","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zZMtsRSC5Q"}],"urlSource":"https://tungmphung.com/deep-learning-normalization-methods/","key":"CcXQzUtsxn"},{"type":"text","value":". We apply layer normalization over the last axis of the input:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wvRmXK9eRJ"}],"key":"knNE64Ir1V"}],"key":"hHQRGk9BDB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = np.array([[2, 2, 3], [-5, 0, 1]])\nx = layer_norm(x, g=np.ones(x.shape[-1]), b=np.zeros(x.shape[-1]))\nprint(x)\nprint(\"var:\", x.var(axis=-1))  # yields floating point shenanigans\nprint(\"mean:\", x.mean(axis=-1))  # same here","key":"M6g4DVb0eY"},{"type":"outputs","id":"o60aLtrsGAojJndmyckYG","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[[-0.70709087 -0.70709087  1.41418174]\n [-1.39700038  0.50800014  0.88900024]]\nvar: [0.999955   0.99999855]\nmean: [-2.96059473e-16 -3.70074342e-17]\n"},"children":[],"key":"PROBuQyiyr"}],"key":"b7y9SgGvJw"}],"key":"PhSUBLUXN2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Linear","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FTlOGXNWaV"}],"identifier":"linear","label":"Linear","html_id":"linear","implicit":true,"key":"KaKxDor0bF"}],"key":"eRkxbVLJM7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Your standard matrix multiplication + bias:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bWlK1V8iWy"}],"key":"m4PrO4EdHS"}],"key":"LH0d2gPoT1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def linear(x, w, b):  # [m, in], [in, out], [out] -> [m, out]\n    return x @ w + b","key":"nFPM5tvoMR"},{"type":"outputs","id":"MKEIC4Opcuqxk9ELGbtBa","children":[],"key":"o5w0Wf0uxZ"}],"key":"UmjEdxqmWP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Linear layers are often referred to as projections (since they are projecting from one vector space to another vector space):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jVRHxGhqh8"}],"key":"mLfMMooRel"}],"key":"ixTzMYWzGg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = np.random.normal(size=(64, 784))  # input dim = 784, batch/sequence dim = 64\nw = np.random.normal(size=(784, 10))  # output dim = 10\nb = np.random.normal(size=(10,))\nprint(x.shape)  # shape before linear projection\nprint(linear(x, w, b).shape)  # shape after linear projection","key":"sLWjNf1LFj"},{"type":"outputs","id":"jaZc_ebuka6a-tCfWKtr2","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"(64, 784)\n(64, 10)\n"},"children":[],"key":"HOrhATwnF2"}],"key":"zkBZ1x5I38"}],"key":"jgdBGrrkFf"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ic9qpkNCsa"}],"key":"fbyTLKiJPk"},{"type":"text","value":" Architecture","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m2h4ENiHZj"}],"identifier":"gpt-architecture","label":"GPT Architecture","html_id":"gpt-architecture","implicit":true,"key":"STrZ4cnE9W"}],"key":"sp4j7bUUXD"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"olBWXt05Wu"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QROfaXQdNX"}],"key":"V8WsikEQqC"},{"type":"text","value":" architecture follows that of the transformer:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aeIHjBvywy"}],"key":"Ql69EFGQZS"}],"key":"mgzcJPbkrv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"fig_1_from_attention_is_all_you_need_paper.png\"))","key":"JuZfJBQZIC"},{"type":"outputs","id":"woGXkyRjIO5KFsqxK3OiN","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"95a2359853165c9eef927e4a752c43f9","path":"/build/95a2359853165c9eef927e4a752c43f9.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"WCxyPKfzMk"}],"key":"msX1fwolwc"}],"key":"SIuVj9Z1DM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"But uses only the decoder stack (the right part of the diagram):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xU02Tfdyg0"}],"key":"bRs9oeXsuM"}],"key":"DJbloqDnoe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"transformer_decoder_stack.png\"))","key":"YpHs8E69Q8"},{"type":"outputs","id":"J7ILbl5-RacWKtsla_l69","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1b391e61efa306561ab221327072a6f1","path":"/build/1b391e61efa306561ab221327072a6f1.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"xKlV4AJviw"}],"key":"IIpesaJwsP"}],"key":"RYUL2v4RL3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Note, the middle “cross-attention” layer is also removed since we got rid of the encoder. At a high level, the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"svOpZ4ERtw"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A9iZ0h2Pkk"}],"key":"gD4sXi2kfo"},{"type":"text","value":" architecture has three sections:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GcBmALR9ku"}],"key":"d0RsTMxsUp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Text + positional embeddings","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Mlaq9So9hw"}],"key":"UMgPosyead"}],"key":"SdfcjJAEQz"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A transformer decoder stack","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jFxsW8XnjB"}],"key":"rgHjMdFkXh"}],"key":"T4whUepdzn"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A projection to vocab step","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PnscnoCMQS"}],"key":"jMTyxKCKGv"}],"key":"KimFsWuM1h"}],"key":"yAiS0wsIy4"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"In code, it looks like this:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"onFdex7g1x"}],"key":"ECX30hNOSq"}],"key":"nb3NY8o0SZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def gpt2(inputs, wte, wpe, blocks, ln_f, n_head):  # [n_seq] -> [n_seq, n_vocab]\n    # token + positional embeddings\n    x = wte[inputs] + wpe[range(len(inputs))]  # [n_seq] -> [n_seq, n_embd]\n\n    # forward pass through n_layer transformer blocks\n    for block in blocks:\n        x = transformer_block(\n            x, **block, n_head=n_head\n        )  # [n_seq, n_embd] -> [n_seq, n_embd]\n\n    # projection to vocab\n    x = layer_norm(x, **ln_f)  # [n_seq, n_embd] -> [n_seq, n_embd]\n    return x @ wte.T  # [n_seq, n_embd] -> [n_seq, n_vocab]","key":"iqwCmH5wlI"},{"type":"outputs","id":"9I2mcWg8TMZ76JVZxsn_7","children":[],"key":"PeRJRYfg6G"}],"key":"PreBv92sS5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s break down each of these three sections into more detail.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JLayfK0tuB"}],"key":"rDM6x3pk1w"}],"key":"HSx0ibVwwY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Embeddings","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tZEBkRLY9d"}],"identifier":"embeddings","label":"Embeddings","html_id":"embeddings","implicit":true,"key":"feBLx6IlOp"}],"key":"LZsY5R3cHT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Token Embeddings","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cJ27H4Pysm"}],"identifier":"token-embeddings","label":"Token Embeddings","html_id":"token-embeddings","implicit":true,"key":"dlTvNFHlXr"}],"key":"QonHF9SfsG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Token IDs by themselves are not very good representations for a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IusVzOB47I"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xGGRbrhHim"}],"key":"lD2fA5suT3"},{"type":"text","value":". For one, the relative magnitudes of the token IDs falsely communicate information (for example, if ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Cqf0nx0oTb"},{"type":"inlineCode","value":"Apple = 5","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uVVzMuwXoR"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"awmSW2tpBS"},{"type":"inlineCode","value":"Table = 10","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d4Mjp552Yw"},{"type":"text","value":" in our vocab, then we are implying that ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YrQ9QspNpI"},{"type":"inlineCode","value":"2 * Apple = Table","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q2PmGBWnmj"},{"type":"text","value":"). Secondly, a single number is not a lot of dimensionality for a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jPGabd8U6I"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QnbU00CkRM"}],"key":"ENCxAq1O8t"},{"type":"text","value":" to work with. To address these limitations, we’ll take advantage of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eFwpinLq65"},{"type":"link","url":"https://jaykmody.com/blog/attention-intuition/#word-vectors-and-similarity","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"word vectors","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Oteo5hdjW3"}],"urlSource":"https://jaykmody.com/blog/attention-intuition/#word-vectors-and-similarity","key":"AvngS4Gkg7"},{"type":"text","value":", specifically via a learned embedding matrix:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UwI5bBQKhM"}],"key":"lT9VyLzsxR"},{"type":"code","lang":"python","value":"wte[inputs]  # [n_seq] -> [n_seq, n_embd]","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"WUq7qfYmh2"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Recall, ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DRqBrKKfxU"},{"type":"inlineCode","value":"wte","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"v2LmONQFTp"},{"type":"text","value":" is a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"eAKjwgBXYA"},{"type":"inlineCode","value":"[n_vocab, n_embd]","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"beIJD56Vql"},{"type":"text","value":" matrix. It acts as a lookup table, where the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"qtBokPsUnC"},{"type":"inlineMath","value":"ith","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"o3iZyhBtpH"},{"type":"text","value":" row in the matrix corresponds to the learned vector for the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"P5LWF13dAQ"},{"type":"inlineMath","value":"ith","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"KzdtPVcHaP"},{"type":"text","value":" token in our vocabulary. ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"W0wSxdvMtz"},{"type":"inlineCode","value":"wte[inputs]","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"s04DO2ACrr"},{"type":"text","value":" uses ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"u9D06onmNv"},{"type":"link","url":"https://numpy.org/doc/stable/user/basics.indexing.html#integer-array-indexing","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"integer array indexing","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"d9kZ8AZUhK"}],"urlSource":"https://numpy.org/doc/stable/user/basics.indexing.html#integer-array-indexing","key":"LNTIOi56ME"},{"type":"text","value":" to retrieve the vectors corresponding to each token in our input. Like any other parameter in our network, ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"MrIUmtJ1Vo"},{"type":"inlineCode","value":"wte","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pzdKwGJ5qa"},{"type":"text","value":" is learned. That is, it is randomly initialized at the start of training and then updated via gradient descent.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"V1adJ7sNN1"}],"key":"eHV9yKmwOl"}],"key":"Fd2hqfxoL2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Positional Embeddings","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QgFq2mvike"}],"identifier":"positional-embeddings","label":"Positional Embeddings","html_id":"positional-embeddings","implicit":true,"key":"vXZheRqKUf"}],"key":"YJvv76ZOYp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"One quirk of the transformer architecture is that it doesn’t take into account position. That is, if we randomly shuffled our input and then accordingly unshuffled the output, the output would be the same as if we never shuffled the input in the first place (the ordering of inputs doesn’t have any effect on the output). Of course, the ordering of words is a crucial part of language (duh), so we need some way to encode positional information into our inputs. For this, we can just use another learned embedding matrix:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IhXGQxyo2B"}],"key":"LJc9CgEIl5"},{"type":"code","lang":"python","value":"wpe[range(len(inputs))]  # [n_seq] -> [n_seq, n_embd]","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"sK2E9jqXgd"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Recall, ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dJZ0CBAS7K"},{"type":"inlineCode","value":"wpe","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"MNs7MSrozG"},{"type":"text","value":" is a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jBCAhorvaP"},{"type":"inlineCode","value":"[n_ctx, n_embd]","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VL5Fb5DIPJ"},{"type":"text","value":" matrix. The ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bXD4nZGOHr"},{"type":"inlineMath","value":"ith","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"NlTvjiHQNH"},{"type":"text","value":" row of the matrix contains a vector that encodes information about the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"klQqUkhUgN"},{"type":"inlineMath","value":"ith","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"U8K8qhX8q0"},{"type":"text","value":" position in the input. Similar to ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PabG0Yz4F8"},{"type":"inlineMath","value":"wte","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">wte</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">wt</span><span class=\"mord mathnormal\">e</span></span></span></span>","key":"obSKbo1sXj"},{"type":"text","value":", this matrix is learned during gradient descent. Notice, this restricts our model to a maximum sequence length of ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Y7ng3lyIas"},{"type":"inlineCode","value":"n_ctx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nUEe3HJLq9"},{"type":"text","value":". That is, ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"a0B4pHZNEW"},{"type":"inlineCode","value":"len(inputs) <= n_ctx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"alw9ZeIAoh"},{"type":"text","value":" must hold.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"RPDEpRWM46"}],"key":"ZI75q05fLa"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"wxs6W1bXCg"}],"key":"yv1BIbkDac"},{"type":"text","value":": The original transformer paper used a ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"AUUqAfe6Oe"},{"type":"link","url":"https://nlp.seas.harvard.edu/2018/04/03/attention.html#positional-encoding","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"calculated positional embedding","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"V830s6lWBx"}],"urlSource":"https://nlp.seas.harvard.edu/2018/04/03/attention.html#positional-encoding","key":"r3xVIVH6FB"},{"type":"text","value":" which they found performed just as well as learned positional embeddings, but has the distinct advantage that you can input any arbitrarily long sequence (you are not restricted by a maximum sequence length). However, in practice, your model is only going to be as the good sequence lengths that it was trained on. You can’t just train a ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"fP9VHFeKV8"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"SDWKrxncMH"}],"key":"BlclEIfhok"},{"type":"text","value":" on sequences that are ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"E8x84zlBue"},{"type":"text","value":"1024","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"QNf9IkNUBF"},{"type":"text","value":" long and then expect it to perform well at 16k tokens long. Recently however, there has been some success with relative positional embeddings, such as ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JQRZJpBTuC"},{"type":"link","url":"https://arxiv.org/pdf/2108.12409.pdf","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Alibi","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"cqLlLmCGJQ"}],"urlSource":"https://arxiv.org/pdf/2108.12409.pdf","key":"lhK5gndBEW"},{"type":"text","value":" and ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"thUGcm1Ces"},{"type":"link","url":"https://arxiv.org/pdf/2104.09864v4.pdf","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"RoPE","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"daHb41xTCP"}],"urlSource":"https://arxiv.org/pdf/2104.09864v4.pdf","key":"MazbgW30dg"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"G3jpqdQ7In"}],"key":"fiVaBdZZrw"}],"key":"S79TZzKL2a"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Combined","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TGFlRhZAX9"}],"identifier":"combined","label":"Combined","html_id":"combined","implicit":true,"key":"YkmlQvKjex"}],"key":"kFzhUAQ0SV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can add our token and positional embeddings to get a combined embedding that encodes both token and positional information:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N0vW1trrB6"}],"key":"umyYu8nRJk"},{"type":"code","lang":"python","value":"# token + positional embeddings\nx = wte[inputs] + wpe[range(len(inputs))]  # [n_seq] -> [n_seq, n_embd]\n\n# x[i] represents the word embedding for the ith word + the positional\n# embedding for the ith position","position":{"start":{"line":3,"column":1},"end":{"line":9,"column":1}},"key":"XcCDuGvAmJ"}],"key":"Oxh9lSxygt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Decoder Stack","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kAkuQo4llC"}],"identifier":"decoder-stack","label":"Decoder Stack","html_id":"decoder-stack","implicit":true,"key":"UYb6SQnT75"}],"key":"XzEvAMcWOu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This is where all the magic happens and the “deep” in deep learning comes in. We pass our embedding through a stack of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sSinvMhEz7"},{"type":"inlineCode","value":"n_layer","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e0AQc4wZaJ"},{"type":"text","value":" transformer decoder blocks:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jqR61E5eB3"}],"key":"BO00BUx46B"},{"type":"code","lang":"python","value":"# forward pass through n_layer transformer blocks\nfor block in blocks:\n    x = transformer_block(\n        x, **block, n_head=n_head\n    )  # [n_seq, n_embd] -> [n_seq, n_embd]","position":{"start":{"line":3,"column":1},"end":{"line":9,"column":1}},"key":"NlqxeC9UmY"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Stacking more layers is what allows us to control how deep our network is. ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"NGpmnO4V0K"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"oFsQzpHWtC"}],"key":"g5lTNEagGE"},{"type":"text","value":"-3 for example, has a whopping ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"lf3NbmChZE"},{"type":"text","value":"96","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"MAFwyAZRP8"},{"type":"text","value":" layers. On the other hand, choosing a larger ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"y3AeCjlvL9"},{"type":"inlineCode","value":"n_embd","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"PdHn7X6szY"},{"type":"text","value":" value allows us to control how ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"a85On0gecR"},{"type":"emphasis","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"wide","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"UxwisfHgRU"}],"key":"P0ZI4lCOrd"},{"type":"text","value":" our network is (for example, ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qTr553x4Q0"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"t7nWDvw2Be"}],"key":"bPaolAYU6x"},{"type":"text","value":"-3 uses an embedding size of ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"iuSE3bSGuB"},{"type":"text","value":"12288","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"F97BNMP23y"},{"type":"text","value":").","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"TtAqQhHo3u"}],"key":"CHuSRpKYb4"}],"key":"cl1GLebNrI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Projection to Vocab","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cJ9aLU7nGV"}],"identifier":"projection-to-vocab","label":"Projection to Vocab","html_id":"projection-to-vocab","implicit":true,"key":"LXYGBIMcn9"}],"key":"JNfv41DKIT"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In our final step, we project the output of the final transformer block to a probability distribution over our vocab:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EWviQ5BjZQ"}],"key":"J3trFLiRfe"},{"type":"code","lang":"python","value":"# projection to vocab\nx = layer_norm(x, **ln_f)  # [n_seq, n_embd] -> [n_seq, n_embd]\nreturn x @ wte.T  # [n_seq, n_embd] -> [n_seq, n_vocab]","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"key":"TvGrBmOnbh"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Couple things to note here:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"wmufTfFMmC"}],"key":"n5XjZU829S"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We first pass ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"prVwqbZ2KA"},{"type":"inlineCode","value":"x","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"IKdrh4WclG"},{"type":"text","value":" through a final layer normalization layer before doing the projection to vocab. This is specific to the ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"FhwpmPf6gy"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"T5HLgODpxL"}],"key":"J303cGoMfs"},{"type":"text","value":"-2 architecture (this is not present in the original ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"TDNdCuMhan"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"G6mk5q07nA"}],"key":"ft5CYzPLG5"},{"type":"text","value":" and Transformer papers).","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"fPeIfMr47A"}],"key":"w8E4yk3Yec"}],"key":"yz91T6fxDY"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We are reusing the embedding matrix ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"CmLtXc5Hqw"},{"type":"inlineCode","value":"wte","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"zyqkddnLBY"},{"type":"text","value":" for the projection.  Other ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"NIwmpoXkn3"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"oALOvVJ0zO"}],"key":"ZxF0cG7kTz"},{"type":"text","value":" implementations may choose to use a separate learned weight matrix for the projection, however sharing the embedding matrix has a couple of advantages:","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"MfgSIQqoOj"}],"key":"RqWnRsaciP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You save some parameters (although at ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"WkMnOQIBDu"},{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ynVHGyBuZI"}],"key":"eBYydcONKt"},{"type":"text","value":"-3 scale, this is negligible).","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Yvg7g83s2e"}],"key":"idPLmzAxRO"}],"key":"hMMRcCtfRu"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Since the matrix is both responsible for mapping both ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"TJDbF55NG4"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"to","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"CVMYG2V2yr"}],"key":"TXUUfYXWbV"},{"type":"text","value":" words and ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"ghns2IdEUd"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"from","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"W2mBUCnt27"}],"key":"o17dzfOpW2"},{"type":"text","value":" words, in theory, it ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"sIr3iNfSed"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"may","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"cyUX76d1Oo"}],"key":"llc1LVBlT0"},{"type":"text","value":" learn a richer representation compared to having two separate matrixes.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"SVayHwFqUI"}],"key":"LLSIjDM8v4"}],"key":"zjcjqbgiNZ"}],"key":"i3EZQWMfit"}],"key":"LFSOnhjCvU"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We don’t apply ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"VXgk5phsZz"},{"type":"inlineCode","value":"softmax","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"LS1mhtEFjc"},{"type":"text","value":" at the end, so our outputs will be logits instead of probabilities between ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"uZfct1kOm4"},{"type":"text","value":"0","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Xr86bMOipR"},{"type":"text","value":" and ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"aWFCcvhRSl"},{"type":"text","value":"1","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"RcRQo8gitc"},{"type":"text","value":". This is done for several reasons:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"zMjzl2ERa1"}],"key":"D73Mq4CGc9"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"softmax","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"JL0OYxyXwP"},{"type":"text","value":" is ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"H8EQK8fPG1"},{"type":"link","url":"https://en.wikipedia.org/wiki/Monotonic_function","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"monotonic","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"RbFROxHIof"}],"urlSource":"https://en.wikipedia.org/wiki/Monotonic_function","data":{"page":"Monotonic_function","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"siP43rruJS"},{"type":"text","value":", so for greedy sampling ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"fradNgNSUu"},{"type":"inlineCode","value":"np.argmax(logits)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"xyjMxWsoM1"},{"type":"text","value":" is equivalent to ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"fXXXlElS3u"},{"type":"inlineCode","value":"np.argmax(softmax(logits))","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"y3PFJyyKdw"},{"type":"text","value":" making ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"rxrOtoTsYP"},{"type":"inlineCode","value":"softmax","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"zFSZKfmdJm"},{"type":"text","value":" redundant","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"iBVGZBs3DW"}],"key":"V6FJszgqjw"}],"key":"vgEYKXZt8g"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"softmax","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"QAoMq6maWm"},{"type":"text","value":" is irreversible, meaning we can always go from logits to probabilities by applying ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"QXB081irNu"},{"type":"inlineCode","value":"softmax","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ZcOp4t1qwT"},{"type":"text","value":", but we can’t go back to logits from probabilities, so for maximum flexibility, we output the logits","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"UsALy0O2Ag"}],"key":"dRna7TvTcz"}],"key":"qqF4o8n4cM"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Numerically stability (for example, to compute cross entropy ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"SqCRNEvnHN"},{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"pHPSGWy13Y"}],"key":"K4zR4PE5QP"},{"type":"text","value":", taking ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"mQgbn5ttWh"},{"type":"inlineCode","value":"log(softmax(logits))","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"IWSlqulDfK"},{"type":"text","value":" is numerically unstable compared to ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"fJ7XaaTXJ4"},{"type":"inlineCode","value":"log_softmax(logits)","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Wz07tV4ORO"}],"key":"D78PQr5KnO"}],"key":"AVxHqMSrKZ"}],"key":"lMf89U0v4A"}],"key":"ZMBq3aONwE"}],"key":"QhgmJNLN9F"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"The projection to vocab step is also sometimes called the language modeling head. What does “head” mean? Once your ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Tx2IzRBXN9"},{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"re8Oi0KVvU"}],"key":"frVqAoYyD7"},{"type":"text","value":" is pre-trained, you can swap out the language modeling head with some other kind of projection, like a classification head for fine-tuning the model on some classification task. So your model can have multiple heads, kind of like a ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Mh6FR0RFPj"},{"type":"link","url":"https://en.wikipedia.org/wiki/Lernaean_Hydra","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"hydra","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"t1la7FYA1d"}],"urlSource":"https://en.wikipedia.org/wiki/Lernaean_Hydra","data":{"page":"Lernaean_Hydra","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"oKvy4UvgIJ"},{"type":"text","value":". So that’s the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"crqtYE3nOl"},{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"OtsFR12zhF"}],"key":"ZHFtBT7r8E"},{"type":"text","value":" architecture at a high level, let’s actually dig a bit deeper into what the decoder blocks are doing.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"FFQrOMXABV"}],"key":"LICKb05c1a"}],"key":"B4Hdpo1ZqT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Decoder Block","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XJYkBEv1TO"}],"identifier":"decoder-block","label":"Decoder Block","html_id":"decoder-block","implicit":true,"key":"pz1k3JqsOB"}],"key":"dbn6Qzkwp7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The transformer decoder block consists of two sublayers:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mb1nUklYqm"}],"key":"ZZYRl9Jp8s"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Multi-head causal self attention","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FLhaPXIsUA"}],"key":"XRLshkrmMb"}],"key":"VsL8v2FY2E"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Position-wise feed forward ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CqN46OpShd"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WFwuH4kKqg"}],"key":"AN3yOQ1THB"}],"key":"J2rHXKlUej"}],"key":"kwR7jbB3xZ"}],"key":"Pl4qPk75oD"}],"key":"b4g2FfpMLi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def transformer_block(\n    x, mlp, attn, ln_1, ln_2, n_head\n):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # multi-head causal self attention\n    x = x + mha(\n        layer_norm(x, **ln_1), **attn, n_head=n_head\n    )  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # position-wise feed forward network\n    x = x + ffn(layer_norm(x, **ln_2), **mlp)  # [n_seq, n_embd] -> [n_seq, n_embd]\n    return x","key":"dv0m7Uwkfs"},{"type":"outputs","id":"zA8DMyjYB_7fojY2RKrSw","children":[],"key":"Lka97GeGri"}],"key":"cSe02Uha74"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Each sublayer utilizes layer normalization on their inputs as well as a residual connection (i.e. add the input of the sublayer to the output of the sublayer). Some things to note:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"s8PdP5tJtG"}],"key":"JxKQSYCYqx"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Multi-head causal self attention is what facilitates the communication between the inputs. Nowhere else in the network does the model allow inputs to “see” each other. The embeddings, position-wise feed forward network, layer norms, and projection to vocab all operate on our inputs position-wise. Modeling relationships between inputs is tasked solely to attention.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pNJdro8ar0"}],"key":"hF4AyESYIi"}],"key":"iDcyAxpXBN"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The Position-wise feed forward ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PsHOtBkeMk"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"G9TtuJasBI"}],"key":"QmM2dQvjNU"},{"type":"text","value":" is just a regular 2 layer fully connected ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"V0YpxkWiE7"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"dZL79IPy5N"}],"key":"KFzG2UVH97"},{"type":"text","value":". This just adds a bunch of learnable parameters for our model to work with to facilitate learning.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mkDIloZtGz"}],"key":"DGbkixkJJr"}],"key":"NJvphKPvew"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"In the original transformer paper, layer norm is placed on the output ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qUmHst8bOV"},{"type":"inlineCode","value":"layer_norm(x + sublayer(x))","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fKcDpBFpnR"},{"type":"text","value":" while we place layer norm on the input ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VrQFxTzzf7"},{"type":"inlineCode","value":"x + sublayer(layer_norm(x))","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qVzuqaDfy2"},{"type":"text","value":" to match ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xDWrp2OQA6"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fOKw3UGvfs"}],"key":"HBX5f3OJP6"},{"type":"text","value":"-2. This is referred to as pre-norm and has been shown to be ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"A2ks2RUkso"},{"type":"link","url":"https://arxiv.org/pdf/2002.04745.pdf","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"important in improving the performance of the transformer","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VX4HZvxObt"}],"urlSource":"https://arxiv.org/pdf/2002.04745.pdf","key":"jGTgJGYIca"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aHE1BLCw0Y"}],"key":"CcsmgBwhU8"}],"key":"GNlb9Hfw8s"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Residual connections (popularized by ResNet) serve a couple of different purposes:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Fv6Z5W3vwh"}],"key":"OLF4KuWmuF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Makes it easier to optimize ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zvaFtviAOd"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"m9Jrj8llSU"}],"key":"rM5hMYvDmF"},{"type":"text","value":"s that are deep (i.e. networks that have lots of layers). The idea here is that we are providing “shortcuts” for the gradients to flow back through the network, making it easier to optimize the earlier layers in the network.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PSnCzsbGMP"}],"key":"vWh8HpOxdt"}],"key":"rN4sP7j8BR"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Without residual connections, deeper models see a degradation in performance when adding more layers (possibly because it’s hard for the gradients to flow all the way back through a deep network without losing information). Residual connections seem to give a bit of an accuracy boost for deeper networks.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"euVKUauwdI"}],"key":"fCC3JIrVmd"}],"key":"IcO3DwGwJt"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Can help with the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"kpzRGizDQD"},{"type":"link","url":"https://programmathically.com/understanding-the-exploding-and-vanishing-gradients-problem/","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"vanishing/exploding gradients problem","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jl05j3jg5B"}],"urlSource":"https://programmathically.com/understanding-the-exploding-and-vanishing-gradients-problem/","key":"VNsu2suQwe"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TkeaX5yurc"}],"key":"P5rP2pRYMu"}],"key":"M58fC3ZSar"}],"key":"BgJ5fggISm"}],"key":"bHWdoXMQhu"}],"key":"KffkySGAkd"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Let’s dig a little deeper into the 2 sublayers.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"PZVLjq82wv"}],"key":"gTdjYkI12d"}],"key":"Bq05TyL9gT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Position-wise Feed Forward Network","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TkTfyAVtKu"}],"identifier":"position-wise-feed-forward-network","label":"Position-wise Feed Forward Network","html_id":"position-wise-feed-forward-network","implicit":true,"key":"bDKp2fnweL"}],"key":"dG1D7wWXKx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This is just a simple multi-layer perceptron with 2 layers:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VeJOVaLG5z"}],"key":"V7aWelyfv8"}],"key":"ZttBdemHby"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def ffn(x, c_fc, c_proj):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # project up\n    a = gelu(linear(x, **c_fc))  # [n_seq, n_embd] -> [n_seq, 4*n_embd]\n\n    # project back down\n    x = linear(a, **c_proj)  # [n_seq, 4*n_embd] -> [n_seq, n_embd]\n\n    return x","key":"qUEPj7O1S7"},{"type":"outputs","id":"TAfbPwR0YA5hUV7rZ45zE","children":[],"key":"eyH31KHfy2"}],"key":"zttFIQvUCs"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Nothing super fancy here, we just project from ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K4jbbrNamA"},{"type":"inlineCode","value":"n_embd","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZRmHcCx7Cm"},{"type":"text","value":" up to a higher dimension ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I0ZL2eL4Zj"},{"type":"inlineCode","value":"4*n_embd","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HGlL8zFMgq"},{"type":"text","value":" and then back down to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UxPRlpSBPF"},{"type":"inlineCode","value":"n_embd[4]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T5xKRcND5i"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PO7Clo7Ove"}],"key":"GhQu6S2Yht"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x5LDgPOuwQ"}],"key":"Jwxib2oK0c"},{"type":"text","value":": Different ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Rsajd9Ibz1"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pGwCc4LhGa"}],"key":"Oqa7XxlfKL"},{"type":"text","value":" models may choose a different hidden width that is not ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZltgdVrhyb"},{"type":"inlineCode","value":"4*n_embd","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X0RBobmgnf"},{"type":"text","value":", however this is the common practice for ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WuNbJmyF1s"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bUHDAdFl3q"}],"key":"gMfIcXksvs"},{"type":"text","value":" models. Also, we give the multi-head attention layer a lot of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oxiZ2NUIpX"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"attention","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"D3i26mNzzT"}],"key":"p9STwozFS8"},{"type":"text","value":" (pun intended) for driving the success of the transformer, but at the scale of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eojUTdDGyb"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZJ7lP4Kc5H"}],"key":"WmIOqUd9uU"},{"type":"text","value":"-3, ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NWBQfcVBG1"},{"type":"inlineMath","value":"80\\%","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>80</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">80\\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">80%</span></span></span></span>","key":"o5O0UVrSHN"},{"type":"text","value":" of the model parameters are contained in the feed forward layer. Just something to think about.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aOGh59S77v"}],"key":"zhEj1WN7cz"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Recall, from our params dictionary, that our mlp params look like this:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CQdQxluFpD"}],"key":"PB7phnqg0k"},{"type":"code","lang":"python","value":"\"mlp\": {\n    \"c_fc\": {\"b\": [4*n_embd], \"w\": [n_embd, 4*n_embd]},\n    \"c_proj\": {\"b\": [n_embd], \"w\": [4*n_embd, n_embd]},\n},","position":{"start":{"line":7,"column":1},"end":{"line":12,"column":1}},"key":"kYUdBXaa5r"}],"key":"fWWbanv6rr"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Multi-Head Causal Self Attention","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jH0mKuJWcz"}],"identifier":"multi-head-causal-self-attention","label":"Multi-Head Causal Self Attention","html_id":"multi-head-causal-self-attention","implicit":true,"key":"X0UQ9gzs7T"}],"key":"JVln3EIMLe"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This layer is probably the most difficult part of the transformer to understand. So let’s work our way up to “Multi-Head Causal Self Attention” by breaking each word down into its own section:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lQ5B2JNNqa"}],"key":"o8FQHgEFvC"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Attention","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NnW9LoKTrP"}],"key":"M8TDSqap0S"}],"key":"gtPmymDeSg"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Self","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AyrotiQy6v"}],"key":"TD8jJnzpjH"}],"key":"IiOPheUjVZ"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Causal","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"C8lrWYK2qG"}],"key":"TesDbYToT3"}],"key":"d8uc6OgaXn"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Multi-Head","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nXP8eHIba7"}],"key":"OMX6CYzh2a"}],"key":"Muhhull8Lp"}],"key":"VFmF4DQuBh"}],"key":"Qar5PYuhmt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Attention","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DL1GsNGo2C"}],"identifier":"attention","label":"Attention","html_id":"attention","implicit":true,"key":"UO7CPFD0mT"}],"key":"WivjdPiWZk"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ChatGPT and other large language models use a special type of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DZbJJkbgvp"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KOZrXwqBOx"}],"key":"yxxhAyW2Gd"},{"type":"text","value":" called the transformer. The transformer defining feature is the attention mechanism. Attention is defined by the equation:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VXd3Si3VVA"}],"key":"tzQu1ljjMi"},{"type":"math","value":"\\text{attention}(Q, K, V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}})V","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>attention</mtext><mo stretchy=\"false\">(</mo><mi>Q</mi><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy=\"false\">)</mo><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">\\text{attention}(Q, K, V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}})V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">Q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4483em;vertical-align:-0.93em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5183em;\"><span style=\"top:-2.2528em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8572em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.8172em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1828em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>","enumerator":"3","key":"L4ViENGu0k"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Attention can come in different forms, but this version of attention (known as scaled dot product attention) was first proposed in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"G55SlSNkyM"},{"type":"link","url":"https://arxiv.org/pdf/1706.03762.pdf","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"original transformer paper","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lvTNFW5dW3"}],"urlSource":"https://arxiv.org/pdf/1706.03762.pdf","key":"OysNzTBn12"},{"type":"text","value":". In this post, we’ll build an intuition for the above equation by deriving it from the ground up.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wEyAnbicuy"}],"key":"hJxGOp33HE"}],"key":"XnpnxkWCgb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Key-Value Lookups","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z0RglXMg5o"}],"identifier":"key-value-lookups","label":"Key-Value Lookups","html_id":"key-value-lookups","implicit":true,"key":"VX6FpEy8qh"}],"key":"O4A8riWJE6"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"A key-value (kv) lookup involves three components:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nZSVNoPRDq"}],"key":"U7mxmt4Tch"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A list of ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"GcmsRSSOHK"},{"type":"inlineMath","value":"n_k","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"rrBRbyt141"},{"type":"text","value":" ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hKjhQ5vif1"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"keys","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"IQkAaKmsRu"}],"key":"GBIe1O09OZ"}],"key":"G1lI88bUXj"}],"key":"y0k7B2PlvA"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A list of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Fo5sPga0jD"},{"type":"inlineMath","value":"n_k","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"j4OSjjQ7Dx"},{"type":"text","value":" ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WR6Uifk4Wq"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"values","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dll1kturQW"}],"key":"Zj3mb5EEuh"},{"type":"text","value":" (that map 1-to-1 with the keys, forming key-value pairs)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KEksjMivdq"}],"key":"AmePHHrFpI"}],"key":"EiXmWE1nLV"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ZWwctwAX0Q"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"query","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TNYY3eFtcU"}],"key":"TMcGw9W6OP"},{"type":"text","value":", for which we want to ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"dbO0xpI1X4"},{"type":"emphasis","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"match","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"hApkTT3iAt"}],"key":"rvTorzE4lV"},{"type":"text","value":" with the keys and get some value based on the match","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mZUx1VJWUP"}],"key":"n32z9gJy7Q"}],"key":"KDIwGTHTOU"}],"key":"tv4dMVOBMS"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"You’re probably familiar with this concept as a dictionary or hash map:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"aaW0giWjMw"}],"key":"SRlyyqPjzE"}],"key":"bn0lfKneE6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"d = {\n    \"apple\": 10,\n    \"banana\": 5,\n    \"chair\": 2,\n}\nprint(d.keys())\nprint(d.values())\nquery = \"apple\"\nd[query]","key":"ahLRed2FLJ"},{"type":"outputs","id":"NK4xjXog3cqNI7vK4cR_w","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"dict_keys(['apple', 'banana', 'chair'])\ndict_values([10, 5, 2])\n"},"children":[],"key":"PUQ6DOfqbT"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"10","content_type":"text/plain"}}},"children":[],"key":"OgBSZcFEfS"}],"key":"rWNFzvD1or"}],"key":"Jb43OFkt5H"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dictionaries let us perform lookups based on an exact string match. What if instead we wanted to do a lookup based on the meaning of a word?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"snq2Kyp9E2"}],"key":"vWV5uncD4B"}],"key":"pzAJx0PIM1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Key-Value Lookups based on Meaning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BVJjd3Micz"}],"identifier":"key-value-lookups-based-on-meaning","label":"Key-Value Lookups based on Meaning","html_id":"key-value-lookups-based-on-meaning","implicit":true,"key":"PlOmgKd4iL"}],"key":"L98F3RvktK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Say we wanted to look up the word “fruit” in our previous example, how do we choose which key is the best match? It’s obviously not “chair”, but both “apple” and “banana” seem like a good match. It’s hard to choose one or the other, fruit feels more like a combination of apple and banana rather than a strict match for either. So, let’s not choose. Instead, we’ll do exactly that, take a combination of apple and banana. For example, say we assign a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i1c36o6JsJ"},{"type":"inlineMath","value":"60\\%","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>60</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">60\\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">60%</span></span></span></span>","key":"zEUIlWPcUO"},{"type":"text","value":" meaning based match for apple, a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fxT9OowROn"},{"type":"inlineMath","value":"40\\%","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>40</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">40\\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">40%</span></span></span></span>","key":"oSLxo6fSna"},{"type":"text","value":" match for banana, and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ynd9Zl1XVU"},{"type":"inlineMath","value":"0\\%","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">0\\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">0%</span></span></span></span>","key":"oU0Fdl2UPa"},{"type":"text","value":" match for chair. We compute our final output value as the weighted sum of the values with the percentages:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JI68aBdhxN"}],"key":"RoJ1Ggoas0"}],"key":"BFsoUgcQHD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"query = \"fruit\"\nd = {\"apple\": 10, \"banana\": 5, \"chair\": 2}\n0.6 * d[\"apple\"] + 0.4 * d[\"banana\"] + 0.0 * d[\"chair\"]","key":"a3S7ajEJAY"},{"type":"outputs","id":"nuaZ8ytebkFbLXae_hwFX","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":31,"metadata":{},"data":{"text/plain":{"content":"8.0","content_type":"text/plain"}}},"children":[],"key":"TM2hYVY72U"}],"key":"IuKOVkKgk7"}],"key":"LcPkIIRlmB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In a sense, we are determining how much attention our query should be paying to each key-value pair based on ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zd2R1J9naX"},{"type":"inlineCode","value":"meaning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WUsjm1cFL9"},{"type":"text","value":". The amount of “attention” is represented as a decimal percentage, called an attention score. Mathematically, we can define our output as a simple weighted sum:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hVmF4tYqVU"}],"key":"jBWkpzWUTP"},{"type":"math","value":"\\sum_{i} \\alpha_i v_i","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>α</mi><mi>i</mi></msub><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\sum_{i} \\alpha_i v_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.3277em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"4","key":"faFDsWB7v2"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WYbjqaaPVL"},{"type":"inlineMath","value":"\\alpha_i","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>α</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\alpha_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"nuQmZVmj76"},{"type":"text","value":" is our attention score for the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vujocMl47Y"},{"type":"inlineMath","value":"ith","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"LAZMrfsVJM"},{"type":"text","value":" kv pair and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TmoNB7bU2B"},{"type":"inlineMath","value":"v_i","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"HtKEVNdBBv"},{"type":"text","value":" is the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Zzq5nLhzVB"},{"type":"inlineMath","value":"ith","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"scoAXdphom"},{"type":"text","value":" value. Remember, the attention scores are decimal percentages, that is they must be between ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MAKaa3u5QF"},{"type":"text","value":"0","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"n68C7MrFlZ"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tHVpbRVQrP"},{"type":"text","value":"1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gDg29ebMaS"},{"type":"text","value":" inclusive (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"t0Q8EjRhSm"},{"type":"inlineMath","value":"0 \\leq \\alpha_i \\leq 1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>α</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0 \\leq \\alpha_i \\leq 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"nB9YZehLhU"},{"type":"text","value":") and their sum must be ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ht9HxOSWi3"},{"type":"text","value":"1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IGUvI2j7N3"},{"type":"text","value":" (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CtxpgZdNrz"},{"type":"inlineMath","value":"\\sum_{i} \\alpha_i = 1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mo>∑</mo><mi>i</mi></msub><msub><mi>α</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\sum_{i} \\alpha_i = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0497em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.162em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"UGX7h6pDq7"},{"type":"text","value":"). Okay, but where did we get these attention scores from? In our example, we kind of chose them based on what we felt. While we did a pretty good job, this approach doesn’t seem sustainable. Instead, let’s take a look at how word vectors can help solve our problem of determining attention scores.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sVgkJFtjYz"}],"key":"xlx0anuBD7"}],"key":"afsKH0TkL0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Word Vectors and Similarity","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZlEAOFi2l9"}],"identifier":"word-vectors-and-similarity","label":"Word Vectors and Similarity","html_id":"word-vectors-and-similarity","implicit":true,"key":"CH87Zo1jYV"}],"key":"hbvuQM6uWq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imagine we represent a word with a vector of numbers. Ideally, the values in the vector should in some way capture the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MKMKnYR4RE"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"meaning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QyGN1C3LGf"}],"key":"LKh4Fs4i9r"},{"type":"text","value":" of the word it represents. For example, imagine we have the following word vectors (visualized in 2D space):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aJfzRQwDJr"}],"key":"eiRlVo91sd"}],"key":"YDBnxsLUGM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"2d_word_vectors_example.png\"))","key":"UGAxwkK1Et"},{"type":"outputs","id":"e2Ala-i64sVyoYdH7ZO6e","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"62ff8935ab01a5371f3de4e1af37f529","path":"/build/62ff8935ab01a5371f3de4e1af37f529.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"BbXYZSOkGc"}],"key":"txlzeKHCCD"}],"key":"YW2NSMsdEc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can see that words that are ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sMPB5489nZ"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"similar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O6pHgBZIuJ"}],"key":"JaH3zSHQv3"},{"type":"text","value":" are clustered together. Fruits are clustered at the top right, vegetables are clustered at the top left, and furniture is clustered at the bottom. In fact, you can even see that the vegetable and fruit clusters are closer to each other than they are to the furniture cluster, since they are more closely related things. You can even imagine doing arithmetic on word vectors. For example, given the words “king”, “queen”, “man”, and “woman” and their respective vector representations ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dsSASpAYmB"},{"type":"inlineMath","value":"v_{king}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mrow><mi>k</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">v_{king}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">kin</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"uWubRDuuVo"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UiGit53zYy"},{"type":"inlineMath","value":"v_{queen}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">v_{queen}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">ee</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"pVSQPZsS4W"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kE0mmY5E6r"},{"type":"inlineMath","value":"v_{man}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mrow><mi>m</mi><mi>a</mi><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">v_{man}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">man</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"hBinWGu2tT"},{"type":"text","value":", and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oqZOE5xF7L"},{"type":"inlineMath","value":"v_{woman}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">v_{woman}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">man</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"hsELZwWi7z"},{"type":"text","value":", we can imagine that:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QG2FkJgZoX"}],"key":"u17HkrQ4oW"},{"type":"math","value":"v_{queen} - v_{woman} + v_{man} \\sim v_{king}","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>v</mi><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msub><mo>−</mo><msub><mi>v</mi><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><mi>n</mi></mrow></msub><mo>+</mo><msub><mi>v</mi><mrow><mi>m</mi><mi>a</mi><mi>n</mi></mrow></msub><mo>∼</mo><msub><mi>v</mi><mrow><mi>k</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">v_{queen} - v_{woman} + v_{man} \\sim v_{king}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">ee</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">man</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">man</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">kin</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"5","key":"xvxqjR59cZ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"That is, the vector for “queen” minus “woman” plus “man” should result in a vector that is ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fydBXtha2f"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"similar","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UmvCPWciFA"}],"key":"cUnsMZptnE"},{"type":"text","value":" to the vector for “king”. But what does it exactly mean for two vectors to be ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"f4YBWhI2O0"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"similar","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NozarXQ79z"}],"key":"eUomaVzxLA"},{"type":"text","value":"? In the fruits/vegetables example, we were using distance as a measure of similarity (in particular, ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Et5DNKApbr"},{"type":"link","url":"https://en.wikipedia.org/wiki/Euclidean_distance","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"euclidean distance","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XC1Y4vu4ns"}],"urlSource":"https://en.wikipedia.org/wiki/Euclidean_distance","data":{"page":"Euclidean_distance","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"U9YOfTEY7t"},{"type":"text","value":"). There are also ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"abw7ZrDc5D"},{"type":"link","url":"https://towardsdatascience.com/9-distance-measures-in-data-science-918109d069fa","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"other ways to measure similarity between two vectors","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qXTRPSZtvJ"}],"urlSource":"https://towardsdatascience.com/9-distance-measures-in-data-science-918109d069fa","key":"eILGmFkh2q"},{"type":"text","value":", each with its own advantages and disadvantages. Possibly the simplest measure of similarity between two vectors is their dot product:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CcHwHWasoq"}],"key":"wVzN8m9v8G"},{"type":"math","value":"\\textbf{v} \\cdot \\textbf{w} = \\sum_{i} v_i w_i","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext mathvariant=\"bold\">v</mtext><mo>⋅</mo><mtext mathvariant=\"bold\">w</mtext><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>v</mi><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\textbf{v} \\cdot \\textbf{w} = \\sum_{i} v_i w_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">w</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.3277em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"6","key":"EFhAMV2b6z"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://www.youtube.com/watch?v=LyGKycYT2v0","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"3blue1brown has a great video on the intuition behind dot product","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Mo8RvngX6q"}],"urlSource":"https://www.youtube.com/watch?v=LyGKycYT2v0","key":"g9LgGfH3RY"},{"type":"text","value":", but for our purposes all we need to know is:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"j0GQ3njR7b"}],"key":"iKQL1rsrZS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If two vectors are pointing in the same direction, the dot product will be ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"uAaE609mGO"},{"type":"inlineMath","value":"> 0","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"IW42SkPLh7"},{"type":"text","value":" (i.e. ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"msmUI0BWxL"},{"type":"emphasis","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"similar","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ugkEvDuoHI"}],"key":"BmIygHTYbL"},{"type":"text","value":")","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"YjigykZYjN"}],"key":"Hnac3diF7C"}],"key":"fptGkCVF01"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If they are pointing in opposing directions, the dot product will be ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"w9xiq0w8th"},{"type":"inlineMath","value":"< 0","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"SodYf76E9w"},{"type":"text","value":" (i.e. ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"rMwWcsPc7u"},{"type":"emphasis","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"dissimilar","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"cJ1A5IRvGe"}],"key":"Kqh75cH67c"},{"type":"text","value":")","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"cIS1mZ2xTH"}],"key":"x4NvheFE9U"}],"key":"u1ZTqxe5Ir"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If they are exactly perpendicular, the dot product will be ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"VkdP0bf7eN"},{"type":"text","value":"0","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"lWyCbbpVqF"},{"type":"text","value":" (i.e. ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"FKpchywx4W"},{"type":"emphasis","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"neutral","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"oE33lIwEgJ"}],"key":"SBoLUXaEaK"},{"type":"text","value":")","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"JuytCNlue7"}],"key":"TYN9ddLxI0"}],"key":"iWiRfJ9o7V"}],"key":"SRMcdcMGLy"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Using this information, we can define a simple heuristic to determine the similarity between two word vectors: The greater the dot product, the more similar two words are in ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"FXgLUZyYul"},{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"meaning","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ZkKyKv2riJ"}],"key":"Ukb6DETE38"},{"type":"text","value":".","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"CtZoryI7B2"}],"key":"t5bftRfUaR"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"aJKFTCq2Xv"}],"key":"rrgQOFw8lJ"},{"type":"text","value":": You’ll note that the magnitude of the vectors have an influence on the output of dot product. For example, given 3 vectors, ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"l29vA25VbK"},{"type":"inlineMath","value":"a = [1, 1, 1]","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>=</mo><mo stretchy=\"false\">[</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">a = [1, 1, 1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span>","key":"ZJ5j94dqwC"},{"type":"text","value":", ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"m0jXENSJhE"},{"type":"inlineMath","value":"b = [1000, 0, 0]","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mo>=</mo><mo stretchy=\"false\">[</mo><mn>1000</mn><mo separator=\"true\">,</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">b = [1000, 0, 0]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1000</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">]</span></span></span></span>","key":"N24sWjoCQQ"},{"type":"text","value":", ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"aRpOapPJEr"},{"type":"inlineMath","value":"c = [2, 2, 2]","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><mo stretchy=\"false\">[</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>2</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">c = [2, 2, 2]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span></span></span></span>","key":"C8PciPkjcV"},{"type":"text","value":", our dot product heuristic would tell us that because ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ZgW81l0gpI"},{"type":"inlineMath","value":"a \\cdot b > a \\cdot c","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><mi>b</mi><mo>&gt;</mo><mi>a</mi><mo>⋅</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">a \\cdot b &gt; a \\cdot c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span>","key":"scqJd5vBuw"},{"type":"text","value":", that ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"uowkqx6rsk"},{"type":"inlineMath","value":"a","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"piNxZfYRbK"},{"type":"text","value":" is more similar to ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"kGSLk3v0mO"},{"type":"inlineMath","value":"c","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span>","key":"BWiqwBDz1X"},{"type":"text","value":" than ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"HeGGywCVNP"},{"type":"inlineMath","value":"a","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"guyFm9PtTa"},{"type":"text","value":" is to ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Em7twvhYQw"},{"type":"inlineMath","value":"b","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>","key":"xXjIogEmFT"},{"type":"text","value":". This doesn’t seem right, since ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"LCIKiDZyR4"},{"type":"inlineMath","value":"a","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"ilTwhLCnxe"},{"type":"text","value":" and ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"oztHvvJ1P5"},{"type":"inlineMath","value":"b","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>","key":"A1t239dHtB"},{"type":"text","value":" are pointing in the exact same direction, while ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"HnBY0f565u"},{"type":"inlineMath","value":"a","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"SSFqAmyhbh"},{"type":"text","value":" and ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"XjA6mdmXqz"},{"type":"inlineMath","value":"c","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span>","key":"IhxAQ3voLm"},{"type":"text","value":" are not. ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"sqjoXERkaJ"},{"type":"link","url":"https://en.wikipedia.org/wiki/Cosine_similarity","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Cosine similarity","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"F6yz6LZlGe"}],"urlSource":"https://en.wikipedia.org/wiki/Cosine_similarity","data":{"page":"Cosine_similarity","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"v7bG1iu4Ij"},{"type":"text","value":" accounts for this normalizing the vectors to unit vectors before taking the dot product, essentially ignoring the magnitudes and only caring about the direction. So why don’t we take the cosine similarity? In a deep learning setting, the magnitude of a vector might actually contain information we care about (and we shouldn’t get rid of it). Also, if we regularize our networks properly, outlier examples like the above should not occur.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"LSRA38voaB"}],"key":"bARSdPtFCp"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Okay cool, but where do these word vectors actually come from? They usually come from some kind of learned embedding or latent representation. That is, initially the word vectors are just random numbers, but as the ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"UBfuYaulRs"},{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"qew6kQcdMY"}],"key":"YzdvSjViPe"},{"type":"text","value":" is trained, their values are adjusted to become better and better representations for words.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"cQmf9fKZ9Z"}],"key":"eVMt86sqPK"}],"key":"TQXtwE0x2r"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Attention Scores using the Dot Product","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wVErWjvkok"}],"identifier":"attention-scores-using-the-dot-product","label":"Attention Scores using the Dot Product","html_id":"attention-scores-using-the-dot-product","implicit":true,"key":"E06MCqdbsV"}],"key":"E8SW4bPCpE"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s return to our example of fruits, but this time around using word vectors to represent our words. That is ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tWgyXGzO79"},{"type":"inlineMath","value":"\\textbf{q} = \\textbf{v}_{fruit}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext mathvariant=\"bold\">q</mtext><mo>=</mo><msub><mtext mathvariant=\"bold\">v</mtext><mrow><mi>f</mi><mi>r</mi><mi>u</mi><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\textbf{q} = \\textbf{v}_{fruit}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"RtRV4c9Eky"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mAuScqXkeb"},{"type":"inlineMath","value":"\\textbf{k} = [\\textbf{v}_{apple} \\textbf{v}_{banana} \\textbf{v}_{chair}]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext mathvariant=\"bold\">k</mtext><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mtext mathvariant=\"bold\">v</mtext><mrow><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi></mrow></msub><msub><mtext mathvariant=\"bold\">v</mtext><mrow><mi>b</mi><mi>a</mi><mi>n</mi><mi>a</mi><mi>n</mi><mi>a</mi></mrow></msub><msub><mtext mathvariant=\"bold\">v</mtext><mrow><mi>c</mi><mi>h</mi><mi>a</mi><mi>i</mi><mi>r</mi></mrow></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\textbf{k} = [\\textbf{v}_{apple} \\textbf{v}_{banana} \\textbf{v}_{chair}]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">k</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">ppl</span><span class=\"mord mathnormal mtight\">e</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">banana</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"mord mathnormal mtight\">hai</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"XR3hPbvdBH"},{"type":"text","value":", such that ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S304n4djc8"},{"type":"inlineMath","value":"\\textbf{v} \\in \\mathbb{R}^{d_k}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext mathvariant=\"bold\">v</mtext><mo>∈</mo><msup><mi mathvariant=\"double-struck\">R</mi><msub><mi>d</mi><mi>k</mi></msub></msup></mrow><annotation encoding=\"application/x-tex\">\\textbf{v} \\in \\mathbb{R}^{d_k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>","key":"KFYePwrfQ9"},{"type":"text","value":" (that is each vector has the same dimensionality of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PrPTor2dzQ"},{"type":"inlineMath","value":"d_k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"iX0cGoDRNe"},{"type":"text","value":", which is a value we choose when training a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DpvppfbEb8"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dpdrm7v8Gc"}],"key":"EinsEIW2YQ"},{"type":"text","value":"). Using our new dot product similarity measure, we can compute the similarity between the query and the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mmedrUml53"},{"type":"inlineMath","value":"ith","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"RA9PAZYf76"},{"type":"text","value":" key as:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EtFQFVeB2d"}],"key":"tFpijcsckI"},{"type":"math","value":"\\textbf{x}_i = \\textbf{q} \\cdot \\textbf{k}_i","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mtext mathvariant=\"bold\">x</mtext><mi>i</mi></msub><mo>=</mo><mtext mathvariant=\"bold\">q</mtext><mo>⋅</mo><msub><mtext mathvariant=\"bold\">k</mtext><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\textbf{x}_i = \\textbf{q} \\cdot \\textbf{k}_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">k</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"7","key":"CmgkzcmRuw"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ekge3gPmXz"},{"type":"inlineMath","value":"\\textbf{a}_i","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mtext mathvariant=\"bold\">a</mtext><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\textbf{a}_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">a</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"JrgAg87FkB"},{"type":"text","value":" is the attention score for the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fhxvpkj7jI"},{"type":"inlineMath","value":"ith","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"Xfcwj7bwox"},{"type":"text","value":" key-value pair.  Generalizing this further, we can compute the dot product for all ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"a3OmbNRbwb"},{"type":"inlineMath","value":"n_k","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"bFNuSr5jyO"},{"type":"text","value":" keys with:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"K4RtvWKi0U"}],"key":"q0OEc7xfuH"},{"type":"math","value":"\\textbf{x} = \\textbf{q} \\cdot \\textbf{K}^T","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext mathvariant=\"bold\">x</mtext><mo>=</mo><mtext mathvariant=\"bold\">q</mtext><mo>⋅</mo><msup><mtext mathvariant=\"bold\">K</mtext><mi>T</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\textbf{x} = \\textbf{q} \\cdot \\textbf{K}^T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">x</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9173em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">K</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span></span>","enumerator":"8","key":"IrWFgRMrbR"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"wH7Oja60YN"},{"type":"inlineMath","value":"\\textbf{x}","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext mathvariant=\"bold\">x</mtext></mrow><annotation encoding=\"application/x-tex\">\\textbf{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">x</span></span></span></span></span>","key":"TG0KpMPoaX"},{"type":"text","value":" is our vector of dot products ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"tWNGzGksoy"},{"type":"inlineMath","value":"\\textbf{x} = [x_1, x_2, ..., x_{n_k - 1}, x_{n_k}]","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext mathvariant=\"bold\">x</mtext><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi>x</mi><mrow><msub><mi>n</mi><mi>k</mi></msub><mo>−</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><msub><mi>n</mi><mi>k</mi></msub></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\textbf{x} = [x_1, x_2, ..., x_{n_k - 1}, x_{n_k}]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">x</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0059em;vertical-align:-0.2559em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2559em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2559em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"Fjfn7pBwyy"},{"type":"text","value":" and ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CeqGMs8Gq8"},{"type":"inlineMath","value":"K","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>","key":"VfsuEegJv3"},{"type":"text","value":" is a row-wise matrix of our key vectors (i.e. our key vectors stacked on-top of each-other to form a ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"tDjMPFLNO2"},{"type":"inlineMath","value":"n_k \\times d_k","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>k</mi></msub><mo>×</mo><msub><mi>d</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_k \\times d_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"WKn7eJ1uXK"},{"type":"text","value":" matrix such that ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TTvmtt9c8J"},{"type":"inlineMath","value":"k_i","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">k_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"DT74tXsdVt"},{"type":"text","value":" is the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TVZImernVs"},{"type":"inlineMath","value":"ith","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"MkYfEeM3qa"},{"type":"text","value":" row of ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"tgAgjcwreT"},{"type":"inlineMath","value":"K","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>","key":"Jz6BbFsEKF"},{"type":"text","value":"). If you’re having trouble understanding this, here’s an explanation:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"RnxTz9gC7y"}],"key":"z9X5sPrEIt"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Basically, instead of computing each dot product separately:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"XS83Ht5YpH"}],"key":"XmFLlNcK0u"},{"type":"math","value":"x_1 = \\textbf{q} \\cdot \\textbf{k}_1 = [2, 1, 3] \\cdot [-1, 2, -1] = -3","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mtext mathvariant=\"bold\">q</mtext><mo>⋅</mo><msub><mtext mathvariant=\"bold\">k</mtext><mn>1</mn></msub><mo>=</mo><mo stretchy=\"false\">[</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo><mo>⋅</mo><mo stretchy=\"false\">[</mo><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mo>−</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo>=</mo><mo>−</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">x_1 = \\textbf{q} \\cdot \\textbf{k}_1 = [2, 1, 3] \\cdot [-1, 2, -1] = -3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">k</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">3</span></span></span></span></span>","enumerator":"9","key":"pxtrgQSRDa"},{"type":"math","value":"x_2 = \\textbf{q} \\cdot \\textbf{k}_2 = [2, 1, 3] \\cdot [1.5, 0, -1] = 0","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mo>=</mo><mtext mathvariant=\"bold\">q</mtext><mo>⋅</mo><msub><mtext mathvariant=\"bold\">k</mtext><mn>2</mn></msub><mo>=</mo><mo stretchy=\"false\">[</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo><mo>⋅</mo><mo stretchy=\"false\">[</mo><mn>1.5</mn><mo separator=\"true\">,</mo><mn>0</mn><mo separator=\"true\">,</mo><mo>−</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">x_2 = \\textbf{q} \\cdot \\textbf{k}_2 = [2, 1, 3] \\cdot [1.5, 0, -1] = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">k</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1.5</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>","enumerator":"10","key":"Kv3xHfOR9x"},{"type":"math","value":"x_3 = \\textbf{q} \\cdot \\textbf{k}_3 = [2, 1, 3] \\cdot [4, -2, -1] = 3","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>x</mi><mn>3</mn></msub><mo>=</mo><mtext mathvariant=\"bold\">q</mtext><mo>⋅</mo><msub><mtext mathvariant=\"bold\">k</mtext><mn>3</mn></msub><mo>=</mo><mo stretchy=\"false\">[</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo><mo>⋅</mo><mo stretchy=\"false\">[</mo><mn>4</mn><mo separator=\"true\">,</mo><mo>−</mo><mn>2</mn><mo separator=\"true\">,</mo><mo>−</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">x_3 = \\textbf{q} \\cdot \\textbf{k}_3 = [2, 1, 3] \\cdot [4, -2, -1] = 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">k</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">−</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span></span>","enumerator":"11","key":"iX7BC87Ooq"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"You compute it all at once:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"uwS7TeHVFE"}],"key":"E7AEpMXRRh"},{"type":"math","value":"\\textbf{x} = \\textbf{q} \\cdot \\textbf{K}^T = [2, 1, 3] \\cdot \\begin{bmatrix} -1 & 2 & -1 \\\\ 1.5 & 0 & -1 \\\\ 4 & -2 & -1 \\end{bmatrix}^T = [2, 1, 3] \\cdot \\begin{bmatrix} -1 & 1.5 & 4 \\\\ 2 & 0 & -2 \\\\ -1 & -1 & -1 \\end{bmatrix} = [-3, 0, 3] = [x_1, x_2, x_3]","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext mathvariant=\"bold\">x</mtext><mo>=</mo><mtext mathvariant=\"bold\">q</mtext><mo>⋅</mo><msup><mtext mathvariant=\"bold\">K</mtext><mi>T</mi></msup><mo>=</mo><mo stretchy=\"false\">[</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo><mo>⋅</mo><msup><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1.5</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>2</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mi>T</mi></msup><mo>=</mo><mo stretchy=\"false\">[</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo><mo>⋅</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1.5</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mo>=</mo><mo stretchy=\"false\">[</mo><mo>−</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>3</mn></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\textbf{x} = \\textbf{q} \\cdot \\textbf{K}^T = [2, 1, 3] \\cdot \\begin{bmatrix} -1 &amp; 2 &amp; -1 \\\\ 1.5 &amp; 0 &amp; -1 \\\\ 4 &amp; -2 &amp; -1 \\end{bmatrix}^T = [2, 1, 3] \\cdot \\begin{bmatrix} -1 &amp; 1.5 &amp; 4 \\\\ 2 &amp; 0 &amp; -2 \\\\ -1 &amp; -1 &amp; -1 \\end{bmatrix} = [-3, 0, 3] = [x_1, x_2, x_3]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">x</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9173em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">K</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.8313em;vertical-align:-1.55em;\"></span><span class=\"minner\"><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎣</span></span></span><span style=\"top:-3.397em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span style=\"height:0.016em;width:0.6667em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style=\"top:-4.05em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎡</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1.5</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎦</span></span></span><span style=\"top:-3.397em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span style=\"height:0.016em;width:0.6667em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style=\"top:-4.05em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎤</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2813em;\"><span style=\"top:-4.5029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.6em;vertical-align:-1.55em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎣</span></span></span><span style=\"top:-3.397em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span style=\"height:0.016em;width:0.6667em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style=\"top:-4.05em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎡</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1.5</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">2</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎦</span></span></span><span style=\"top:-3.397em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span style=\"height:0.016em;width:0.6667em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style=\"top:-4.05em;\"><span class=\"pstrut\" style=\"height:3.155em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎤</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">−</span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span></span>","enumerator":"12","key":"Zwu5RbeUQN"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Now, recall that our attention scores need to be decimal percentages (between ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"JMaSsxHjTY"},{"type":"text","value":"0","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"AwlXpg10iB"},{"type":"text","value":" and ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"lkaBRih1Oh"},{"type":"text","value":"1","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"PjRVuB2z6Y"},{"type":"text","value":" and sum to ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"fSyzcCzKOz"},{"type":"text","value":"1","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"PFBPPVR77V"},{"type":"text","value":"). Our dot product values however can be any real number (i.e. between ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Id4FTxRsxr"},{"type":"inlineMath","value":"-\\infty","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">-\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">∞</span></span></span></span>","key":"uhZ9lTeDNU"},{"type":"text","value":" and ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"yb9dPRaYQy"},{"type":"inlineMath","value":"\\infty","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord\">∞</span></span></span></span>","key":"YvcIxoWt9A"},{"type":"text","value":"). To transform our dot product values to decimal percentages, we’ll use the softmax function:","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"gNEyvVxtrV"}],"key":"dlCAwx6Vae"},{"type":"math","value":"\\text{softmax}(x) = \\frac{e^{x_i}}{\\sum_{j} e^{x_j}}","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>x</mi><mi>i</mi></msub></msup><mrow><munder><mo>∑</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>x</mi><mi>j</mi></msub></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\text{softmax}(x) = \\frac{e^{x_i}}{\\sum_{j} e^{x_j}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4632em;vertical-align:-1.1218em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3414em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.162em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4358em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6065em;\"><span style=\"top:-3.0051em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1218em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"13","key":"p506tR0Xx5"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"e.g.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Bf74mArMq5"}],"key":"VpjdB2U8ud"}],"key":"opIVMnkHty"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"softmax(np.array([4.0, -1.0, 2.1]))","key":"ij4edHoANe"},{"type":"outputs","id":"7XC9wT7vnzl7AoxcIa-lu","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/plain":{"content":"array([0.86482256, 0.00582713, 0.12935032])","content_type":"text/plain"}}},"children":[],"key":"PTfcxvG9NZ"}],"key":"phcdgdDliD"}],"key":"AFj6RGh9Gn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Notice:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MltXXVWhVb"}],"key":"oUN0kq70Ch"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"✅ Each number is between ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"AWKjceoWqa"},{"type":"text","value":"0","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sIGzdGz0OB"},{"type":"text","value":" and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rjmCrgd6xj"},{"type":"text","value":"1","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"KOMBdACXsV"}],"key":"slTXxS684g"}],"key":"A1FWvdq3Bl"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"✅ The numbers sum to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cB0DxMUh9u"},{"type":"text","value":"1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"am3mvsJKIN"}],"key":"QC1E7bTVK5"}],"key":"CG1XuYuDRW"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"✅ The larger valued inputs get more “weight”","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JAi2fUKBMv"}],"key":"sEXunA7Fu5"}],"key":"lnIzifpBWL"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"✅ The sorted order is preserved (i.e. the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yySuuj3qSx"},{"type":"text","value":"4.0","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CRCHFgvxis"},{"type":"text","value":" is still the largest after softmax, and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"GGQ93BeUH3"},{"type":"text","value":"-1.0","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ikcsd3EU51"},{"type":"text","value":" is still the lowest), this is because softmax is a ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lqDECwTeUy"},{"type":"link","url":"https://en.wikipedia.org/wiki/Monotonic_function","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"monotonic function","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"STHq06VXun"}],"urlSource":"https://en.wikipedia.org/wiki/Monotonic_function","data":{"page":"Monotonic_function","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"NLaLVKUPay"}],"key":"RbmcYFPML0"}],"key":"ewVNh9H0H2"}],"key":"GrqZNLCnn3"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This satisfies all the desired properties of an attention scores. Thus, we can compute the attention score for the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fJVsXAOJ9E"},{"type":"inlineMath","value":"ith","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"O3CTu4SfOr"},{"type":"text","value":" key-value pair with:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zrOELA0KGh"}],"key":"jYWyrBfjFR"},{"type":"math","value":"a_i = \\text{softmax}(x)_i = \\text{softmax}(\\textbf{q} \\textbf{K}^T)_i","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mi>x</mi><msub><mo stretchy=\"false\">)</mo><mi>i</mi></msub><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mtext mathvariant=\"bold\">q</mtext><msup><mtext mathvariant=\"bold\">K</mtext><mi>T</mi></msup><msub><mo stretchy=\"false\">)</mo><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i = \\text{softmax}(x)_i = \\text{softmax}(\\textbf{q} \\textbf{K}^T)_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1673em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">K</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"14","key":"FqJn2OUfsn"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Plugging this into our weighted sum we get:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VYAV78KKQZ"}],"key":"d6ryaas0ZQ"},{"type":"math","value":"\\sum_{i} a_i v_i = \\sum_{i} \\text{softmax}(\\textbf{x})_i v_i = \\sum_{i} \\text{softmax}(\\textbf{q} \\textbf{K}^T)_i v_i = \\text{softmax}(\\textbf{q} \\textbf{K}^T) \\textbf{v}","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>a</mi><mi>i</mi></msub><msub><mi>v</mi><mi>i</mi></msub><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mtext mathvariant=\"bold\">x</mtext><msub><mo stretchy=\"false\">)</mo><mi>i</mi></msub><msub><mi>v</mi><mi>i</mi></msub><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mtext mathvariant=\"bold\">q</mtext><msup><mtext mathvariant=\"bold\">K</mtext><mi>T</mi></msup><msub><mo stretchy=\"false\">)</mo><mi>i</mi></msub><msub><mi>v</mi><mi>i</mi></msub><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mtext mathvariant=\"bold\">q</mtext><msup><mtext mathvariant=\"bold\">K</mtext><mi>T</mi></msup><mo stretchy=\"false\">)</mo><mtext mathvariant=\"bold\">v</mtext></mrow><annotation encoding=\"application/x-tex\">\\sum_{i} a_i v_i = \\sum_{i} \\text{softmax}(\\textbf{x})_i v_i = \\sum_{i} \\text{softmax}(\\textbf{q} \\textbf{K}^T)_i v_i = \\text{softmax}(\\textbf{q} \\textbf{K}^T) \\textbf{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.3277em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.3277em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textbf\">x</span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.3277em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">K</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1673em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">K</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord text\"><span class=\"mord textbf\">v</span></span></span></span></span></span>","enumerator":"15","key":"sAdzf52E9O"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Note: In the last step, we pack our values into a vector ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"pGgeqIVPqd"},{"type":"inlineMath","value":"\\textbf{v} = [v_1, v_2, ..., v_{n_k - 1}, v_{n_k}]","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext mathvariant=\"bold\">v</mtext><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>v</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi>v</mi><mrow><msub><mi>n</mi><mi>k</mi></msub><mo>−</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mi>v</mi><msub><mi>n</mi><mi>k</mi></msub></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\textbf{v} = [v_1, v_2, ..., v_{n_k - 1}, v_{n_k}]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0059em;vertical-align:-0.2559em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2559em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2559em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"c4o8O4ob3d"},{"type":"text","value":", which allows us to get rid of the summation notation in favor of a dot product. And that’s it, we have a full working definition for attention:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fCa1pNHetu"}],"key":"j6UOl6W00T"},{"type":"math","value":"\\text{attention}(\\textbf{q}, K, \\textbf{v}) = \\text{softmax}(\\textbf{qK}^T)\\textbf{v}","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>attention</mtext><mo stretchy=\"false\">(</mo><mtext mathvariant=\"bold\">q</mtext><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mtext mathvariant=\"bold\">v</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><msup><mtext mathvariant=\"bold\">qK</mtext><mi>T</mi></msup><mo stretchy=\"false\">)</mo><mtext mathvariant=\"bold\">v</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{attention}(\\textbf{q}, K, \\textbf{v}) = \\text{softmax}(\\textbf{qK}^T)\\textbf{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">v</span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1673em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">qK</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord text\"><span class=\"mord textbf\">v</span></span></span></span></span></span>","enumerator":"16","key":"Hu1DKcwCPf"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"In code:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"duJspB5lrZ"}],"key":"wNDCodeY0W"}],"key":"wMnzyWBEpa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def get_word_vector(word, d_k=8):\n    \"\"\"Hypothetical mapping that returns a word vector of size\n    d_k for the given word. For demonstrative purposes, we initialize\n    this vector randomly, but in practice this would come from a learned\n    embedding or some kind of latent representation.\"\"\"\n    return np.random.normal(size=(d_k,))\n\n\ndef attention(q, K, v):\n    # assumes q is a vector of shape (d_k)\n    # assumes K is a matrix of shape (n_k, d_k)\n    # assumes v is a vector of shape (n_k)\n    return softmax(q @ K.T) @ v\n\n\ndef kv_lookup(query, keys, values):\n    return attention(\n        q=get_word_vector(query),\n        K=np.array([get_word_vector(key) for key in keys]),\n        v=values,\n    )\n\n\n# returns some float number\nprint(kv_lookup(\"fruit\", [\"apple\", \"banana\", \"chair\"], [10, 5, 2]))","key":"rGkh5BDush"},{"type":"outputs","id":"TL1_-WrrXKKK_iP9bt3Eu","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"6.589311199486881\n"},"children":[],"key":"zrTqy33mgO"}],"key":"Wr2O6l1NI2"}],"key":"D0o4gl5NT3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Scaled Dot Product Attention","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gzk78TQaHa"}],"identifier":"scaled-dot-product-attention","label":"Scaled Dot Product Attention","html_id":"scaled-dot-product-attention","implicit":true,"key":"pBd6fIq4bM"}],"key":"vw83ZXnqrx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In principle, the attention equation we derived in the last section is complete. However, we’ll need to make a couple of changes to match the version in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xreJaAfrp1"},{"type":"link","url":"https://arxiv.org/pdf/1706.03762.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Attention is All You Need","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LA2ly08J6K"}],"urlSource":"https://arxiv.org/pdf/1706.03762.pdf","key":"iTSuDAAWMZ"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gpD8pUvyNZ"}],"key":"KaiLJpaRT8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Values as Vectors","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lwVUnI0GTU"}],"key":"rLPPEuMNIx"}],"key":"DLhGpXfDyc"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Currently, our values in the key-value pairs are just numbers. However, we could also instead replace them with vectors of some size ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ynI0UB4gBY"},{"type":"inlineMath","value":"d_v","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"IEPhhA8hir"},{"type":"text","value":". For example, with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qjkbwLnqGU"},{"type":"inlineMath","value":"d_v = 4","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>v</mi></msub><mo>=</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">d_v = 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"dToJ4BcENr"},{"type":"text","value":", you might have:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"f4bCPTcRsa"}],"key":"sXvQtmi8sb"},{"type":"code","lang":"python","value":"d = {\n    \"apple\": [0.9, 0.2, -0.5, 1.0]\n    \"banana\": [1.2, 2.0, 0.1, 0.2]\n    \"chair\": [-1.2, -2.0, 1.0, -0.2]\n}","position":{"start":{"line":7,"column":1},"end":{"line":13,"column":1}},"key":"bSpdLzrRtt"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"When we compute our output via a weighted sum, we’d be doing a weighted sum over vectors instead of numbers (i.e. scalar-vector multiplication instead of scalar-scalar multiplication). This is desirable because vectors let us hold/convey more information than just a single number. To adjust for this change in our equation, instead of multiplying our attention scores by a vector ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"LxAKKMFHIP"},{"type":"inlineMath","value":"v","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>","key":"AuPvlYgoFl"},{"type":"text","value":", we multiply it by the row-wise matrix of our value vectors ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"hMdv76z5AF"},{"type":"inlineMath","value":"V","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>","key":"r01CtO21KQ"},{"type":"text","value":" (similar to how we stacked our keys to form ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"YJsOTSIWpV"},{"type":"inlineMath","value":"K","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>","key":"LsXO38oBaS"},{"type":"text","value":"):","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Dzjf0DOfGN"}],"key":"JI6sFM67Y7"},{"type":"math","value":"\\text{attention}(\\textbf{q}, K, V) = \\text{softmax}(\\textbf{qK}^T)V","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>attention</mtext><mo stretchy=\"false\">(</mo><mtext mathvariant=\"bold\">q</mtext><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><msup><mtext mathvariant=\"bold\">qK</mtext><mi>T</mi></msup><mo stretchy=\"false\">)</mo><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">\\text{attention}(\\textbf{q}, K, V) = \\text{softmax}(\\textbf{qK}^T)V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1673em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">qK</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>","enumerator":"17","key":"lEGQqqwCwE"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Of course, our output is no longer a scalar, instead it would be a vector of dimensionality ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"MsTKrOshMO"},{"type":"inlineMath","value":"d_v","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"LvlItMdxN0"},{"type":"text","value":".","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"jXyZzNAnCi"}],"key":"oNx5WTUnit"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Scaling","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ezhO25RIs5"}],"key":"OD4TVWEPaN"}],"key":"Tjb58ulEN7"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"The dot product between our query and keys can get really large in magnitude if ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"OJlE9qDZvq"},{"type":"inlineMath","value":"d_k","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"fIxTCrSA0D"},{"type":"text","value":" is large. This makes the output of softmax more ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"HjFJmUy3tW"},{"type":"emphasis","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"extreme","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"YGxxoHE1Po"}],"key":"gqdevLhio9"},{"type":"text","value":". For example, ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"EA5wmpubH4"},{"type":"inlineCode","value":"softmax([3, 2, 1]) = [0.665, 0.244, 0.090]","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"tBdrvKB4xX"},{"type":"text","value":", but with larger values ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"t9J76aBJjS"},{"type":"inlineCode","value":"softmax([30, 20, 10]) = [9.99954600e-01, 4.53978686e-05, 2.06106005e-09]","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"lXnsN908m2"},{"type":"text","value":". When training a ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"yBI2m6r195"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"GVpR8HwTtf"}],"key":"HFjzXSA31H"},{"type":"text","value":", this would mean the gradients would become really small which is undesirable. As a solution, we scale our pre-softmax scores by ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"c6S7fD0i8R"},{"type":"inlineMath","value":"\\frac{1}{\\sqrt{d_k}}","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mn>1</mn><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{1}{\\sqrt{d_k}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.3831em;vertical-align:-0.538em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.5864em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord sqrt mtight\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8622em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mtight\" style=\"padding-left:0.833em;\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.8222em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail mtight\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1778em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.538em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"HJJJlXGHvO"},{"type":"text","value":":","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"qvg19e7Ocs"}],"key":"IUqU0XRtWp"},{"type":"math","value":"\\text{attention}(\\textbf{q}, K, V) = \\text{softmax}(\\frac{\\textbf{qK}^T}{\\sqrt{d_k}})V","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>attention</mtext><mo stretchy=\"false\">(</mo><mtext mathvariant=\"bold\">q</mtext><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mfrac><msup><mtext mathvariant=\"bold\">qK</mtext><mi>T</mi></msup><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy=\"false\">)</mo><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">\\text{attention}(\\textbf{q}, K, V) = \\text{softmax}(\\frac{\\textbf{qK}^T}{\\sqrt{d_k}})V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textbf\">q</span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.5243em;vertical-align:-0.93em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5943em;\"><span style=\"top:-2.2528em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8572em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.8172em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1828em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">qK</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9173em;\"><span style=\"top:-3.139em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>","enumerator":"18","key":"uF3ynmYGhW"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"strong","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Multiple Queries","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"aHKDyJjJMH"}],"key":"G6KRsYSuHa"}],"key":"gRfroZz5Fb"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"In practice, we often want to perform multiple lookups for ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"PuYShuXapN"},{"type":"inlineMath","value":"n_q","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>q</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"Wl8bftlbVE"},{"type":"text","value":" different queries rather than just a single query. Of course, we could always do this one at a time, plugging each query individually into the above equation. However, if we stack of query vectors row-wise as a matrix ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"G95Ng2n4Q7"},{"type":"inlineMath","value":"Q","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>","key":"WZvMkUPWyb"},{"type":"text","value":" (in the same way we did for ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"lmnqz9tW1K"},{"type":"inlineMath","value":"K","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>","key":"eHtmljwDfT"},{"type":"text","value":" and ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"lsbChH0Bx5"},{"type":"inlineMath","value":"V","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>","key":"JFqFH1La8V"},{"type":"text","value":"), we can compute our output as an ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"KxPNGivpRn"},{"type":"inlineMath","value":"n_q \\times d_v","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>q</mi></msub><mo>×</mo><msub><mi>d</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_q \\times d_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"WdTRQEBEzE"},{"type":"text","value":" matrix where row ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"mhmIpTtTOx"},{"type":"inlineMath","value":"i","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>","key":"VB8POphvDx"},{"type":"text","value":" is the output vector for the attention on the ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"W2frVJ3a7N"},{"type":"inlineMath","value":"ith","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">ith</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"GBjhPnWbv3"},{"type":"text","value":" query:","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"DSYomPcC0n"}],"key":"hiu7FlAZph"},{"type":"math","value":"\\text{attention}(Q, K, V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}})V","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>attention</mtext><mo stretchy=\"false\">(</mo><mi>Q</mi><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy=\"false\">)</mo><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">\\text{attention}(Q, K, V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}})V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">Q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4483em;vertical-align:-0.93em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5183em;\"><span style=\"top:-2.2528em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8572em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.8172em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1828em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>","enumerator":"19","key":"FOrJTzi9ux"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"that is, ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"H5ct8GsjVo"}],"key":"fCu97MDGNu"},{"type":"math","value":"\\text{attention}(Q, K, V)_i = \\text{attention}(q_i, K, V)","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"tight":"before","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>attention</mtext><mo stretchy=\"false\">(</mo><mi>Q</mi><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><msub><mo stretchy=\"false\">)</mo><mi>i</mi></msub><mo>=</mo><mtext>attention</mtext><mo stretchy=\"false\">(</mo><msub><mi>q</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{attention}(Q, K, V)_i = \\text{attention}(q_i, K, V)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">Q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"20","key":"dwIeuXLugN"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"This makes computation faster than if we ran attention for each query sequentially (say, in a for loop) since we can parallelize calculations (particularly when using a GPU). Note, our input to softmax becomes a matrix instead of a vector. When we write softmax here, we mean that we are taking the softmax along each row of the matrix independently, as if we were doing things sequentially.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"iJh4DJpxDe"}],"key":"TB0DZVZVXr"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"strong","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Result","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"hyy0qplxr4"}],"key":"lFN4INc1I3"}],"key":"lWnVGccmre"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"With that, we have our final equation for scaled dot product attention as it’s written in the ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"arKv0PzJTm"},{"type":"link","url":"https://arxiv.org/pdf/1706.03762.pdf","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"original transformer paper","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"z6BvoTd2IP"}],"urlSource":"https://arxiv.org/pdf/1706.03762.pdf","key":"PmXbS6CCZf"},{"type":"text","value":":","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"U8fry3g8UZ"}],"key":"bIPYKt7u8v"},{"type":"math","value":"\\text{attention}(Q, K, V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}})V","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>attention</mtext><mo stretchy=\"false\">(</mo><mi>Q</mi><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy=\"false\">)</mo><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">\\text{attention}(Q, K, V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d_k}})V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">attention</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">Q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4483em;vertical-align:-0.93em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5183em;\"><span style=\"top:-2.2528em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8572em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.8172em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1828em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>","enumerator":"21","key":"GCnCiKx85p"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"In code:","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"KfnZPrPSb5"}],"key":"LOi7gE2my8"}],"key":"G1mdENtDjt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def attention(q, k, v):  # [n_q, d_k], [n_k, d_k], [n_k, d_v] -> [n_q, d_v]\n    # assumes q is a matrix of shape [n_q, d_k]\n    # assumes k is a matrix of shape [n_k, d_k]\n    # assumes v is a matrix of shape [n_k, d_v]\n    # output is a matrix of shape [n_q, d_v]\n    d_k = k.shape[-1]\n    return softmax(q @ k.T / np.sqrt(d_k)) @ v","key":"AWQZi3tmDE"},{"type":"outputs","id":"0o0JgOjX40PZuGaoRhcm2","children":[],"key":"N6YLeQ6rnl"}],"key":"UEAYEIBQZO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Self","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dKUXakc8JO"}],"identifier":"self","label":"Self","html_id":"self","implicit":true,"key":"QE11x8vsIK"}],"key":"xZ9klYJhh0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"When ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dP86D0KZUj"},{"type":"inlineCode","value":"q","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ukKGHfk5WA"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H4G0VFVe8l"},{"type":"inlineCode","value":"k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dXireQoN6G"},{"type":"text","value":", and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tiqSD975Vx"},{"type":"inlineCode","value":"v","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y5t4O5hvoB"},{"type":"text","value":" all come from the same source, we are performing ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DV9CKf728L"},{"type":"link","url":"https://lilianweng.github.io/posts/2018-06-24-attention/#self-attention","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"self-attention","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PnnSyJh6uW"}],"urlSource":"https://lilianweng.github.io/posts/2018-06-24-attention/#self-attention","key":"flfzsy0qgk"},{"type":"text","value":" (i.e. letting our input sequence attend to itself):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J6ympNSz5X"}],"key":"doUr4JMxJ7"}],"key":"k1Ab0qlSgT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def self_attention(x):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    return attention(q=x, k=x, v=x)","key":"uA5lno5kPb"},{"type":"outputs","id":"tArmLYbP18NI0x8xENYTG","children":[],"key":"Iw9XOYOciI"}],"key":"cgZR2l8T58"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For example, if our input is ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dYBnhLbE4i"},{"type":"inlineCode","value":"Jay went to the store, he bought 10 apples.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FgWz35dKzJ"},{"type":"text","value":", we would be letting the word ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JG28b50cRM"},{"type":"inlineCode","value":"he","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KZOsXUoVCA"},{"type":"text","value":" attend to all the other words, including ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VKdVwoKSao"},{"type":"inlineCode","value":"Jay","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yjooX8Adje"},{"type":"text","value":", meaning the model can learn to recognize that ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lqimgWLyVS"},{"type":"inlineCode","value":"he","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tUsfNz4fQ5"},{"type":"text","value":" is referring to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fop6MAqsjR"},{"type":"inlineCode","value":"Jay","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GvfgxHt62A"},{"type":"text","value":". We can enhance self attention by introducing projections for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WRXvFAWJxW"},{"type":"inlineCode","value":"q","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kSgmK9Fl3m"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yskWhU7ead"},{"type":"inlineCode","value":"k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lQTX3RNppG"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dDnpei7UwY"},{"type":"inlineCode","value":"v","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Xi9cR1z8Q8"},{"type":"text","value":" and the attention output:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z6lZzgKsa5"}],"key":"Yf3aRoRxAH"}],"key":"mwRt4PQFhD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def self_attention(x, w_k, w_q, w_v, w_proj):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # qkv projections\n    q = x @ w_q  # [n_seq, n_embd] @ [n_embd, n_embd] -> [n_seq, n_embd]\n    k = x @ w_k  # [n_seq, n_embd] @ [n_embd, n_embd] -> [n_seq, n_embd]\n    v = x @ w_v  # [n_seq, n_embd] @ [n_embd, n_embd] -> [n_seq, n_embd]\n\n    # perform self attention\n    x = attention(q, k, v)  # [n_seq, n_embd] -> [n_seq, n_embd]\n\n    # out projection\n    x = x @ w_proj  # [n_seq, n_embd] @ [n_embd, n_embd] -> [n_seq, n_embd]\n\n    return x","key":"kCBXwK2ml6"},{"type":"outputs","id":"ABNt6JJmj4hn5H0s-zc_V","children":[],"key":"l9Vw59DOmo"}],"key":"ZkcMOkh9pH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This enables our model to learn a mapping for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oacHpo8jw0"},{"type":"inlineCode","value":"q","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vYMB312ZK1"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UlhK4WbthX"},{"type":"inlineCode","value":"k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p3NKXusRBz"},{"type":"text","value":", and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NepRpqiToB"},{"type":"inlineCode","value":"v","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UBPohNKypl"},{"type":"text","value":" that best helps attention distinguish relationships between inputs. We can reduce the number of matrix multiplication from ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Yk3bQ13nXb"},{"type":"text","value":"4","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iQX4gl0yPm"},{"type":"text","value":" to just ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gOLzxfx3lL"},{"type":"text","value":"2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jSX0W1Z8uy"},{"type":"text","value":" if we combine ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dpNB9f3B9l"},{"type":"inlineCode","value":"w_q","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KxHhP5vRIW"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HpYWfFQ9i3"},{"type":"inlineCode","value":"w_k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZS9Zyxjtij"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cvK0bxTGrO"},{"type":"inlineCode","value":"w_v","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E5D2whUXOL"},{"type":"text","value":" into a single matrix ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yHfEPMbHNj"},{"type":"inlineCode","value":"w_fc","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g1yQHPRlhC"},{"type":"text","value":", perform the projection, and then split the result:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RTAy69iiwU"}],"key":"a1RBE68gqB"}],"key":"cG3IL7OZNL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def self_attention(x, w_fc, w_proj):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # qkv projections\n    x = x @ w_fc  # [n_seq, n_embd] @ [n_embd, 3*n_embd] -> [n_seq, 3*n_embd]\n\n    # split into qkv\n    q, k, v = np.split(x, 3, axis=-1)  # [n_seq, 3*n_embd] -> 3 of [n_seq, n_embd]\n\n    # perform self attention\n    x = attention(q, k, v)  # [n_seq, n_embd] -> [n_seq, n_embd]\n\n    # out projection\n    x = x @ w_proj  # [n_seq, n_embd] @ [n_embd, n_embd] = [n_seq, n_embd]\n\n    return x","key":"uBUXPorVyZ"},{"type":"outputs","id":"dKplSbC3YFC8NHFPyj46k","children":[],"key":"itThV4GyNn"}],"key":"XevxmXUjPt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This is a bit more efficient as modern accelerators (GPUs) can take better advantage of one large matrix multiplication rather than ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x05J1u9z2M"},{"type":"text","value":"3","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y0hRRe8YPm"},{"type":"text","value":" separate small ones happening sequentially. Finally, we add bias vectors to match the implementation of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Fi2m4yDFO0"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XCHZ1Mmg9i"}],"key":"KZU59GVVHW"},{"type":"text","value":"-2, use our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uEt52MXmtb"},{"type":"inlineCode","value":"linear","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B1QbJO802d"},{"type":"text","value":" function, and rename our parameters to match our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vjJ9xizw89"},{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ai3fvpFcMV"},{"type":"text","value":" dictionary:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Krbo264qH5"}],"key":"tS9JkcUjGG"}],"key":"RElHXyvnYQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def self_attention(x, c_attn, c_proj):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # qkv projections\n    x = linear(x, **c_attn)  # [n_seq, n_embd] -> [n_seq, 3*n_embd]\n\n    # split into qkv\n    q, k, v = np.split(x, 3, axis=-1)  # [n_seq, 3*n_embd] -> 3 of [n_seq, n_embd]\n\n    # perform self attention\n    x = attention(q, k, v)  # [n_seq, n_embd] -> [n_seq, n_embd]\n\n    # out projection\n    x = linear(x, **c_proj)  # [n_seq, n_embd] @ [n_embd, n_embd] = [n_seq, n_embd]\n\n    return x","key":"OVvdPXpI9D"},{"type":"outputs","id":"lINMkhH5dCPkN1ixj-ipr","children":[],"key":"mH7SDiEYmO"}],"key":"C7QlJhDJvy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Recall, from our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vAyibJ4ogx"},{"type":"inlineCode","value":"params","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dgyTQhwo2E"},{"type":"text","value":" dictionary, our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I4z7DiwK9b"},{"type":"inlineCode","value":"attn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Vf3nYQlsrN"},{"type":"text","value":" params look like this:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VORS4lnaEj"}],"key":"QRqVnEK3ua"},{"type":"code","lang":"python","value":"\"attn\": {\n    \"c_attn\": {\"b\": [3*n_embd], \"w\": [n_embd, 3*n_embd]},\n    \"c_proj\": {\"b\": [n_embd], \"w\": [n_embd, n_embd]},\n},","position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"key":"Kf3JeVS2OB"}],"key":"T1fvx2kjt1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Causal","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HPmybWd6UO"}],"identifier":"causal","label":"Causal","html_id":"causal","implicit":true,"key":"c6rI96H9yR"}],"key":"afsD3ogQ1Z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There is a bit of an issue with our current self-attention setup, our inputs can see into the future! For example, if our input is ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LcKeMHVHlb"},{"type":"inlineCode","value":"[\"not\", \"all\", \"heroes\", \"wear\", \"capes\"]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"At7n7USDKs"},{"type":"text","value":", during self attention we are allowing ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IXxeuZyk0y"},{"type":"inlineCode","value":"\"wear\"","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z5sFKSE80A"},{"type":"text","value":" to see ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z0BD5EsQeu"},{"type":"inlineCode","value":"\"capes\"","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UKvDQawkU3"},{"type":"text","value":". This means our output probabilities for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FDhfzHdb3z"},{"type":"inlineCode","value":"\"wear\"","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WzgOWjkdGY"},{"type":"text","value":" will be biased since the model already knows the correct answer is ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ejs5pnIO73"},{"type":"inlineCode","value":"\"capes\"","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"muYegPRPd5"},{"type":"text","value":". This is no good since our model will just learn that the correct answer for input ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AAzQ60IKQ7"},{"type":"inlineMath","value":"i","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>","key":"M5xjg9Kp7x"},{"type":"text","value":" can be taken from input ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NyNRTXDb4q"},{"type":"inlineMath","value":"i+1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"qNv2rOjMFk"},{"type":"text","value":". To prevent this, we need to somehow modify our attention matrix to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AmcoWCmuNd"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"hide","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kzcADspWYL"}],"key":"V5hPv5avb9"},{"type":"text","value":" or ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dvBcxw3VRJ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"mask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NXdFKutZoc"}],"key":"NnBYZRAuIK"},{"type":"text","value":" our inputs from being able to see into the future. For example, let’s pretend our attention matrix looks like this:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DmtQhSWxpZ"}],"key":"FhN31ylkd5"},{"type":"code","lang":"js","value":"       not    all    heroes wear   capes\n   not 0.116  0.159  0.055  0.226  0.443\n   all 0.180  0.397  0.142  0.106  0.175\nheroes 0.156  0.453  0.028  0.129  0.234\n  wear 0.499  0.055  0.133  0.017  0.295\n capes 0.089  0.290  0.240  0.228  0.153","position":{"start":{"line":3,"column":1},"end":{"line":10,"column":1}},"key":"WPWvoYLiFi"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Each row corresponds to a query and the columns to a key. In this case, looking at the row for ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"mpvgwbdDm0"},{"type":"inlineCode","value":"wear","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"TnZAFFKx16"},{"type":"text","value":", you can see that it is attending to ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"BCNVHThvNY"},{"type":"inlineCode","value":"capes","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"mzxJGRyCZp"},{"type":"text","value":" in the last column with a weight of ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"AksFTgLU3t"},{"type":"text","value":"0.295","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"D97y2st4ZS"},{"type":"text","value":". To prevent this, we want to set that entry to ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"sY5RlYo3pE"},{"type":"text","value":"0.000","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"HVynf1uwi5"},{"type":"text","value":":","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"B7xd9MWJG9"}],"key":"epTWqihgd8"},{"type":"code","lang":"js","value":"        not    all    heroes wear   capes\n   not 0.116  0.159  0.055  0.226  0.443\n   all 0.180  0.397  0.142  0.106  0.175\nheroes 0.156  0.453  0.028  0.129  0.234\n  wear 0.499  0.055  0.133  0.017  0.000\n capes 0.089  0.290  0.240  0.228  0.153","position":{"start":{"line":14,"column":1},"end":{"line":21,"column":1}},"key":"kO8kctDIuR"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"In general, to prevent all the queries in our input from looking into the future, we set all positions ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"HZTGI7I6jc"},{"type":"inlineMath","value":"i, j","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">i, j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span>","key":"Ga8crIHL4Z"},{"type":"text","value":" where ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"pXQDCrw2hX"},{"type":"inlineMath","value":"j > i","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi><mo>&gt;</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">j &gt; i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>","key":"Sgpo057ihI"},{"type":"text","value":" to ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"PKBYySEqvX"},{"type":"text","value":"0.000","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"nBDzC36Hnh"},{"type":"text","value":":","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"qO74GXdLfr"}],"key":"JGYOuVpo4g"},{"type":"code","lang":"js","value":"        not    all    heroes wear   capes\n   not 0.116  0.000  0.000  0.000  0.000\n   all 0.180  0.397  0.000  0.000  0.000\nheroes 0.156  0.453  0.028  0.000  0.000\n  wear 0.499  0.055  0.133  0.017  0.000\n capes 0.089  0.290  0.240  0.228  0.153","position":{"start":{"line":25,"column":1},"end":{"line":32,"column":1}},"key":"OeQ6X873HE"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"We call this ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"vUqf4jugw8"},{"type":"strong","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"masking","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"av8nwsa6tx"}],"key":"YLZKEHIR4F"},{"type":"text","value":". One issue with our above ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"YqLz4FhSgi"},{"type":"strong","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"masking","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"j2z69fFJcj"}],"key":"sxBq0fA5ss"},{"type":"text","value":" approach is our rows no longer sum to ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"r5qYpxpP9f"},{"type":"text","value":"1","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"mNkxGvASf6"},{"type":"text","value":" (since we are setting them to ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"lt2r6R2NLy"},{"type":"text","value":"0","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"WBFkrERdwM"},{"type":"text","value":" after the ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"q4tKfFWpeE"},{"type":"inlineCode","value":"softmax","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"SIjnxCvGfl"},{"type":"text","value":" has been applied). To make sure our rows still sum to ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"fBHNIOZz1b"},{"type":"text","value":"1","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"C4qBI3byFv"},{"type":"text","value":", we need to modify our attention matrix before the ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"JcKWIJtIbH"},{"type":"inlineCode","value":"softmax","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"Y3HIW9LqxJ"},{"type":"text","value":" is applied. This can be achieved by setting entries that are to be masked to ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"yR2ONRsnr9"},{"type":"inlineMath","value":"-\\infty","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">-\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">∞</span></span></span></span>","key":"JvnXrDdQTP"},{"type":"text","value":" prior to the ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"Dka67rwgMa"},{"type":"inlineCode","value":"softmax","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"WlMqeF7Tg4"},{"type":"text","value":".","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"zrKTKPAhUB"}],"key":"ToJPKkHUqu"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"CRAPd8iYt7"}],"key":"tlA24l2GUo"},{"type":"text","value":": If you’re not convinced, stare at the softmax equation and convince yourself this is true (maybe even pull out a pen and paper):","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"ALlNd79eh8"}],"key":"cHj6qf7l4H"},{"type":"math","value":"\\text{softmax}(\\vec{x})_{i} = \\frac{e^{x_i}}{\\sum_{j} e^{x_j}}","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><msub><mo stretchy=\"false\">)</mo><mi>i</mi></msub><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>x</mi><mi>i</mi></msub></msup><mrow><munder><mo>∑</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>x</mi><mi>j</mi></msub></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\text{softmax}(\\vec{x})_{i} = \\frac{e^{x_i}}{\\sum_{j} e^{x_j}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">softmax</span></span><span class=\"mopen\">(</span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2077em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4632em;vertical-align:-1.1218em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3414em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.162em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4358em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6065em;\"><span style=\"top:-3.0051em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1218em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"22","key":"mg75Ckigtf"}],"key":"reE9RFv08X"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def attention(\n    q, k, v, mask\n):  # [n_q, d_k], [n_k, d_k], [n_k, d_v], [n_q, n_k] -> [n_q, d_v]\n    return softmax(q @ k.T / np.sqrt(q.shape[-1]) + mask) @ v","key":"Yzbw7xPcXv"},{"type":"outputs","id":"JUmPtligpIFjyX-maC2Fy","children":[],"key":"y46OHaRBnA"}],"key":"U6Yt74f9SY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wQNtuCM6to"},{"type":"inlineCode","value":"mask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VOvy5DAX7b"},{"type":"text","value":" is the matrix (for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tZrTuakMbs"},{"type":"inlineCode","value":"n_seq=5","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r6h2zpWMWw"},{"type":"text","value":"):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Otxx7lLpO6"}],"key":"xmegg2XozK"},{"type":"code","lang":"python","value":"0 -1e10 -1e10 -1e10 -1e10\n0   0   -1e10 -1e10 -1e10\n0   0     0   -1e10 -1e10\n0   0     0     0   -1e10\n0   0     0     0     0","position":{"start":{"line":3,"column":1},"end":{"line":9,"column":1}},"key":"YCcFFBm7QI"}],"key":"xPCE0HrbJS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BbINsaBcFA"},{"type":"inlineCode","value":"-1e10","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"laNY3ET3vO"},{"type":"text","value":" instead of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gy3FTQcfGS"},{"type":"inlineCode","value":"-np.inf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DY6XogtTd7"},{"type":"text","value":" as ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gfr4JvLSeF"},{"type":"inlineCode","value":"-np.inf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kweH9bRn5u"},{"type":"text","value":" can cause ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"od8CWBvw2X"},{"type":"inlineCode","value":"nan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O40qCEevt8"},{"type":"text","value":"s. Adding ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KKFfhmBjLi"},{"type":"inlineCode","value":"mask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wNvjXyg0Fa"},{"type":"text","value":" to our attention matrix instead of just explicitly setting the values to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A2zkVuCsHx"},{"type":"inlineCode","value":"-1e10","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"clUGB1ucUQ"},{"type":"text","value":" works because practically, any number plus ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MTe8Y8zb94"},{"type":"inlineCode","value":"-inf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UmFHZoYNJn"},{"type":"text","value":" is just ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"diJ3nyIfzZ"},{"type":"inlineCode","value":"-inf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VfhaDKRIxf"},{"type":"text","value":". We can compute the mask matrix in NumPy with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Gm827ZmTXw"},{"type":"inlineCode","value":"(1 - np.tri(n_seq)) * -1e10","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oOTUwC8wpu"},{"type":"text","value":". Putting it all together, we get:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kKmazSAXZ9"}],"key":"YleHdBHr16"}],"key":"e7snD7KPrk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def attention(\n    q, k, v, mask\n):  # [n_q, d_k], [n_k, d_k], [n_k, d_v], [n_q, n_k] -> [n_q, d_v]\n    return softmax(q @ k.T / np.sqrt(q.shape[-1]) + mask) @ v\n\n\ndef causal_self_attention(x, c_attn, c_proj):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # qkv projections\n    x = linear(x, **c_attn)  # [n_seq, n_embd] -> [n_seq, 3*n_embd]\n\n    # split into qkv\n    q, k, v = np.split(x, 3, axis=-1)  # [n_seq, 3*n_embd] -> 3 of [n_seq, n_embd]\n\n    # causal mask to hide future inputs from being attended to\n    causal_mask = (1 - np.tri(x.shape[0], dtype=x.dtype)) * -1e10  # [n_seq, n_seq]\n\n    # perform causal self attention\n    x = attention(q, k, v, causal_mask)  # [n_seq, n_embd] -> [n_seq, n_embd]\n\n    # out projection\n    x = linear(x, **c_proj)  # [n_seq, n_embd] @ [n_embd, n_embd] = [n_seq, n_embd]\n\n    return x","key":"cL3DtvVZMt"},{"type":"outputs","id":"n2PhPBC8jahLtW-PshnjG","children":[],"key":"aDVS6p76wK"}],"key":"GlJEuA0god"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Multi-Head","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HeEXkbJdOv"}],"identifier":"multi-head","label":"Multi-Head","html_id":"multi-head","implicit":true,"key":"p1B0ZtaDqB"}],"key":"QCyJExl51B"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can further improve our implementation by performing ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KILsBoE1un"},{"type":"inlineCode","value":"n_head","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iGI6HfVUux"},{"type":"text","value":" separate attention computations, splitting our queries, keys, and values into heads:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZswE8knAjb"}],"key":"WOYmCxYNGL"}],"key":"UJA2HHIm4o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def mha(x, c_attn, c_proj, n_head):  # [n_seq, n_embd] -> [n_seq, n_embd]\n    # qkv projection\n    x = linear(x, **c_attn)  # [n_seq, n_embd] -> [n_seq, 3*n_embd]\n\n    # split into qkv\n    qkv = np.split(x, 3, axis=-1)  # [n_seq, 3*n_embd] -> [3, n_seq, n_embd]\n\n    # split into heads\n    qkv_heads = list(\n        map(lambda x: np.split(x, n_head, axis=-1), qkv)\n    )  # [3, n_seq, n_embd] -> [3, n_head, n_seq, n_embd/n_head]\n\n    # causal mask to hide future inputs from being attended to\n    causal_mask = (1 - np.tri(x.shape[0], dtype=x.dtype)) * -1e10  # [n_seq, n_seq]\n\n    # perform attention over each head\n    out_heads = [\n        attention(q, k, v, causal_mask) for q, k, v in zip(*qkv_heads)\n    ]  # [3, n_head, n_seq, n_embd/n_head] -> [n_head, n_seq, n_embd/n_head]\n\n    # merge heads\n    x = np.hstack(out_heads)  # [n_head, n_seq, n_embd/n_head] -> [n_seq, n_embd]\n\n    # out projection\n    x = linear(x, **c_proj)  # [n_seq, n_embd] -> [n_seq, n_embd]\n\n    return x","key":"fWNOqFjfly"},{"type":"outputs","id":"wnSNVIh1ts1LGF7C0GXB8","children":[],"key":"VIKEkOJBdL"}],"key":"y0os7jIqHc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There are three steps added here:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BYxePJWRNB"}],"key":"vOJkRB8HjU"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Split ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Dvvj0pUKkj"},{"type":"inlineCode","value":"q","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"J93B4HQ4gJ"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UDPAF4pZWl"},{"type":"inlineCode","value":"k","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bmJgqXfcAe"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UsoMriqjib"},{"type":"inlineCode","value":"v","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"huKvFft7xC"},{"type":"text","value":" into ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eCZjNKC61q"},{"type":"inlineCode","value":"n_head","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"GpIjzZYAgf"},{"type":"text","value":" heads:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TEWWxa2KpP"}],"key":"oMsO9GFUfV"}],"key":"KFpk7etipZ"}],"key":"jeEkviaAwS"},{"type":"code","lang":"python","value":"# split into heads\nqkv_heads = list(map(lambda x: np.split(x, n_head, axis=-1), qkv))  # [3, n_seq, n_embd] -> [n_head, 3, n_seq, n_embd/n_head]","position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"key":"OaQs7KiPvm"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Compute attention for each head:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"LPfZpx2iI5"}],"key":"Kk16El7qBQ"}],"key":"jJytLYJqGx"}],"key":"aSj4bx3WQY"},{"type":"code","lang":"python","value":"# perform attention over each head\nout_heads = [attention(q, k, v) for q, k, v in zip(*qkv_heads)]  # [n_head, 3, n_seq, n_embd/n_head] -> [n_head, n_seq, n_embd/n_head]","position":{"start":{"line":11,"column":1},"end":{"line":14,"column":1}},"key":"kELB7GbuPw"},{"type":"list","ordered":true,"start":3,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Merge the outputs of each head:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"GW01AkUawe"}],"key":"ZBN69Ursar"}],"key":"k6qUYPuxxb"}],"key":"GD10Tdh9eZ"},{"type":"code","lang":"python","value":"# merge heads\nx = np.hstack(out_heads)  # [n_head, n_seq, n_embd/n_head] -> [n_seq, n_embd]","position":{"start":{"line":17,"column":1},"end":{"line":20,"column":1}},"key":"KWvfpuflWP"}],"key":"u0ZKD3JsHI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Notice, this reduces the dimension from ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Fb7j0gRAln"},{"type":"inlineCode","value":"n_embd","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UU6B2QgxrI"},{"type":"text","value":" to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bKehZhbWXL"},{"type":"inlineCode","value":"n_embd/n_head","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vFZxUGERJ5"},{"type":"text","value":" for each attention computation. This is a tradeoff. For reduced dimensionality, our model gets additional subspaces to work when modeling relationships via attention. For example, maybe one attention head is responsible for connecting pronouns to the person the pronoun is referencing. Maybe another might be responsible for grouping sentences by periods. Another could simply be identifying which words are entities, and which are not. Although, it’s probably just another ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BFQcJz12Zw"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fcqE2PVOKs"}],"key":"DO9iKL59v3"},{"type":"text","value":" black box. The code we wrote performs the attention computations over each head sequentially in a loop (one at a time), which is not very efficient. In practice, you’d want to do these in parallel. For simplicity, we’ll just leave this sequential. With that, we’re finally done our ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KirICqWIvG"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TTnuWMvcjF"}],"key":"apLTUoumjv"},{"type":"text","value":" implementation! Now, all that’s left to do is put it all together and run our code.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rNYxfnRjyH"}],"key":"LpPloRTXiF"}],"key":"MgDzd3DauP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Putting it All Together","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZzEWGmQvo2"}],"identifier":"putting-it-all-together","label":"Putting it All Together","html_id":"putting-it-all-together","implicit":true,"key":"WQxay7cagF"}],"key":"JKMZSDl6Ut"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Having put everything together, we get the equivalent of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w9hgSdeK9E"},{"type":"link","url":"https://github.com/jaymody/picoGPT/blob/main/gpt2.py","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"gpt2.py","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D5u7rAtQoV"}],"urlSource":"https://github.com/jaymody/picoGPT/blob/main/gpt2.py","data":{"kind":"file","org":"jaymody","repo":"picoGPT","reference":"main","file":"gpt2.py","raw":"https://raw.githubusercontent.com/jaymody/picoGPT/main/gpt2.py"},"internal":false,"protocol":"github","key":"NlOLzUdgwT"},{"type":"text","value":", which in its entirety is a mere ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KzpHKOIlB0"},{"type":"text","value":"120","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GTIDYYkoSL"},{"type":"text","value":" lines of code (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xuoL2sikp4"},{"type":"link","url":"https://github.com/jaymody/picoGPT/blob/a750c145ba4d09d5764806a6c78c71ffaff88e64/gpt2_pico.py#L3-L58","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"60","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bv8LkNXWmi"},{"type":"text","value":" lines if you remove comments and whitespace!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ak1m3S9O9o"}],"urlSource":"https://github.com/jaymody/picoGPT/blob/a750c145ba4d09d5764806a6c78c71ffaff88e64/gpt2_pico.py#L3-L58","data":{"kind":"file","org":"jaymody","repo":"picoGPT","reference":"a750c145ba4d09d5764806a6c78c71ffaff88e64","file":"gpt2_pico.py","from":3,"to":58,"raw":"https://raw.githubusercontent.com/jaymody/picoGPT/a750c145ba4d09d5764806a6c78c71ffaff88e64/gpt2_pico.py"},"internal":false,"protocol":"github","key":"yrKHuQlLOZ"},{"type":"text","value":"). All that remains, it to test our implementation by prompting our tiny ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AGcF8MdzHo"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vIB7ksnPMr"}],"key":"MvXtywIKtU"},{"type":"text","value":"-2 model:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xlxOVUc7tl"}],"key":"kpABEqgbNH"}],"key":"GQHEWsIR5U"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"output = prompt_gpt(\"Alan Turing theorized that computers would one day become\", n_tokens_to_generate=8)\nassert output == \" the most powerful machines on the planet.\"\nprint(output)","key":"LGOZYMxLjg"},{"type":"outputs","id":"Z7kQ98v7HrkvhdSx5uRrS","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-02-18 12:27:30.196142: W external/local_xla/xla/tsl/framework/cpu_allocator_impl.cc:83] Allocation of 154389504 exceeds 10% of free system memory.\ngenerating: 100%|██████████| 8/8 [00:07<00:00,  1.03it/s]"},"children":[],"key":"CNHudNIS9R"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":" the most powerful machines on the planet.\n"},"children":[],"key":"pj44CPTv6m"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"\n"},"children":[],"key":"Yxefq9j3uv"}],"key":"y8vK9FTXsa"}],"key":"FgzmqH8DHs"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It works! We can also test that our implementation gives identical results to OpenAI’s official ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LmUCcYgzcm"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iwuC3CD6Rs"}],"key":"vHFbsBgwtU"},{"type":"text","value":"-2 repo by building and executing the Docker container as follows:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V6wZun3yvi"}],"key":"JccSSM7Brb"},{"type":"code","lang":"bash","value":"docker build -t \"openai-gpt-2\" - <<EOF\nFROM tensorflow/tensorflow:1.13.2-py3\n\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt update -y && apt upgrade -y && apt install git -y\n\nRUN git clone https://github.com/openai/gpt-2 /gpt-2\nWORKDIR /gpt-2\n\nRUN python3 -m pip install --upgrade pip && python3 -m pip install -r requirements.txt\nRUN python3 download_model.py 124M\nRUN python3 download_model.py 355M\nRUN python3 download_model.py 774M\nRUN python3 download_model.py 1558M\nEOF\n\ndocker run -dt --name \"openai-gpt-2-app\" openai-gpt-2\ndocker exec -it \"openai-gpt-2-app\" /bin/bash -c 'python3 src/interactive_conditional_samples.py --length 8 --model_type 124M --top_k 1'","position":{"start":{"line":3,"column":1},"end":{"line":22,"column":1}},"key":"UNICgpM3iu"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"and then pasting the following when prompted:","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"xK8Al1n1BW"}],"key":"jxjK2BhXze"},{"type":"code","lang":"bash","value":"\"Alan Turing theorized that computers would one day become\"","position":{"start":{"line":26,"column":1},"end":{"line":28,"column":1}},"key":"I4PshtteR8"}],"key":"bWxrgiYbW4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This should yield an identical result:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gYLy4BeybY"}],"key":"AhqvOjojbi"},{"type":"code","lang":"","value":" the most powerful machines on the planet.","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"UfWuez3aHZ"}],"key":"H3mrGnSqRg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"What Next?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"b1pkpMI53T"}],"identifier":"what-next","label":"What Next?","html_id":"what-next","implicit":true,"key":"PwZrwcbTEh"}],"key":"U861OXjyp2"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This implementation is cool and all, but it’s missing a ton of bells and whistles:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I3R7eooHn9"}],"key":"EEl5l9TRKL"}],"key":"ejFkkG4b2T"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPU/TPU Support","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZcKqU4FZUv"}],"identifier":"gpu-tpu-support","label":"GPU/TPU Support","html_id":"gpu-tpu-support","implicit":true,"key":"Uc3OuYFMFP"}],"key":"Z8VPFYMLoe"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Replace NumPy with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Dq0lunVijQ"},{"type":"link","url":"https://github.com/google/jax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"JAX","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T3lEx00QKK"}],"urlSource":"https://github.com/google/jax","error":true,"key":"Wr7qxIleNA"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IrJJJVeENQ"}],"key":"YD2ZGwbEjq"},{"type":"code","lang":"python","value":"import jax.numpy as np","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"wJnqZEeT1L"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"That’s it. You can now use the code with GPUs and even ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GqB40bT7Xe"},{"type":"link","url":"https://cloud.google.com/tpu/docs/system-architecture-tpu-vm","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"TPUs","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ErnBwoClVe"}],"urlSource":"https://cloud.google.com/tpu/docs/system-architecture-tpu-vm","key":"NeywPXT0Ki"},{"type":"text","value":"! Just make sure you ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dujjbzCOA8"},{"type":"link","url":"https://github.com/google/jax#installation","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"install JAX correctly","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GjRJkTDUrD"}],"urlSource":"https://github.com/google/jax#installation","error":true,"key":"M2DTETY5b1"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"t8yOuXJHa3"}],"key":"i5gt7z2OzK"}],"key":"GjljnnuCHz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Backprop","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vmc1p2fvxO"}],"key":"QHocvCYdoV"}],"identifier":"backprop","label":"Backprop","html_id":"backprop","implicit":true,"key":"dASd8yrhAq"}],"key":"yNwllkvAxa"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Again, if we replace NumPy with JAX:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HnnwhEFLoD"}],"key":"faTxgcFZ99"},{"type":"code","lang":"python","value":"import jax.numpy as np","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"vjpa4DYiIs"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Then computing the gradients is as easy as:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nGTMbUdUy3"}],"key":"KVq5uDWDy2"},{"type":"code","lang":"python","value":"def lm_loss(params, inputs, n_head) -> float:\n    x, y = inputs[:-1], inputs[1:]\n    logits = gpt2(x, **params, n_head=n_head)\n    loss = np.mean(-log_softmax(logits)[y])\n    return loss\n\ngrads = jax.grad(lm_loss)(params, inputs, n_head)","position":{"start":{"line":9,"column":1},"end":{"line":17,"column":1}},"key":"q6QysMJZZZ"}],"key":"nuuqbG6Bf5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Batching","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dBSgJn2lE3"}],"identifier":"batching","label":"Batching","html_id":"batching","implicit":true,"key":"OIGMaCEExm"}],"key":"qkhtyuItkl"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Once again, if we replace NumPy with JAX:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JvDx7onmyD"}],"key":"T0ZO7hL2HM"},{"type":"code","lang":"python","value":"import jax.numpy as np","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"KjYpBf5vxu"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Then, making our ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mWschFs2o7"},{"type":"inlineCode","value":"gpt2","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"tyn3YpNJns"},{"type":"text","value":" function batched is as easy as:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"qzSYTbmW1e"}],"key":"IDovT87RKm"},{"type":"code","lang":"python","value":"gpt2_batched = jax.vmap(gpt2, in_axes=[0, None, None, None, None, None])\ngpt2_batched(batched_inputs)  # [batch, seq_len] -> [batch, seq_len, vocab]","position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"key":"FYwCaYar4X"}],"key":"akHRJOYNSa"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"JAX test","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wPd9Qa3qR8"}],"identifier":"jax-test","label":"JAX test","html_id":"jax-test","implicit":true,"key":"qQ3DyPd3vf"}],"key":"MtP3BptP9y"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s verify that switching to JAX is indeed as easy as described:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wD5tBJoNJL"}],"key":"vcMSdc74C4"}],"key":"sVE08HiyDj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import jax.numpy as np\n\n# all references to np are now references to jax.numpy\noutput = prompt_gpt(\"Alan Turing theorized that computers would one day become\", n_tokens_to_generate=8)\nassert output == \" the most powerful machines on the planet.\"\nprint(output)","key":"hQWvLVPvtm"},{"type":"outputs","id":"GOT-Mmxnj1xtuzOrMju2W","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2025-02-18 12:27:38.750777: W external/local_xla/xla/tsl/framework/cpu_allocator_impl.cc:83] Allocation of 154389504 exceeds 10% of free system memory.\ngenerating: 100%|██████████| 8/8 [00:10<00:00,  1.30s/it]"},"children":[],"key":"zQAZXhbJI9"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":" the most powerful machines on the planet.\n"},"children":[],"key":"ziS3ksuAfD"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"\n"},"children":[],"key":"SI1l5QoGG5"}],"key":"ert278S4eJ"}],"key":"z8woJcJN4Z"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inference Optimization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RWYMzyklxN"}],"identifier":"inference-optimization","label":"Inference Optimization","html_id":"inference-optimization","implicit":true,"key":"Y7Xlj1PLYV"}],"key":"xvVFZzOTBB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Our implementation is quite inefficient. The quickest and most impactful optimization you can make (outside of GPU + batching support) would be to implement a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bBDWCWvQ08"},{"type":"link","url":"https://kipp.ly/blog/transformer-inference-arithmetic/#kv-cache","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"kv cache","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OMfZSTy5FE"}],"urlSource":"https://kipp.ly/blog/transformer-inference-arithmetic/#kv-cache","key":"BD2949s3Ef"},{"type":"text","value":". Also, we implemented our attention head computations sequentially, when we should really be doing it in parallel. Using JAX, this is as simple as","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f80es8JtRH"}],"key":"tYhBo6sxSW"},{"type":"code","lang":"python","value":"heads = jax.vmap(attention, in_axes=(0, 0, 0, None))(q, k, v, causal_mask)","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"key":"PtlJPq8oyy"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"There’s many many more inference optimizations. Here’s two recommendations as a starting point:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FBqqSIyVpw"}],"key":"Jm9DEkXeaG"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://lilianweng.github.io/posts/2023-01-10-inference-optimization/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Lillian Weng’s Large Transformer Model Inference Optimization","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"fclfaKh1Ve"}],"urlSource":"https://lilianweng.github.io/posts/2023-01-10-inference-optimization/","key":"uicIEbFxCh"}],"key":"I7lywGB0aa"}],"key":"OtvMlGdJEf"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://kipp.ly/blog/transformer-inference-arithmetic/","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Kipply’s Transformer Inference Arithmetic","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ZW6nRvqGi1"}],"urlSource":"https://kipp.ly/blog/transformer-inference-arithmetic/","key":"r627vezyLr"}],"key":"YU8ha39QkS"}],"key":"Vj6uedkW8d"}],"key":"OqVNw15VEZ"}],"key":"bJjMLjWu4K"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Training","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BYzjySOKFS"}],"identifier":"training","label":"Training","html_id":"training-1","implicit":true,"key":"rMxx9cUrt5"}],"key":"br7PclFeNe"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Training a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UM55yJegkb"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iCeMqmfLUL"}],"key":"Upn7AjQU8h"},{"type":"text","value":" is pretty standard for a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u5cTz7IdBx"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Cqyt8XNT2O"}],"key":"B1kbPu0iWs"},{"type":"text","value":" (gradient descent ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TZBN8QLjRQ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"w.r.t","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NefJQpAJ8l"}],"key":"LRInBh96qY"},{"type":"text","value":" a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sxrVGIYu49"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RJBisUDVBe"}],"key":"gGlTUCFmn8"},{"type":"text","value":" function). Of course, you also need to use the standard bag of tricks when training a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dVJBnt4S82"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eUrfWcHUw4"}],"key":"gRNH2U5GTW"},{"type":"text","value":" (i.e. use the Adam optimizer, find the optimal learning rate, regularization via dropout and/or weight decay, use a learning rate scheduler, use the correct weight initialization, batching, etc ...). Though the real challenge to training a good ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yRMU8TYLEZ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xD8TW6V6qN"}],"key":"Fze3xFfY28"},{"type":"text","value":" model is the ability to scale the data and the model. For scaling data, you’ll want a corpus of text that is big, high quality, and diverse.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vZ0uxeQb2L"}],"key":"NIam42bCDe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Big means billions of tokens (terabytes of data). For example, check out ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oOCxQBQ3z0"},{"type":"link","url":"https://pile.eleuther.ai/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The Pile","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n6WKMjTPBR"}],"urlSource":"https://pile.eleuther.ai/","key":"TfxN1glaQn"},{"type":"text","value":", which is an open source pre-training dataset for large language models.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ACy7dBJYXR"}],"key":"tqKo0sJbCg"}],"key":"BT4BfZ2upC"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"High quality means you want to filter out duplicate examples, unformatted text, incoherent text, garbage text, etc ...","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"q5msxGF4n5"}],"key":"xOpa9oOH0F"}],"key":"wrzPiwPFOI"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Diverse means varying sequence lengths, about lots of different topics, from different sources, with differing perspectives, etc ... Of course, if there are any biases in the data, it will reflect in the model, so you need to be careful of that as well.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nZs0jZipFz"}],"key":"OBbTQnxrsX"}],"key":"eEzv6hyAIG"}],"key":"berkQnGQnj"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Scaling the model to billions of parameters involves a cr*p ton of engineering (and money lol). Training frameworks can get ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pDMvSwQnRh"},{"type":"link","url":"https://github.com/NVIDIA/Megatron-LM","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"absurdly long and complex","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ka0rcCiMaq"}],"urlSource":"https://github.com/NVIDIA/Megatron-LM","error":true,"key":"Ls8zAuL4sl"},{"type":"text","value":". A good place to start would be ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VtrQwUyWLr"},{"type":"link","url":"https://lilianweng.github.io/posts/2021-09-25-train-large/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Lillian Weng’s How to Train Really Large Models on Many GPUs","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sfpXPd8Yvo"}],"urlSource":"https://lilianweng.github.io/posts/2021-09-25-train-large/","key":"BnpctWcjPn"},{"type":"text","value":". On the topic there’s also the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jvRhyfFNtW"},{"type":"link","url":"https://arxiv.org/pdf/1909.08053.pdf","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"NVIDIA’s Megatron Framework","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"P8R1fQc0gm"}],"urlSource":"https://arxiv.org/pdf/1909.08053.pdf","key":"BhqcalDrPK"},{"type":"text","value":", ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Zis9PZEIkY"},{"type":"link","url":"https://arxiv.org/pdf/2204.06514.pdf","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Cohere’s Training Framework","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"POGdX2Cnui"}],"urlSource":"https://arxiv.org/pdf/2204.06514.pdf","key":"mNoBb7sTS3"},{"type":"text","value":", ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PHoqEN9MbI"},{"type":"link","url":"https://arxiv.org/pdf/2204.02311.pdf","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Google’s PALM","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"I4wkSyigA5"}],"urlSource":"https://arxiv.org/pdf/2204.02311.pdf","key":"FWqJM2Z1xx"},{"type":"text","value":", the open source ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BhxSiFuCuF"},{"type":"link","url":"https://github.com/kingoflolz/mesh-transformer-jax","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"mesh​-transformer​-jax","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oFQPbeAoY2"}],"urlSource":"https://github.com/kingoflolz/mesh-transformer-jax","error":true,"key":"USsci4tjbG"},{"type":"text","value":" (used to train EleutherAI’s open source models), and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"YqpucCJVu8"},{"type":"link","url":"https://arxiv.org/pdf/2203.15556.pdf","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"many","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dv5HXdEcPG"}],"urlSource":"https://arxiv.org/pdf/2203.15556.pdf","key":"ehJWJz5hFk"},{"type":"text","value":" ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"R91LmWXrLJ"},{"type":"link","url":"https://www.microsoft.com/en-us/research/blog/turing-nlg-a-17-billion-parameter-language-model-by-microsoft/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"many","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uEK7j36LX9"}],"urlSource":"https://www.microsoft.com/en-us/research/blog/turing-nlg-a-17-billion-parameter-language-model-by-microsoft/","key":"MBqDs6valN"},{"type":"text","value":" ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JbfVeJe9QX"},{"type":"link","url":"https://arxiv.org/pdf/2005.14165.pdf","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"more","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lKltNtJxk9"}],"urlSource":"https://arxiv.org/pdf/2005.14165.pdf","key":"swkLXOtj9Z"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"k5VBVojApU"}],"key":"DMFREZszUv"}],"key":"vQwzEA0B5w"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Evaluation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ici5hWmlsI"}],"identifier":"evaluation","label":"Evaluation","html_id":"evaluation","implicit":true,"key":"ttxWuIlPSY"}],"key":"De4yYZF4sG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Oh boy, how does one even evaluate LLMs? Honestly, it’s really hard problem. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mmJmDsvJej"},{"type":"link","url":"https://arxiv.org/abs/2211.09110","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HELM","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZIRX3UjW0w"}],"urlSource":"https://arxiv.org/abs/2211.09110","key":"OHbxfagG3p"},{"type":"text","value":" is pretty comprehensive and a good place to start, but you should always be skeptical of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qtylsOFTrA"},{"type":"link","url":"https://en.wikipedia.org/wiki/Goodhart%27s_law","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"benchmarks and evaluation metrics","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hcF6AlmrL9"}],"urlSource":"https://en.wikipedia.org/wiki/Goodhart%27s_law","data":{"page":"Goodhart%27s_law","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"XJH8BtvtUJ"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AxFZ62BusV"}],"key":"OZM52VjY3H"}],"key":"GmUpLVNF0t"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Architecture Improvements","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rPIHPRJzEi"}],"identifier":"architecture-improvements","label":"Architecture Improvements","html_id":"architecture-improvements","implicit":true,"key":"gWvJzZrmna"}],"key":"OCn5A95uu3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can also take a look at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qDot74IKJc"},{"type":"link","url":"https://github.com/lucidrains/x-transformers","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Phil Wang’s X-Transformer’s","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SOm6Bvsq2w"}],"urlSource":"https://github.com/lucidrains/x-transformers","error":true,"key":"bCI9Zpjwez"},{"type":"text","value":". ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JJhKlVAWdw"},{"type":"link","url":"https://arxiv.org/pdf/2102.11972.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This paper","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jFOfOy31v8"}],"urlSource":"https://arxiv.org/pdf/2102.11972.pdf","key":"frFVVltjIh"},{"type":"text","value":" is also a pretty good summary (see Table 1). Facebook’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IdZ7fAQyXS"},{"type":"link","url":"https://arxiv.org/pdf/2302.13971.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"LLaMA paper","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Pawy4SER0V"}],"urlSource":"https://arxiv.org/pdf/2302.13971.pdf","key":"F2OU9PM3pU"},{"type":"text","value":" is also probably a good reference for standard architecture improvements (at least as of February 2023 it was).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JeSFDqODlP"}],"key":"IViT8gn1gw"}],"key":"oC5hRRMx0b"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Stopping Generation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W3a8fqBthz"}],"identifier":"stopping-generation","label":"Stopping Generation","html_id":"stopping-generation","implicit":true,"key":"JAt4sHYuXe"}],"key":"CH6Z88nFOl"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Our current implementation requires us to specify the exact number of tokens we’d like to generate ahead of time. This is not a very good approach as our generations end up being too long, too short, or cutoff mid-sentence. To resolve this, we can introduce a special end of sentence (EOS) token. During pre-training, we append the EOS token to the end of our input (i.e. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FhEWOwGGJC"},{"type":"inlineCode","value":"tokens = [\"not\", \"all\", \"heroes\", \"wear\", \"capes\", \".\", \"<|EOS|>\"]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wgwmy4CJrJ"},{"type":"text","value":"). During generation, we simply stop whenever we encounter the EOS token (or if we hit some maximum sequence length):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r5ROx747jD"}],"key":"KCLAigqrxx"},{"type":"code","lang":"python","value":"def generate(inputs, eos_id, max_seq_len):\n\tprompt_len = len(inputs)\n\twhile inputs[-1] != eos_id and len(inputs) < max_seq_len:\n        output = gpt(inputs)\n        next_id = np.argmax(output[-1])\n        inputs.append(int(next_id))\n    return inputs[prompt_len:]","position":{"start":{"line":3,"column":1},"end":{"line":11,"column":1}},"key":"UQGIfYVrDe"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BFssGXslRu"}],"key":"peUyxmQKDC"},{"type":"text","value":"-2 was not pre-trained with an EOS token, so we can’t use this approach in our code, but most LLMs nowadays use an EOS token.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"o51hQwnRy8"}],"key":"kMFt4ffNGZ"}],"key":"qhZ63KsKHA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Fine-tuning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CGkFX8VTcq"}],"identifier":"fine-tuning","label":"Fine-tuning","html_id":"fine-tuning","implicit":true,"key":"vQgNGZ7pfC"}],"key":"JVu6hK8uzS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We briefly touched on fine-tuning in the training section. Recall, fine-tuning is when we re-use the pre-trained weights to train the model on some downstream task. We call this process transfer-learning. In theory, we could use zero-shot or few-shot prompting to get the model to complete our task, however, if you have access to a labelled dataset, fine-tuning a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kerkip5Q8h"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NQkc2rrBhc"}],"key":"mJZ4lV006F"},{"type":"text","value":" is going to yield better results (results that can scale given additional data and higher quality data). There are a couple different topics related to fine-tuning, as described below:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GnYh9J4KbL"}],"key":"PAIroPNI2w"}],"key":"mbZ7OcgmBR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Classification Fine-tuning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WOAhB7Akl3"}],"identifier":"classification-fine-tuning","label":"Classification Fine-tuning","html_id":"classification-fine-tuning","implicit":true,"key":"wKO1E3zUSO"}],"key":"zAp5BAZUT7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In classification fine-tuning, we give the model some text and we ask it to predict which class it belongs to. For example, consider the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cvoSVUErNb"},{"type":"link","url":"https://huggingface.co/datasets/imdb","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"IMDB dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KBcixYjm0s"}],"urlSource":"https://huggingface.co/datasets/imdb","key":"y8ScZNr63d"},{"type":"text","value":", which contains movie reviews that rate the movie as either good, or bad:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zSAExMcDZ4"}],"key":"uOuOIIkCdr"},{"type":"code","lang":"text","value":"--- Example 1 ---\nText: I wouldn't rent this one even on dollar rental night.\nLabel: Bad\n--- Example 2 ---\nText: I don't know why I like this movie so well, but I never get tired of watching it.\nLabel: Good\n--- Example 3 ---\n...","position":{"start":{"line":3,"column":1},"end":{"line":12,"column":1}},"key":"w6KI1jMdsG"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"To fine-tune our model, we replace the language modeling head with a classification head, which we apply to the last token output:","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"IyUFJYS48v"}],"key":"TL13pv999Y"},{"type":"code","lang":"python","value":"def gpt2(inputs, wte, wpe, blocks, ln_f, cls_head, n_head):\n    x = wte[inputs] + wpe[range(len(inputs))]\n    for block in blocks:\n        x = transformer_block(x, **block, n_head=n_head)\n    x = layer_norm(x, **ln_f)\n\n\t# project to n_classes\n\t# [n_embd] @ [n_embd, n_classes] -> [n_classes]\n    return x[-1] @ cls_head","position":{"start":{"line":16,"column":1},"end":{"line":26,"column":1}},"key":"Qp7TrXgZhq"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"We only use the last token output ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"eVhZbkDeFa"},{"type":"inlineCode","value":"x[-1]","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"TpO87yxozm"},{"type":"text","value":" because we only need to produce a single probability distribution for the entire input instead of ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"s7748N7Bcx"},{"type":"inlineCode","value":"n_seq","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"r7cxoODkml"},{"type":"text","value":" distributions as in the case of language modeling. We take the last token in particular (instead of say the first token or a combination of all the tokens) because the last token is the only token that is allowed to attend to the entire sequence and thus has information about the input text as a whole. As per usual, we optimize ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"A2Sue9397q"},{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"w.r.t.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"hXzVPF6qIc"}],"key":"vH4lmPA37a"},{"type":"text","value":" the cross entropy ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"sdvvLoXml9"},{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"k6KU65WGEZ"}],"key":"qVBocwAvhx"},{"type":"text","value":":","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"NjpL8sR3F8"}],"key":"Zu69w4RygR"},{"type":"code","lang":"python","value":"def singe_example_loss_fn(inputs: list[int], label: int, params) -> float:\n    logits = gpt(inputs, **params)\n    probs = softmax(logits)\n    loss = -np.log(probs[label]) # cross entropy loss\n    return loss","position":{"start":{"line":30,"column":1},"end":{"line":36,"column":1}},"key":"Wj2OFefJSd"}],"key":"vcRVZDa30z"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generative Fine-tuning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YHOQ5Jg4sZ"}],"identifier":"generative-fine-tuning","label":"Generative Fine-tuning","html_id":"generative-fine-tuning","implicit":true,"key":"rPE8M9vmJ1"}],"key":"U3Y4D9fqBl"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Some tasks can’t be neatly categorized into classes. For example, consider the task of summarization. We can fine-tune these types of task by simply performing language modeling on the input concatenated with the label. For example, here’s what a single summarization training sample might look like:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Yo6jI9KuJF"}],"key":"oPYtL6qlfr"},{"type":"code","lang":"text","value":"--- Article ---\nThis is an article I would like to summarize.\n--- Summary ---\nThis is the summary.","position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"key":"Rxc8K0xlTW"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"We train the model as we do during pre-training (optimize ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"VxL1Vt4JhG"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"w.r.t","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"kqTTrWnjli"}],"key":"n49JTUQyT0"},{"type":"text","value":" language modeling ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"pRaQMjQlom"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"igeBR7h9LT"}],"key":"M4KRexWQzd"},{"type":"text","value":"). At predict time, we feed the model the everything up to ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ogVO4dDUYJ"},{"type":"inlineCode","value":"--- Summary ---","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"d9afXRZ3hf"},{"type":"text","value":" and then perform auto-regressive language modeling to generate the summary. The choice of the delimiters ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"q1KLJP8xAH"},{"type":"inlineCode","value":"--- Article ---","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"kkr5XpwUtP"},{"type":"text","value":" and ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"rWcfLLqknY"},{"type":"inlineCode","value":"--- Summary ---","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"d0xLDAzf5a"},{"type":"text","value":" are arbitrary. How you choose to format the text is up to you, as long as it is consistent between training and inference. Notice, we can also formulate classification tasks as generative tasks (for example with IMDB):","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"vHhrrgtRP9"}],"key":"SFPXS0X4Gd"},{"type":"code","lang":"text","value":"--- Text ---\nI wouldn't rent this one even on dollar rental night.\n--- Label ---\nBad","position":{"start":{"line":12,"column":1},"end":{"line":17,"column":1}},"key":"crDST5eA2U"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"However, this will probably perform worse than doing classification fine-tuning directly (","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"fOpAXNxrbN"},{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"seICq24hzk"}],"key":"tdDJSEoUrd"},{"type":"text","value":" includes language modeling on the entire sequence, not just the final prediction, so the ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"ysEQLLCUzy"},{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"loss","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"GYjnmVX1is"}],"key":"cpqZqG8TVo"},{"type":"text","value":" specific to the prediction will get diluted)","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"ga8WIjl07h"}],"key":"VGhfrAJSPr"}],"key":"qOskEvpO8K"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Instruction Fine-tuning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i8EvjOQKOj"}],"identifier":"instruction-fine-tuning","label":"Instruction Fine-tuning","html_id":"instruction-fine-tuning","implicit":true,"key":"jg1xAWN7yj"}],"key":"OM46qatBka"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Most state-of-the-art large language models these days also undergo an additional instruction fine-tuning step after being pre-trained. In this step, the model is fine-tuned (generative) on thousands of instruction prompt + completion pairs that were human labeled. Instruction fine-tuning can also be referred to as supervised fine-tuning, since the data is human labelled (i.e. supervised). So what’s the benefit of instruction fine-tuning? While predicting the next word in a wikipedia article makes the model is good at continuing sentences, it doesn’t make it particularly good at following instructions, or having a conversation, or summarizing a document (all the things we would like a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BLFAEG56G3"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Afg6oDLEtP"}],"key":"uJchl4LowX"},{"type":"text","value":" to do). Fine-tuning them on human labelled instruction + completion pairs is a way to teach the model how it can be more useful, and make them easier to interact with. This call this AI alignment, as we are aligning the model to do and behave as we want it to. Alignment is an active area of research, and includes more than just following instructions (bias, safety, intent, etc ...). What does this instruction data look like exactly? Google’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ugmpy7Rw9H"},{"type":"link","url":"https://arxiv.org/pdf/2109.01652.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"FLAN","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zvqvfDja18"}],"urlSource":"https://arxiv.org/pdf/2109.01652.pdf","key":"B9sPPhi60D"},{"type":"text","value":" models were trained on various academic NLP datasets (which are already human labelled):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aWtwxTgvKk"}],"key":"pHIQDOnjNr"}],"key":"l8BzcdZblm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"fig_3_from_flan_paper.png\"))","key":"tK9z4mPL52"},{"type":"outputs","id":"kXjM38zSIVK54ZM507ILd","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"269015026799f69183904e1e2efa752b","path":"/build/269015026799f69183904e1e2efa752b.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"gy6k0DS2SZ"}],"key":"uHMdsi6WWX"}],"key":"B6NoosoNjI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"OpenAI’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jSPp9l6Qeo"},{"type":"link","url":"https://arxiv.org/pdf/2203.02155.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"InstructGPT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"be2g0fPmaC"}],"urlSource":"https://arxiv.org/pdf/2203.02155.pdf","key":"a45aJHs9RM"},{"type":"text","value":" on the other hand was trained on prompts collected from their own API. They then paid workers to write completions for those prompts. Here’s a breakdown of the data:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j64GCC10ei"}],"key":"sqgS6RyEBU"}],"key":"WLIxRLHvkm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"table_1_and_2_from_instructgpt_paper.png\"))","key":"zJ6kMEUYy2"},{"type":"outputs","id":"sip_Fg2bibT7yaSbZQvGZ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0ac97a4b8b67347c6ccd5b68b7057f03","path":"/build/0ac97a4b8b67347c6ccd5b68b7057f03.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"uOnokpwXkS"}],"key":"cqFJ7agZUa"}],"key":"tfSYwxLxY8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Parameter Efficient Fine-tuning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PhN5CIatLK"}],"identifier":"parameter-efficient-fine-tuning","label":"Parameter Efficient Fine-tuning","html_id":"parameter-efficient-fine-tuning","implicit":true,"key":"oQvXSkgcAY"}],"key":"aSHemkH8Fh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"When we talk about fine-tuning in the above sections, it is assumed that we are updating all of the model parameters. While this yields the best performance, it is costly both in terms of compute (need to back propagate over the entire model) and in terms of storage (for each fine-tuned model, you need to store a completely new copy of the parameters). For instruction fine-tuning, this is fine, we want maximum performance, but if you then wanted to fine-tune 100 different models for various downstream tasks, then you’d have a problem. The most simple approach to this problem is to only update the head and freeze (i.e. make untrainable) the rest of the model. This would speed up training and greatly reduce the number of new parameters, however it would not perform nearly as well as a full fine-tune (we are lacking the deep in deep learning). We could instead selectively freeze specific layers (i.e. freeze all layers except the last 4, or freeze every other layer, or freeze all parameters except multi-head attention parameters), which would help restore some of the depth. This will perform a lot better, but we become a lot less parameter efficient and reduce our training speed ups. Instead, we can utilize parameter-efficient fine-tuning (PEFT) methods. PEFT is active area of research, and there are ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W3Mrods7LY"},{"type":"link","url":"https://aclanthology.org/2021.emnlp-main.243.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"lots","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ys438GwajJ"}],"urlSource":"https://aclanthology.org/2021.emnlp-main.243.pdf","key":"JHcpHklfU1"},{"type":"text","value":" ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GD2TrHdUew"},{"type":"link","url":"https://arxiv.org/pdf/2110.07602.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"of","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YekqgdFwuX"}],"urlSource":"https://arxiv.org/pdf/2110.07602.pdf","key":"kqMZX2f9DD"},{"type":"text","value":" ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EZegdoVsjO"},{"type":"link","url":"https://arxiv.org/pdf/2101.00190.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"different","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YP62uvdEaO"}],"urlSource":"https://arxiv.org/pdf/2101.00190.pdf","key":"JaLkM3IOO2"},{"type":"text","value":" ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C1wC2koE7y"},{"type":"link","url":"https://arxiv.org/pdf/2103.10385.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"methods","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zcXOwLbgdS"}],"urlSource":"https://arxiv.org/pdf/2103.10385.pdf","key":"Ok7cl7CMgV"},{"type":"text","value":" ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o5YXtTJdqN"},{"type":"link","url":"https://arxiv.org/pdf/2106.09685.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"to","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gGaqnRgiGC"}],"urlSource":"https://arxiv.org/pdf/2106.09685.pdf","key":"JKUOy9JW8i"},{"type":"text","value":" ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Au9lxVPoNd"},{"type":"link","url":"https://arxiv.org/pdf/1902.00751.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"choose","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qxZ3MYWyX9"}],"urlSource":"https://arxiv.org/pdf/1902.00751.pdf","key":"pkXJrS4kmp"},{"type":"text","value":" ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nHEvO4EsbO"},{"type":"link","url":"https://arxiv.org/abs/2205.05638","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"from","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sloWvv1sSn"}],"urlSource":"https://arxiv.org/abs/2205.05638","key":"TbChvPQnCj"},{"type":"text","value":". As an example, take the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J3Hw49ukk5"},{"type":"link","url":"https://arxiv.org/pdf/1902.00751.pdf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Adapters paper","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jTX9YlqxDn"}],"urlSource":"https://arxiv.org/pdf/1902.00751.pdf","key":"cpzELIoVt7"},{"type":"text","value":". In this approach, we add an additional “adapter” layer after the FFN and MHA layers in the transformer block. The adapter layer is just a simple 2 layer fully connected ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yjTLlnOntQ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BVrUHJQRKm"}],"key":"ZrAHw1OCUx"},{"type":"text","value":", where the input and output dimensions are ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OKm0rmuZOM"},{"type":"inlineCode","value":"n_embd","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iaTxRAzUQv"},{"type":"text","value":", and the hidden dimension is smaller than ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tfPMzsgPM2"},{"type":"inlineCode","value":"n_embd","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lnXIfoziRf"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Drygp6Q1PD"}],"key":"f6eMrMc37K"}],"key":"MWC7oPRsS9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\ndisplay(Image(filename=\"fig_2_from_the_adapters_paper.png\"))","key":"EjkocSZeqb"},{"type":"outputs","id":"yaFlDHnC3HK1N8t-ArDTy","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8a2b43381f7a8309dc25f86c906c8d7f","path":"/build/8a2b43381f7a8309dc25f86c906c8d7f.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"LhUGhJ0Ssg"}],"key":"nOSUKUorBv"}],"key":"JCNDQAAFZr"}],"key":"FgCFYh54X5"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"6. makemore (part 5): building a WaveNet","url":"/micrograduate/makemore5","group":"microgra∇uate"}}},"domain":"http://localhost:3000"}